<!DOCTYPE html>
<html>
  <head>
    <title>AngularJS service with var declarations instead of this. assignments</title>
    <link rel="stylesheet" type="text/css" href="http://bladewolf55.gitlab.io/smblog/css/default.css">
  </head>
  <body>
    <header>Questor</header>
    <nav>
      <ul>
        <li><a href="http://bladewolf55.gitlab.io/smblog/">Home</a></li>
        <li class="dropdown">
          <a href="http://bladewolf55.gitlab.io/smblog/about">About</a>
          <div class="dropdown-content">
            <a href="http://bladewolf55.gitlab.io/smblog/about/contact">Contact Us</a>
            <a href="http://bladewolf55.gitlab.io/smblog/about-team">Our Team</a>
          </div>
        </li>
      </ul>
    </nav>
   	<aside id="sidebar">
	   <div id="recent">
       <p><strong>History</strong></p>
       <ol class='tree'><li class='history-year'><label for='2017'>2017</label><input type='checkbox'  id='2017' /><ol><li class='history-month'><label for='2017-8'>August</label><input type='checkbox'  id='2017-8' /><ol><li class='post'><a class='post' href='http://bladewolf55.gitlab.io/smblog/posts/dont-use-data-prefix-in-angularjs'>Don't use "data" prefix in AngularJS</a></li></ol></li><li class='history-month'><label for='2017-7'>July</label><input type='checkbox'  id='2017-7' /><ol><li class='post'><a class='post' href='http://bladewolf55.gitlab.io/smblog/posts/angularjs-service-with-var-declarations'>AngularJS service with var declarations instead of this. assignments</a></li></ol></li><li class='history-month'><label for='2017-6'>June</label><input type='checkbox'  id='2017-6' /><ol><li class='post'><a class='post' href='http://bladewolf55.gitlab.io/smblog/posts/factory-resetting-android-without'>Factory Resetting Android Without Losing Your Life (Metaphorically)</a></li></ol></li><li class='history-month'><label for='2017-5'>May</label><input type='checkbox'  id='2017-5' /><ol><li class='post'><a class='post' href='http://bladewolf55.gitlab.io/smblog/posts/identityserver3-with-pkce-part-4'>IdentityServer3 with PKCE Part 4 - Persisting User Data</a></li><li class='post'><a class='post' href='http://bladewolf55.gitlab.io/smblog/posts/identityserver3-with-pkce-part-3'>IdentityServer3 with PKCE Part 3 - Persist IdentityServer Configuration</a></li><li class='post'><a class='post' href='http://bladewolf55.gitlab.io/smblog/posts/identityserver3-with-pkce-part-2'>IdentityServer3 with PKCE Part 2 - Protected Resource Server</a></li><li class='post'><a class='post' href='http://bladewolf55.gitlab.io/smblog/posts/identityserver3-with-pkce-part-1-simple'>IdentityServer3 with PKCE Part 1 - Simple OAuth2 Server</a></li></ol></li><li class='history-month'><label for='2017-3'>March</label><input type='checkbox'  id='2017-3' /><ol><li class='post'><a class='post' href='http://bladewolf55.gitlab.io/smblog/posts/tfs-continuous-integration-walk-through'>TFS Continuous Integration Walk Through Part 5c - Multiple Solutions: Dependencies</a></li><li class='post'><a class='post' href='http://bladewolf55.gitlab.io/smblog/posts/sane-database-schema-conventions'>Sane Database Schema Conventions</a></li></ol></li></ol></li></ol>
      </div>
	    <div id="tags"></div>
	  </aside>
    <section id="content"><div class='post-title'>
                <a href='http://bladewolf55.gitlab.io/smblog/posts/angularjs-service-with-var-declarations'><h1>AngularJS service with var declarations instead of this. assignments</h1></a>
                <p class='post-info'>2017-07-12 17:09</p>
            </div><p>So I spent a couple of hours trying to figure out why a <a href="https://www.codeproject.com/Articles/810892/Building-a-Kanban-board-application-using-AngularJ">generally very good Angular sample</a> I thought I'd implemented correctly wouldn't work. Specifically, the service had this code:</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="va">sulhome</span>.<span class="va">kanbanBoardApp</span>.<span class="at">service</span>(<span class="st">&#39;boardService&#39;</span><span class="op">,</span> <span class="kw">function</span> ($http<span class="op">,</span> $q<span class="op">,</span> $rootScope) <span class="op">{</span>

    <span class="kw">var</span> getColumns <span class="op">=</span> <span class="kw">function</span> () <span class="op">{</span>
        <span class="cf">return</span> <span class="va">$http</span>.<span class="at">get</span>(<span class="st">&quot;/api/BoardWebApi&quot;</span>).<span class="at">then</span>(<span class="kw">function</span> (response) <span class="op">{</span>
            <span class="cf">return</span> <span class="va">response</span>.<span class="at">data</span><span class="op">;</span>
        <span class="op">},</span> <span class="kw">function</span> (error) <span class="op">{</span>
            <span class="cf">return</span> <span class="va">$q</span>.<span class="at">reject</span>(<span class="va">error</span>.<span class="va">data</span>.<span class="at">Message</span>)<span class="op">;</span>
        <span class="op">}</span>)<span class="op">;</span>
    <span class="op">};</span></code></pre></div>
<p>which was called this way in the controller.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="va">sulhome</span>.<span class="va">kanbanBoardApp</span>.<span class="at">controller</span>(<span class="st">&#39;boardCtrl&#39;</span><span class="op">,</span> <span class="kw">function</span> ($scope<span class="op">,</span> boardService) <span class="op">{</span>
    <span class="va">boardService</span>.<span class="at">getColumns</span>()<span class="op">;</span></code></pre></div>
<p>The problem is, this doesn't work. The proper way to set a function in a service should look like this:</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="va">sulhome</span>.<span class="va">kanbanBoardApp</span>.<span class="at">service</span>(<span class="st">&#39;boardService&#39;</span><span class="op">,</span> <span class="kw">function</span> ($http<span class="op">,</span> $q<span class="op">,</span> $rootScope) <span class="op">{</span>

    <span class="kw">this</span>.<span class="at">getColumns</span> <span class="op">=</span> <span class="kw">function</span> () <span class="op">{</span>
        <span class="cf">return</span> <span class="va">$http</span>.<span class="at">get</span>(<span class="st">&quot;/api/BoardWebApi&quot;</span>).<span class="at">then</span>(<span class="kw">function</span> (response) <span class="op">{</span>
            <span class="cf">return</span> <span class="va">response</span>.<span class="at">data</span><span class="op">;</span>
        <span class="op">},</span> <span class="kw">function</span> (error) <span class="op">{</span>
            <span class="cf">return</span> <span class="va">$q</span>.<span class="at">reject</span>(<span class="va">error</span>.<span class="va">data</span>.<span class="at">Message</span>)<span class="op">;</span>
        <span class="op">}</span>)<span class="op">;</span>
    <span class="op">};</span></code></pre></div>
<p>See the difference? <code>this.getColumns</code>, not <code>var getColumns</code>.</p>
<p>So, how was this other guy's code working? It was--I downloaded and ran his sample.</p>
<p>A service is a function with nested functions. He returned the functions in the parent function, like so:</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="va">sulhome</span>.<span class="va">kanbanBoardApp</span>.<span class="at">service</span>(<span class="st">&#39;boardService&#39;</span><span class="op">,</span> <span class="kw">function</span> ($http<span class="op">,</span> $q<span class="op">,</span> $rootScope) <span class="op">{</span>

    <span class="kw">var</span> getColumns <span class="op">=</span> <span class="kw">function</span> () <span class="op">{</span>
        <span class="cf">return</span> <span class="va">$http</span>.<span class="at">get</span>(<span class="st">&quot;/api/BoardWebApi&quot;</span>).<span class="at">then</span>(<span class="kw">function</span> (response) <span class="op">{</span>
            <span class="cf">return</span> <span class="va">response</span>.<span class="at">data</span><span class="op">;</span>
        <span class="op">},</span> <span class="kw">function</span> (error) <span class="op">{</span>
            <span class="cf">return</span> <span class="va">$q</span>.<span class="at">reject</span>(<span class="va">error</span>.<span class="va">data</span>.<span class="at">Message</span>)<span class="op">;</span>
        <span class="op">}</span>)<span class="op">;</span>
    <span class="op">};</span>

    <span class="cf">return</span> <span class="op">{</span>
            <span class="dt">getColumns</span><span class="op">:</span> getColumns
        <span class="op">};</span></code></pre></div>
<p>So far, I haven't seen any other samples do it this way. It works, but...why the extra code step?</p>
</section>
    
    <footer><p>Copyright &copy; Charles L Flatt</p></footer>
  </body>
</html>
