<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  
  <link rel='stylesheet' href='http://bladewolf55.gitlab.io/smblog/css/default.css' />
<link rel='stylesheet' href='http://bladewolf55.gitlab.io/smblog/css/tango.css' />

  <title>TFS Continuous Integration Walk Through Part 5B - Multiple Solutions: Simple Project References | Software Meadows</title>
</head>

<body>
  <nav>
    <div id="menu">
      <ol>
<li><a href="http://bladewolf55.gitlab.io/smblog/">Home</a></li>
<li><a href="http://bladewolf55.gitlab.io/smblog/about">About</a></li>
</ol>

    </div>
    <div id="recent">
      <h2>Recent</h2>
      <a href='http://bladewolf55.gitlab.io/smblog/posts/tfs_2015_publish_asp_net_using_robocopy'>TFS 2015: Publish ASP.NET Using Robocopy</a><a href='http://bladewolf55.gitlab.io/smblog/posts/combining_veracrypt_google_backup_sync_sql_server_part_2'>Combining VeraCrypt, Google Backup & Sync, and Sql Server Part 2</a><a href='http://bladewolf55.gitlab.io/smblog/posts/combining_veracrypt_google_backup_sync_sql_server_part_1'>Combining VeraCrypt, Google Backup & Sync, and Sql Server Part 1</a><a href='http://bladewolf55.gitlab.io/smblog/posts/new-blog-engine'>New Blog Engine</a><a href='http://bladewolf55.gitlab.io/smblog/posts/dont-use-data-prefix-in-angularjs'>Don't use "data" prefix in AngularJS</a>
    </div>
    <div id="history">
      <h2>History</h2>
      <ol class='tree'><li class='history-year'><label for='2018'>2018</label><input type='checkbox'  id='2018' /><ol><li class='history-month'><label for='2018-1'>January</label><input type='checkbox'  id='2018-1' /><ol><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/tfs_2015_publish_asp_net_using_robocopy'>TFS 2015: Publish ASP.NET Using Robocopy</a></li><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/combining_veracrypt_google_backup_sync_sql_server_part_2'>Combining VeraCrypt, Google Backup & Sync, and Sql Server Part 2</a></li><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/combining_veracrypt_google_backup_sync_sql_server_part_1'>Combining VeraCrypt, Google Backup & Sync, and Sql Server Part 1</a></li><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/new-blog-engine'>New Blog Engine</a></li></ol></li></ol></li><li class='history-year'><label for='2017'>2017</label><input type='checkbox'  id='2017' /><ol><li class='history-month'><label for='2017-8'>August</label><input type='checkbox'  id='2017-8' /><ol><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/dont-use-data-prefix-in-angularjs'>Don't use "data" prefix in AngularJS</a></li></ol></li><li class='history-month'><label for='2017-7'>July</label><input type='checkbox'  id='2017-7' /><ol><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/angularjs-service-with-var-declarations'>AngularJS service with var declarations instead of this. assignments</a></li></ol></li><li class='history-month'><label for='2017-6'>June</label><input type='checkbox'  id='2017-6' /><ol><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/factory-resetting-android-without'>Factory Resetting Android Without Losing Your Life (Metaphorically)</a></li></ol></li><li class='history-month'><label for='2017-5'>May</label><input type='checkbox'  id='2017-5' /><ol><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/identityserver3-with-pkce-part-4'>IdentityServer3 with PKCE Part 4 - Persisting User Data</a></li><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/identityserver3-with-pkce-part-3'>IdentityServer3 with PKCE Part 3 - Persist IdentityServer Configuration</a></li><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/identityserver3-with-pkce-part-2'>IdentityServer3 with PKCE Part 2 - Protected Resource Server</a></li><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/identityserver3-with-pkce-part-1-simple'>IdentityServer3 with PKCE Part 1 - Simple OAuth2 Server</a></li></ol></li><li class='history-month'><label for='2017-3'>March</label><input type='checkbox'  id='2017-3' /><ol><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/tfs-continuous-integration-walk-through'>TFS Continuous Integration Walk Through Part 5c - Multiple Solutions: Dependencies</a></li><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/sane-database-schema-conventions'>Sane Database Schema Conventions</a></li><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/tfs-continuous-integration-agent'>TFS Continuous Integration - Agent Installation and Visual Studio Licensing</a></li><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/tfs-continuous-integration-clickonce'>TFS Continuous Integration - ClickOnce Apps</a></li><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/tfs-continuous-integration-and-private'>TFS Continuous Integration and Private NuGet Package Sources</a></li></ol></li><li class='history-month'><label for='2017-2'>February</label><input type='checkbox'  id='2017-2' /><ol><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/tfs-continuous-integration-walk-through_22'>TFS Continuous Integration Walk Through Part 5b - Multiple Solutions: Simple Project References</a></li><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/tfs-continuous-integration-walk-through_20'>TFS Continuous Integration Walk Through Part 5a - Multiple Solutions: Overview</a></li><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/tfs-continuous-integration-walk-through_24'>TFS Continuous Integration Walk Through Part 4b - Problems With Traits</a></li><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/tfs-continuous-integration-walk-through_6'>TFS Continuous Integration Walk Through Part 4a - Filtering Tests</a></li><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/tfs-continuous-integration-walk-through_63'>TFS Continuous Integration Walk Through Part 3 - Notifications</a></li><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/tfs-continuous-integration-walk-through_5'>TFS Continuous Integration Walk Through Part 2 - Create an Automated Build</a></li><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/tfs-continuous-integration-walk-through'>TFS Continuous Integration Walk Through Part 1 - Installing TFS and Checking In a Test Project</a></li></ol></li><li class='history-month'><label for='2017-1'>January</label><input type='checkbox'  id='2017-1' /><ol><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/what-else-programmers-do-text'>What Else Programmers Do: A Text Manipulation Example</a></li><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/what-does-this-code-do-extended'>What does this code do? Extended explanation</a></li></ol></li></ol></li><li class='history-year'><label for='2016'>2016</label><input type='checkbox'  id='2016' /><ol><li class='history-month'><label for='2016-12'>December</label><input type='checkbox'  id='2016-12' /><ol><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/nexus-5-gps-lock-problem-and-two'>Nexus 5 GPS Lock Problem and Three--or More!--Solutions</a></li></ol></li><li class='history-month'><label for='2016-11'>November</label><input type='checkbox'  id='2016-11' /><ol><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/how-to-bypass-new-microsoft-office'>How to Bypass the New Microsoft Office Startup and Save Screens</a></li><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/google-tasks-vs-reminders-in-desktop'>Google Tasks vs Reminders in Desktop and Phone</a></li><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/catching-up-on-coding-claims-based-identity-part-1_6'>Catching Up on Coding - Claims-Based Identity Part 1</a></li></ol></li><li class='history-month'><label for='2016-10'>October</label><input type='checkbox'  id='2016-10' /><ol><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/creating-forms-authentication'>Creating Forms Authentication Membership Tables in LocalDB–Right and Wrong Ways</a></li><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/windows-10-complaint-1-auto-update'>Windows 10 Complaint #1: Auto Update State Loss</a></li></ol></li><li class='history-month'><label for='2016-9'>September</label><input type='checkbox'  id='2016-9' /><ol><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/disable-windows-10-photo-automatic'>Disable Windows 10 Photo Automatic Albums</a></li><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/a-laymans-explanation-of-mocking-and'>A Layman’s Explanation of Mocking and Dependency Injection</a></li></ol></li><li class='history-month'><label for='2016-8'>August</label><input type='checkbox'  id='2016-8' /><ol><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/catching-up-on-coding-tdd-part-3'>Catching Up on Coding - TDD Part 3</a></li><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/catching-up-on-coding-tdd-part-2'>Catching Up on Coding - TDD Part 2</a></li><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/catching-up-on-coding-tdd-part-1'>Catching Up on Coding - TDD Part 1</a></li></ol></li><li class='history-month'><label for='2016-7'>July</label><input type='checkbox'  id='2016-7' /><ol><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/writing-to-current-users-registry-when'>Writing to the Current User(s) Registry When Running as System</a></li><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/catching-up-on-coding-syllabus'>Catching Up on Coding - The Syllabus</a></li><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/quickly-enable-mercurial-keyring-for'>Quickly Enable Mercurial Keyring for BitBucket</a></li></ol></li><li class='history-month'><label for='2016-6'>June</label><input type='checkbox'  id='2016-6' /><ol><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/create-easily-debuggable-windows-service'>Create an Easily Debuggable Windows Service</a></li><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/underrated-work-skills'>(Underrated) Work Skills</a></li></ol></li><li class='history-month'><label for='2016-5'>May</label><input type='checkbox'  id='2016-5' /><ol><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/vbnet-windows-project-to-c-conversion'>VB.Net Windows Project to C# Conversion Tools Quick Review</a></li></ol></li><li class='history-month'><label for='2016-2'>February</label><input type='checkbox'  id='2016-2' /><ol><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/scroll-bars-in-blogger-tags'>Scroll bars in Blogger &lt;pre&gt; Tags</a></li><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/google-keep-changes-taking-to-forums'>Google Keep Changes: Taking to the Forums</a></li><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/backward-step-for-google-keep'>Backward Step for Google Keep</a></li><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/recover-virtualbox-snapshots'>Recover VirtualBox Snapshots</a></li></ol></li><li class='history-month'><label for='2016-1'>January</label><input type='checkbox'  id='2016-1' /><ol><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/auto-updating-new-windows-7-installation'>Auto Updating a New Windows 7 Installation</a></li></ol></li></ol></li><li class='history-year'><label for='2015'>2015</label><input type='checkbox'  id='2015' /><ol><li class='history-month'><label for='2015-8'>August</label><input type='checkbox'  id='2015-8' /><ol><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/shoretel-brilliantly-simple'>ShoreTel - Brilliantly Simple?</a></li><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/the-google-photos-management-problems'>The Google Photos Management Problem(s)</a></li><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/creating-long-lasting-clickonce'>Creating a Long-Lasting ClickOnce Certificate</a></li><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/more-encrypted-config-filesclickonce'>More Encrypted Config Files–ClickOnce Complications</a></li></ol></li><li class='history-month'><label for='2015-7'>July</label><input type='checkbox'  id='2015-7' /><ol><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/encrypting-appconfig'>Encrypting app.config</a></li></ol></li><li class='history-month'><label for='2015-3'>March</label><input type='checkbox'  id='2015-3' /><ol><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/better-google-sites-designthe-notched'>Better Google Sites Design–The Notched Page</a></li><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/removing-unremovable-bluetooth-device'>Removing Unremovable Bluetooth Device: FAIL!</a></li></ol></li></ol></li><li class='history-year'><label for='2014'>2014</label><input type='checkbox'  id='2014' /><ol><li class='history-month'><label for='2014-11'>November</label><input type='checkbox'  id='2014-11' /><ol><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/how-to-remove-savernet-and-similar'>How to remove Savernet (and similar) Chrome extension</a></li></ol></li><li class='history-month'><label for='2014-9'>September</label><input type='checkbox'  id='2014-9' /><ol><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/prevent-word-from-restoring-minimized'>Prevent Word from Restoring Minimized Documents</a></li><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/clever-phish'>Clever Phish</a></li></ol></li><li class='history-month'><label for='2014-8'>August</label><input type='checkbox'  id='2014-8' /><ol><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/enable-synaptics-touchpad-2-finger-tap'>Enable Synaptics touchpad 2-finger tap context menu</a></li></ol></li><li class='history-month'><label for='2014-5'>May</label><input type='checkbox'  id='2014-5' /><ol><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/installing-fcm-flow-cytrometry-library'>Installing fcm flow cytrometry library on Windows 8.1</a></li></ol></li><li class='history-month'><label for='2014-4'>April</label><input type='checkbox'  id='2014-4' /><ol><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/windows-81-update-1-driver-problem-dtmb'>Windows 8.1 Update 1 Driver Problem DTMB BDA TV USB</a></li><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/windows-81-window-key-s-search-from'>Windows 8.1: Window Key + S = Search from Desktop</a></li></ol></li><li class='history-month'><label for='2014-3'>March</label><input type='checkbox'  id='2014-3' /><ol><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/whs-2011-windows-update-one-or-more'>WHS 2011 Windows Update “One or more services are no running” alert</a></li></ol></li><li class='history-month'><label for='2014-2'>February</label><input type='checkbox'  id='2014-2' /><ol><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/lenovo-u530-touch-wifi-problem-continued'>Lenovo U530 Touch WiFi Problem Continued</a></li></ol></li><li class='history-month'><label for='2014-1'>January</label><input type='checkbox'  id='2014-1' /><ol><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/lenovo-u530-touch-wifi-problem'>Lenovo U530 Touch WiFi Problem</a></li></ol></li></ol></li><li class='history-year'><label for='2013'>2013</label><input type='checkbox'  id='2013' /><ol><li class='history-month'><label for='2013-12'>December</label><input type='checkbox'  id='2013-12' /><ol><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/whs-connector-restart-error-in-windows'>WHS Connector Restart Error in Windows 8.0/8.1</a></li><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/how-to-remove-apps-from-google-play-my'>How to Remove Apps from Google Play My Apps Site</a></li></ol></li><li class='history-month'><label for='2013-11'>November</label><input type='checkbox'  id='2013-11' /><ol><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/windows-81-hidden-opt-ins-opt-outs'>Windows 8.1 Hidden Opt Ins/ Opt Outs</a></li></ol></li><li class='history-month'><label for='2013-9'>September</label><input type='checkbox'  id='2013-9' /><ol><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/edward-farley-epilogue'>Edward Farley and the Fantastic Library Epilogue</a></li></ol></li><li class='history-month'><label for='2013-7'>July</label><input type='checkbox'  id='2013-7' /><ol><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/a-week-or-more-of-jolicloud-day-2-end'>A Week (or More!) of JoliCloud - Day 2: THE END</a></li><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/a-week-or-more-of-jolicloud-day-1'>A Week (or More!) of JoliCloud - Day 1</a></li></ol></li><li class='history-month'><label for='2013-5'>May</label><input type='checkbox'  id='2013-5' /><ol><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/edward-farley-part-12'>Edward Farley and the Fantastic Library Part 12</a></li><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/edward-farley-part-1019'>Edward Farley and the Fantastic Library Part 11</a></li><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/edward-farley-part-10'>Edward Farley and the Fantastic Library Part 10</a></li><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/edward-farley-part-9'>Edward Farley and the Fantastic Library Part 9</a></li><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/edward-farley-part-8'>Edward Farley and the Fantastic Library Part 8</a></li><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/edward-farley-part-7'>Edward Farley and the Fantastic Library Part 7</a></li><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/edward-farley-part-6'>Edward Farley and the Fantastic Library Part 6</a></li><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/edward-farley-part-5'>Edward Farley and the Fantastic Library Part 5</a></li><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/edward-farley-part-4'>Edward Farley and the Fantastic Library Part 4</a></li><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/edward-farley-part-3'>Edward Farley and the Fantastic Library Part 3</a></li><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/edward-farley-part-2'>Edward Farley and the Fantastic Library Part 2</a></li><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/edward-farley-part-1'>Edward Farley and the Fantastic Library Part 1</a></li></ol></li><li class='history-month'><label for='2013-4'>April</label><input type='checkbox'  id='2013-4' /><ol><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/clean-up-orphaned-sql-users'>Clean Up Orphaned SQL Users</a></li></ol></li><li class='history-month'><label for='2013-3'>March</label><input type='checkbox'  id='2013-3' /><ol><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/t-sql-one-to-one-cant-be-done'>T-SQL One to One Can't Be Done</a></li></ol></li><li class='history-month'><label for='2013-1'>January</label><input type='checkbox'  id='2013-1' /><ol><li class='history-post'><a class='history-post' href='http://bladewolf55.gitlab.io/smblog/posts/test-post-with-code'>Migrating Google Drive</a></li></ol></li></ol></li></ol>
    </div>
  </nav>
  <header>
    <div id="site-image">
      <img src="http://bladewolf55.gitlab.io/smblog/images/header.png" alt="" />
    </div>
    <h1 id="site-name"></h1>
    <div id="site-subtitle">A pleasant walk through computing</div>
  </header>
  <section id="content">
    
              <div class='post'>
                <h2 class='post-title'><a href='http://bladewolf55.gitlab.io/smblog/posts/tfs-continuous-integration-walk-through_22'>TFS Continuous Integration Walk Through Part 5b - Multiple Solutions: Simple Project References</a></h2>
                <p class='post-info'><span class='posted-on'>2017-02-22 14:05</span></p>
                <div class='post-content'><p><a href="images/ci-logo_thumb_25255B1_25255D.png"><img src="http://bladewolf55.gitlab.io/smblog/posts/tfs-continuous-integration-walk-through_22/images/ci-logo_thumb_25255B1_25255D.png" title="ci-logo" alt="ci-logo" width="126" height="126"></a>This is part of a series of walk throughs exploring CI in TFS, starting from the ground up. The entire series and source code are maintained at this BitBucket repository.</p>
<p><a href="https://bitbucket.org/bladewolf55/tfs-ci-samples" class="uri">https://bitbucket.org/bladewolf55/tfs-ci-samples</a></p>
<p>Previous Part: <a href="http://www.softwaremeadows.com/2017/02/tfs-continuous-integration-walk-through_20.html">TFS Continuous Integration Walk Through Part 5a - Multiple Solutions - Overview</a></p>
<h1 id="a-new-beginning">A New Beginning</h1>
<p>One of my goals for the Multiple Solutions walkthroughs is to put the TFS repository in a, let's say, less than stellar organizational state, and then clean up. To do that, I'll start with a new, clean TFS collection.</p>
<p>Open TFS Administration Console, select Team Project Collections, and click Create Collection.</p>
<p><a href="images/2017-02-20_145443_thumb_25255B1_25255D.png"><img src="http://bladewolf55.gitlab.io/smblog/posts/tfs-continuous-integration-walk-through_22/images/2017-02-20_145443_thumb_25255B1_25255D.png" title="2017-02-20_145443" alt="2017-02-20_145443" width="755" height="573"></a></p>
<p>Choose a silly name like "CICollection2". Next.</p>
<p><a href="images/2017-02-20_145927_thumb_25255B1_25255D.png"><img src="http://bladewolf55.gitlab.io/smblog/posts/tfs-continuous-integration-walk-through_22/images/2017-02-20_145927_thumb_25255B1_25255D.png" title="2017-02-20_145927" alt="2017-02-20_145927" width="751" height="577"></a></p>
<p>Verify the SQL server instance and create a new database. Next, Verify, Create.</p>
<p><a href="images/2017-02-20_150035_thumb_25255B1_25255D.png"><img src="http://bladewolf55.gitlab.io/smblog/posts/tfs-continuous-integration-walk-through_22/images/2017-02-20_150035_thumb_25255B1_25255D.png" title="2017-02-20_150035" alt="2017-02-20_150035" width="745" height="572"></a></p>
<p>It'll take a few minute to create the collection. Click Complete, then Close. You can close the Admin Console, too.</p>
<p><a href="images/2017-02-20_150517_thumb_25255B1_25255D.png"><img src="http://bladewolf55.gitlab.io/smblog/posts/tfs-continuous-integration-walk-through_22/images/2017-02-20_150517_thumb_25255B1_25255D.png" title="2017-02-20_150517" alt="2017-02-20_150517" width="736" height="565"></a></p>
<h1 id="connect-visual-studio-to-the-new-collection">Connect Visual Studio to the New Collection</h1>
<blockquote>
<p><strong>Complaint</strong><br>
This was stupidly difficult to figure out. Google searches yielded nothing.</p>
</blockquote>
<p>Open Visual Studio and the Team Explorer, then open Manage Connections.</p>
<p><a href="images/2017-02-20_161007_thumb.png"><img src="http://bladewolf55.gitlab.io/smblog/posts/tfs-continuous-integration-walk-through_22/images/2017-02-20_161007_thumb.png" title="2017-02-20_161007" alt="2017-02-20_161007" width="452" height="184"></a></p>
<p>Drop down "Manage Connections" and choose Connect to Team Project.</p>
<p><a href="images/2017-02-20_161132_thumb.png"><img src="http://bladewolf55.gitlab.io/smblog/posts/tfs-continuous-integration-walk-through_22/images/2017-02-20_161132_thumb.png" title="2017-02-20_161132" alt="2017-02-20_161132" width="340" height="173"></a></p>
<p>Select CICollection2, then click Connect.</p>
<p><a href="images/2017-02-20_161318_thumb.png"><img src="http://bladewolf55.gitlab.io/smblog/posts/tfs-continuous-integration-walk-through_22/images/2017-02-20_161318_thumb.png" title="2017-02-20_161318" alt="2017-02-20_161318" width="639" height="468"></a></p>
<p>This is the first time I'm using this collection, so I need to map my TFS Workspaces.</p>
<blockquote>
<p><strong>Complaint</strong><br>
I <em>hate</em> TFS workspaces.</p>
</blockquote>
<p><a href="images/2017-02-20_161528_thumb.png"><img src="http://bladewolf55.gitlab.io/smblog/posts/tfs-continuous-integration-walk-through_22/images/2017-02-20_161528_thumb.png" title="2017-02-20_161528" alt="2017-02-20_161528" width="387" height="412"></a></p>
<p>Pick one of the "map workspaces" links, take the defaults, click Map &amp; Get.</p>
<p><a href="images/2017-02-20_161942_thumb.png"><img src="http://bladewolf55.gitlab.io/smblog/posts/tfs-continuous-integration-walk-through_22/images/2017-02-20_161942_thumb.png" title="2017-02-20_161942" alt="2017-02-20_161942" width="360" height="208"></a></p>
<p>Now I'm connected to the new collection.</p>
<p><a href="images/2017-02-20_162046_thumb.png"><img src="http://bladewolf55.gitlab.io/smblog/posts/tfs-continuous-integration-walk-through_22/images/2017-02-20_162046_thumb.png" title="2017-02-20_162046" alt="2017-02-20_162046" width="372" height="232"></a></p>
<h1 id="create-a-new-team-project">Create a new Team Project</h1>
<p>In Visual Studio Team Manager, create a new Team Project by choosing Home &gt; Projects &amp; My Teams &gt; Create Team Project.</p>
<p><a href="images/2017-02-20_162400_thumb.png"><img src="http://bladewolf55.gitlab.io/smblog/posts/tfs-continuous-integration-walk-through_22/images/2017-02-20_162400_thumb.png" title="2017-02-20_162400" alt="2017-02-20_162400" width="472" height="227"></a></p>
<p>Remember, one of my intentions is a messy collection. So, I'll name my team project Main. (I'm tempted to name it "Turing" and make life even worse, but this will do.) Click Next.</p>
<p><a href="images/2017-02-20_162607_thumb.png"><img src="http://bladewolf55.gitlab.io/smblog/posts/tfs-continuous-integration-walk-through_22/images/2017-02-20_162607_thumb.png" title="2017-02-20_162607" alt="2017-02-20_162607" width="630" height="519"></a></p>
<p>The default Agile process is fine. Next.</p>
<p><a href="images/2017-02-20_162652_thumb.png"><img src="http://bladewolf55.gitlab.io/smblog/posts/tfs-continuous-integration-walk-through_22/images/2017-02-20_162652_thumb.png" title="2017-02-20_162652" alt="2017-02-20_162652" width="630" height="519"></a></p>
<p>We're sticking with Team Foundation Version Control. Click Finish.</p>
<p><a href="images/2017-02-20_162805_thumb.png"><img src="http://bladewolf55.gitlab.io/smblog/posts/tfs-continuous-integration-walk-through_22/images/2017-02-20_162805_thumb.png" title="2017-02-20_162805" alt="2017-02-20_162805" width="630" height="519"></a></p>
<p>After a few seconds our team project is created.</p>
<p><a href="images/2017-02-20_162930_thumb.png"><img src="http://bladewolf55.gitlab.io/smblog/posts/tfs-continuous-integration-walk-through_22/images/2017-02-20_162930_thumb.png" title="2017-02-20_162930" alt="2017-02-20_162930" width="630" height="519"></a></p>
<h1 id="add-the-turingdesktop-solution">Add the TuringDesktop Solution</h1>
<p>In Visual Studio, create a new Console project. In the dialog, check the Add to Source Control box.</p>
<p><a href="images/2017-02-20_163059_thumb_25255B1_25255D.png"><img src="http://bladewolf55.gitlab.io/smblog/posts/tfs-continuous-integration-walk-through_22/images/2017-02-20_163059_thumb_25255B1_25255D.png" title="2017-02-20_163059" alt="2017-02-20_163059" width="739" height="522"></a></p>
<p>In the source control dialog, accept the defaults. We're adding our solution folder to the root.</p>
<p><a href="images/2017-02-20_163216_thumb.png"><img src="http://bladewolf55.gitlab.io/smblog/posts/tfs-continuous-integration-walk-through_22/images/2017-02-20_163216_thumb.png" title="2017-02-20_163216" alt="2017-02-20_163216" width="547" height="556"></a></p>
<p>So, right now our TFS collection structure is:</p>
<div class="sourceCode"><pre class="sourceCode csharp"><code class="sourceCode cs">CICollection2
|_$/Main
|_TuringDesktop</code></pre></div>
<p>If you remember from the previous part, our desktop app is going to have two dependencies: the Magic8Engine, and TextColor. Right now, I don't know Magic8 is going to be a shared NuGet package, so I just add it as a new Class Library project. The same with TextColor.</p>
<p>I'm also going to need a unit test project, so I'll add an MSTest project now as well. I'm going to name it TuringDesktop.Tests, even though it's going to contain tests for all my projects.</p>
<p><a href="images/2017-02-20_164651_thumb_25255B1_25255D.png"><img src="http://bladewolf55.gitlab.io/smblog/posts/tfs-continuous-integration-walk-through_22/images/2017-02-20_164651_thumb_25255B1_25255D.png" title="2017-02-20_164651" alt="2017-02-20_164651" width="741" height="524"></a></p>
<p>In the end, this is my solution's folder structure.</p>
<p><a href="images/2017-02-20_164939_thumb.png"><img src="http://bladewolf55.gitlab.io/smblog/posts/tfs-continuous-integration-walk-through_22/images/2017-02-20_164939_thumb.png" title="2017-02-20_164939" alt="2017-02-20_164939" width="288" height="214"></a></p>
<h1 id="our-first-suite">Our First Suite</h1>
<p><strong>References</strong></p>
<p><a href="http://stackoverflow.com/a/9663588/1628707">Assign TextWriter to MemoryWriter</a><br>
<a href="http://stackoverflow.com/a/5852991/1628707">Mocking System Console Behaviour</a><br>
<a href="https://en.wikipedia.org/wiki/Magic_8-Ball">Magic 8-Ball</a></p>
<p>Below is all the code and tests for the solution. This is my super-pre-release versions, and has some (mostly intentional) problems.</p>
<h2 id="the-solution-projects">The Solution Projects</h2>
<p>Right now I've got everything in one solution. I'll explain each project in turn.</p>
<h3 id="turingdesktop">TuringDesktop</h3>
<p>This is a Console application. It references the Magic8Engine and TextColor projects.</p>
<p><a href="images/2017-02-22_102302_thumb.png"><img src="http://bladewolf55.gitlab.io/smblog/posts/tfs-continuous-integration-walk-through_22/images/2017-02-22_102302_thumb.png" title="2017-02-22_102302" alt="2017-02-22_102302" width="700" height="357"></a></p>
<p>I'm simulating a database with a class that returns a list of answers, and is initialized with a connection string. For this simple sample, the connection string is just a name like "production". If the connection string is named something other than "production", then the name is prepended to each answer. For example, if the connection string were "stage", an answer might be "STAGE: It is certain."</p>
<div class="sourceCode"><pre class="sourceCode csharp"><code class="sourceCode cs"><span class="kw">using</span> System;
<span class="kw">using</span> System.<span class="fu">Collections</span>.<span class="fu">Generic</span>;
<span class="kw">using</span> System.<span class="fu">Linq</span>;

<span class="kw">namespace</span> TuringDesktop
{
<span class="kw">public</span> <span class="kw">static</span> <span class="kw">class</span> AnswerDatabase
{
<span class="co">/// </span><span class="kw">&lt;summary&gt;</span>
<span class="co">/// Any dbName other than "prod" prepends answers with dbName.</span>
<span class="co">/// Ex. dbName = "stage", then answer is "STAGE: It could be so."</span>
<span class="co">/// </span><span class="kw">&lt;/summary&gt;</span>
<span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"connectionString"</span><span class="kw">&gt;&lt;/param&gt;</span>
<span class="kw">public</span> <span class="kw">static</span> IEnumerable&lt;<span class="dt">string</span>&gt; <span class="fu">GetAnswers</span>(<span class="dt">string</span> connectionString)
{
<span class="kw">if</span> (String.<span class="fu">IsNullOrWhiteSpace</span>(connectionString))
{
<span class="kw">throw</span> <span class="kw">new</span> <span class="fu">ArgumentException</span>(<span class="st">"dbName cannot be null or empty"</span>);
}
<span class="kw">if</span> (connectionString == <span class="st">"production"</span>)
{
<span class="kw">return</span> DefaultAnswers;
}
<span class="kw">else</span>
{
<span class="kw">return</span> DefaultAnswers.<span class="fu">Select</span>(a =&gt; connectionString.<span class="fu">ToUpper</span>() + <span class="st">": "</span> + a);
}
}

<span class="kw">private</span> <span class="kw">static</span> IEnumerable&lt;<span class="dt">string</span>&gt; DefaultAnswers
{
get
{
<span class="kw">yield</span> <span class="kw">return</span> <span class="st">"It is certain"</span>;
<span class="kw">yield</span> <span class="kw">return</span> <span class="st">"It is decidedly so"</span>;
<span class="kw">yield</span> <span class="kw">return</span> <span class="st">"Without a doubt"</span>;
<span class="kw">yield</span> <span class="kw">return</span> <span class="st">"Yes, definitely"</span>;
<span class="kw">yield</span> <span class="kw">return</span> <span class="st">"You may rely on it"</span>;
<span class="kw">yield</span> <span class="kw">return</span> <span class="st">"As I see it, yes"</span>;
<span class="kw">yield</span> <span class="kw">return</span> <span class="st">"Most likely"</span>;
<span class="kw">yield</span> <span class="kw">return</span> <span class="st">"Outlook good"</span>;
<span class="kw">yield</span> <span class="kw">return</span> <span class="st">"Yes"</span>;
<span class="kw">yield</span> <span class="kw">return</span> <span class="st">"Signs point to yes"</span>;
<span class="kw">yield</span> <span class="kw">return</span> <span class="st">"Reply hazy try again"</span>;
<span class="kw">yield</span> <span class="kw">return</span> <span class="st">"Ask again later"</span>;
<span class="kw">yield</span> <span class="kw">return</span> <span class="st">"Better not tell you now"</span>;
<span class="kw">yield</span> <span class="kw">return</span> <span class="st">"Cannot predict now"</span>;
<span class="kw">yield</span> <span class="kw">return</span> <span class="st">"Concentrate and ask again"</span>;
<span class="kw">yield</span> <span class="kw">return</span> <span class="st">"Don't count on it"</span>;
<span class="kw">yield</span> <span class="kw">return</span> <span class="st">"My reply is no"</span>;
<span class="kw">yield</span> <span class="kw">return</span> <span class="st">"My sources say no"</span>;
<span class="kw">yield</span> <span class="kw">return</span> <span class="st">"Outlook not so good"</span>;
<span class="kw">yield</span> <span class="kw">return</span> <span class="st">"Very doubtful"</span>;
}
}
}
}</code></pre></div>
<p>Here's the Program class with my <code>Main</code> code. There are a few things to note:</p>
<ul>
<li>I removed the args parameter from the <code>Main</code> method. I don't need it.</li>
<li>I made the <code>Main</code> method public, so it can be call from unit tests.</li>
<li>I'm using Dependency Injection for the answer engine (<code>Oracle</code>) and the console text colorizer (<code>ConsoleColorizer</code>).</li>
<li>There are three settings using a string literal: <code>_connectionString</code>, <code>questionColor</code> and <code>answerColor</code>.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode csharp"><code class="sourceCode cs"><span class="kw">using</span> System;
<span class="kw">using</span> TextColor;
<span class="kw">using</span> Magic8Engine;

<span class="kw">namespace</span> TuringDesktop
{
<span class="kw">public</span> <span class="kw">class</span> Program
{
<span class="kw">static</span> <span class="dt">string</span> _connectionString = <span class="st">"production"</span>;
<span class="kw">static</span> IConsoleColorizer _colorizer = <span class="kw">new</span> <span class="fu">ConsoleColorizer</span>();
<span class="kw">static</span> IOracle _oracle = <span class="kw">new</span> <span class="fu">Oracle</span>(AnswerDatabase.<span class="fu">GetAnswers</span>(_connectionString));

<span class="kw">public</span> <span class="fu">Program</span>() { }
<span class="kw">public</span> <span class="fu">Program</span>(IConsoleColorizer colorizer, IOracle oracle)
{
_colorizer = colorizer;
_oracle = oracle;
}

<span class="kw">public</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span>()
{
<span class="dt">string</span> name = <span class="st">""</span>;
<span class="dt">string</span> answer = <span class="st">""</span>;
<span class="dt">string</span> question = <span class="st">""</span>;
<span class="dt">string</span> questionColor = <span class="st">"Red"</span>;
<span class="dt">string</span> answerColor = <span class="st">"green"</span>;

Console.<span class="fu">Write</span>(<span class="st">"Welcome! I'm AT. Please tell me your name. &gt;&gt; "</span>);
name = Console.<span class="fu">ReadLine</span>();
Console.<span class="fu">WriteLine</span>(<span class="st">"Good to meet you, "</span> + name + <span class="st">". "</span>
+ <span class="st">"Ask me a yes-or-no question and I'll give you an answer. "</span>
+ <span class="st">"When you're finished, say 'bye'."</span>);
<span class="kw">do</span>
{
<span class="kw">try</span>
{
_colorizer.<span class="fu">ColorizeWriteLine</span>(<span class="st">"Question?"</span>, questionColor);
question = Console.<span class="fu">ReadLine</span>();
<span class="kw">if</span> (question.<span class="fu">ToLower</span>() == <span class="st">"bye"</span>) { <span class="kw">break</span>; }
answer = _oracle.<span class="fu">GetAnswer</span>();
_colorizer.<span class="fu">ColorizeWriteLine</span>(answer, answerColor);
Console.<span class="fu">WriteLine</span>();
}
<span class="kw">catch</span> (Exception ex)
{
Console.<span class="fu">WriteLine</span>(<span class="st">"Error: "</span> + ex.<span class="fu">GetBaseException</span>().<span class="fu">Message</span>);
Console.<span class="fu">Write</span>(<span class="st">"Press any key to quit."</span>);
Console.<span class="fu">Read</span>();
<span class="kw">return</span>;
}
}
<span class="kw">while</span> (<span class="kw">true</span>);
}
}
}</code></pre></div>
<p>The program's output is simple enough. It greets the user, asks for a name, then starts answering questions. Text coloring is used to make things clear.</p>
<p><a href="images/2017-02-22_105715_thumb.png"><img src="http://bladewolf55.gitlab.io/smblog/posts/tfs-continuous-integration-walk-through_22/images/2017-02-22_105715_thumb.png" title="2017-02-22_105715" alt="2017-02-22_105715" width="572" height="336"></a></p>
<h3 id="magic8engine">Magic8Engine</h3>
<p>I have an IOracle inteface, so that it's easier to use in unit tests.</p>
<div class="sourceCode"><pre class="sourceCode csharp"><code class="sourceCode cs"><span class="kw">namespace</span> Magic8Engine
{
<span class="kw">public</span> <span class="kw">interface</span> IOracle
{
<span class="dt">string</span> <span class="fu">GetAnswer</span>();
}
}</code></pre></div>
<p>The concrete class is initialized with a list of answers (the "database") from which it randomly selects.</p>
<div class="sourceCode"><pre class="sourceCode csharp"><code class="sourceCode cs"><span class="kw">using</span> System;
<span class="kw">using</span> System.<span class="fu">Collections</span>.<span class="fu">Generic</span>;
<span class="kw">using</span> System.<span class="fu">Linq</span>;

<span class="kw">namespace</span> Magic8Engine
{
<span class="kw">public</span> <span class="kw">class</span> Oracle : IOracle
{
Random _random = <span class="kw">new</span> <span class="fu">Random</span>();
<span class="kw">private</span> IEnumerable&lt;<span class="dt">string</span>&gt; _answers = <span class="kw">new</span> List&lt;<span class="dt">string</span>&gt;();

<span class="kw">public</span> <span class="fu">Oracle</span>(IEnumerable&lt;<span class="dt">string</span>&gt; answers)
{
_answers = answers;
}

<span class="kw">public</span> <span class="dt">string</span> <span class="fu">GetAnswer</span>()
{
<span class="kw">if</span> (_answers.<span class="fu">Count</span>() == <span class="dv">0</span>)
{
<span class="kw">return</span> <span class="st">""</span>;
}
<span class="dt">int</span> index = _random.<span class="fu">Next</span>(_answers.<span class="fu">Count</span>());
<span class="kw">return</span> _answers.<span class="fu">ToArray</span>()[index];
}
}
}</code></pre></div>
<h3 id="textcolor">TextColor</h3>
<p>The ConsoleColorizer class also implements an interface to improve unit testing.</p>
<div class="sourceCode"><pre class="sourceCode csharp"><code class="sourceCode cs"><span class="kw">using</span> System;

<span class="kw">namespace</span> TextColor
{
<span class="kw">public</span> <span class="kw">interface</span> IConsoleColorizer
{
<span class="dt">void</span> <span class="fu">ColorizeWriteLine</span>(<span class="dt">string</span> text, <span class="dt">string</span> colorName, <span class="dt">bool</span> resetColor = <span class="kw">true</span>);
ConsoleColor <span class="fu">GetConsoleColor</span>(<span class="dt">string</span> colorName);
<span class="dt">void</span> <span class="fu">ResetConsoleColor</span>();
<span class="dt">void</span> <span class="fu">SetConsoleColor</span>(<span class="dt">string</span> colorName);
}
}</code></pre></div>
<p>The concrete class sets properties on the Console object.</p>
<div class="sourceCode"><pre class="sourceCode csharp"><code class="sourceCode cs"><span class="kw">using</span> System;

<span class="kw">namespace</span> TextColor
{
<span class="kw">public</span> <span class="kw">class</span> ConsoleColorizer : IConsoleColorizer
{
<span class="kw">public</span> <span class="dt">void</span> <span class="fu">ColorizeWriteLine</span>(<span class="dt">string</span> text, <span class="dt">string</span> colorName, <span class="dt">bool</span> resetColor = <span class="kw">true</span>)
{
<span class="fu">SetConsoleColor</span>(colorName);
Console.<span class="fu">WriteLine</span>(text);
<span class="kw">if</span> (resetColor) { Console.<span class="fu">ResetColor</span>(); }
}

<span class="kw">public</span> ConsoleColor <span class="fu">GetConsoleColor</span>(<span class="dt">string</span> colorName)
{
ConsoleColor color;
<span class="kw">if</span> (Enum.<span class="fu">TryParse</span>&lt;ConsoleColor&gt;(colorName, <span class="kw">true</span>, <span class="kw">out</span> color))
{
<span class="kw">return</span> color;
}
<span class="kw">else</span>
{
<span class="kw">throw</span> <span class="kw">new</span> <span class="fu">ArgumentException</span>(<span class="st">"Invalid ConsoleColor: "</span> + colorName);
}
}

<span class="kw">public</span> <span class="dt">void</span> <span class="fu">SetConsoleColor</span>(<span class="dt">string</span> colorName)
{
Console.<span class="fu">ForegroundColor</span> = <span class="fu">GetConsoleColor</span>(colorName);
}

<span class="kw">public</span> <span class="dt">void</span> <span class="fu">ResetConsoleColor</span>()
{
Console.<span class="fu">ResetColor</span>();
}
}
}</code></pre></div>
<p>This should raise a red flag. <code>System.Console</code> is a dependency. Why didn't I abstract that out? I could have. For example, I could have created an IConsole interface with just the features I'm using, then an explicit SystemConsole wrapper class that implented the interface. But it turned out I could test Console successfully without needing to make it entirely replacable.</p>
<p>Good question though. Glad you're thinking.</p>
<h3 id="tests">Tests</h3>
<p>Finally, our test project has a class for each project we're testing.</p>
<p><a href="images/2017-02-22_112309_thumb.png"><img src="http://bladewolf55.gitlab.io/smblog/posts/tfs-continuous-integration-walk-through_22/images/2017-02-22_112309_thumb.png" title="2017-02-22_112309" alt="2017-02-22_112309" width="248" height="141"></a></p>
<p>Here are the unit tests for each project. I'm using nested classes to keep the tests readable.</p>
<h4 id="magic8-tests">Magic8 Tests</h4>
<p>Note how these test make use of passing in a custom "answer database".</p>
<div class="sourceCode"><pre class="sourceCode csharp"><code class="sourceCode cs"><span class="kw">using</span> System.<span class="fu">Collections</span>.<span class="fu">Generic</span>;
<span class="kw">using</span> System.<span class="fu">Linq</span>;
<span class="kw">using</span> Microsoft.<span class="fu">VisualStudio</span>.<span class="fu">TestTools</span>.<span class="fu">UnitTesting</span>;
<span class="kw">using</span> Magic8Engine;

<span class="kw">namespace</span> TuringDesktop.<span class="fu">Tests</span>
{
[TestClass]
<span class="kw">public</span> <span class="kw">class</span> OracleClass
{
[TestClass]
<span class="kw">public</span> <span class="kw">class</span> GetAnswer_Should: OracleClass
{
<span class="kw">static</span> List&lt;<span class="dt">string</span>&gt; _answers;

[TestInitialize]
<span class="kw">public</span> <span class="dt">void</span> <span class="fu">TestInitialize</span>()
{
<span class="co">//Start each test with empty list;</span>
_answers = <span class="kw">new</span> List&lt;<span class="dt">string</span>&gt;();
}

[TestMethod]
<span class="kw">public</span> <span class="dt">void</span> <span class="fu">ReturnARandomAnswerEachTimeItIsCalled</span>()
{
<span class="co">//arrange</span>
_answers.<span class="fu">AddRange</span>(<span class="kw">new</span> <span class="dt">string</span>[] { <span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span> });
<span class="dt">var</span> oracle = <span class="kw">new</span> <span class="fu">Oracle</span>(_answers);
<span class="co">//act</span>
List&lt;<span class="dt">string</span>&gt; answers = <span class="kw">new</span> List&lt;<span class="dt">string</span>&gt;();
<span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; <span class="dv">10</span>; i++)
{
answers.<span class="fu">Add</span>(oracle.<span class="fu">GetAnswer</span>());
}
<span class="dt">int</span> uniqueAnswers = answers.<span class="fu">Distinct</span>().<span class="fu">Count</span>();
<span class="co">//assert</span>
Assert.<span class="fu">IsTrue</span>(uniqueAnswers &gt; <span class="dv">1</span>);
}

[TestMethod]
<span class="kw">public</span> <span class="dt">void</span> <span class="fu">ReturnAnEmptyAnswerIfAnswerListIsEmpty</span>()
{
<span class="co">//arrange</span>
<span class="dt">var</span> oracle = <span class="kw">new</span> <span class="fu">Oracle</span>(_answers);
<span class="co">//act</span>
<span class="dt">string</span> actual = oracle.<span class="fu">GetAnswer</span>();
<span class="co">//assert</span>
Assert.<span class="fu">AreEqual</span>(<span class="st">""</span>, actual, <span class="st">"Answer list count: "</span> + _answers.<span class="fu">Count</span>());
}
}
}
}</code></pre></div>
<h4 id="textcolor-tests">TextColor Tests</h4>
<p>Neither of these tests confirms the correct color gets set. That's really something best left to a human to verify. But notice in <code>WriteTheUserEnteredString</code> how I'm using the Console.SetOut property to let me verify that user input actually gets written to the console.</p>
<div class="sourceCode"><pre class="sourceCode csharp"><code class="sourceCode cs"><span class="kw">using</span> System;
<span class="kw">using</span> Microsoft.<span class="fu">VisualStudio</span>.<span class="fu">TestTools</span>.<span class="fu">UnitTesting</span>;
<span class="kw">using</span> System.<span class="fu">IO</span>;
<span class="kw">using</span> TextColor;

<span class="kw">namespace</span> TuringDesktop.<span class="fu">Tests</span>
{
[TestClass]
<span class="kw">public</span> <span class="kw">class</span> ConsoleColorizerClass
{
[TestClass]
<span class="kw">public</span> <span class="kw">class</span> GetConsoleColor_Should
{
[TestMethod]
<span class="kw">public</span> <span class="dt">void</span> <span class="fu">ReturnTheEnumUsingCaseInsensitive</span>()
{
<span class="co">//arrange</span>
<span class="dt">var</span> tc = <span class="kw">new</span> <span class="fu">ConsoleColorizer</span>();
<span class="dt">string</span> colorName = <span class="st">"gReEn"</span>;
Exception actualEx = <span class="kw">null</span>;
<span class="dt">string</span> errorMsg = <span class="st">""</span>;
<span class="co">//Will change to Green below.</span>
ConsoleColor color = ConsoleColor.<span class="fu">Black</span>;
<span class="co">//act</span>
<span class="kw">try</span>
{
color = tc.<span class="fu">GetConsoleColor</span>(colorName);
}
<span class="kw">catch</span> (Exception ex) { actualEx = ex; errorMsg = <span class="st">"Threw error "</span> + ex.<span class="fu">GetBaseException</span>().<span class="fu">Message</span>; }
Assert.<span class="fu">IsNull</span>(actualEx, errorMsg);
Assert.<span class="fu">AreEqual</span>(ConsoleColor.<span class="fu">Green</span>, color);
}

[TestMethod]
<span class="kw">public</span> <span class="dt">void</span> <span class="fu">WriteTheUserEnteredString</span>()
{
<span class="co">//arrange</span>
<span class="co">//Store the Console output in a stringwriter.</span>
StringWriter sw = <span class="kw">new</span> <span class="fu">StringWriter</span>();
Console.<span class="fu">SetOut</span>(sw);
<span class="dt">var</span> tc = <span class="kw">new</span> <span class="fu">ConsoleColorizer</span>();
<span class="co">//act</span>
tc.<span class="fu">ColorizeWriteLine</span>(<span class="st">"blamo"</span>, <span class="st">"Red"</span>);
<span class="co">//assert</span>
Assert.<span class="fu">AreEqual</span>(<span class="st">"blamo</span><span class="sc">\r\n</span><span class="st">"</span>, sw.<span class="fu">ToString</span>());
}
}
}
}</code></pre></div>
<h4 id="console-app-tests">Console App Tests</h4>
<p>If you're thinking the <code>Main</code> method should be refactored, you're right. I'll do that later. For now, it's interesting to see how we <em>can</em> test a console app.</p>
<p>First, I'll create my mock objects. I'm not even checking MockOracle's <code>GetAnswer</code> method, but that's OK. What I'm guaranteeing is my unit tests have no external dependencies.</p>
<p><strong>MockOracle</strong></p>
<div class="sourceCode"><pre class="sourceCode csharp"><code class="sourceCode cs"><span class="kw">public</span> <span class="kw">class</span> MockOracle : Magic8Engine.<span class="fu">IOracle</span>
{
<span class="kw">public</span> <span class="dt">string</span> <span class="fu">GetAnswer</span>()
{
<span class="kw">return</span> <span class="st">"This is a fake answer"</span>;
}
}</code></pre></div>
<p><strong>MockColorizer</strong></p>
<p>In this mock, I store the simulated user's input in a list, and I always return a black console color. I don't set or reset console colors.</p>
<blockquote>
<p><strong>Important</strong><br>
Remember, I'm not testing if the colorizer works. There are already unit tests for that. I'm testing if the Main method works. I just need my mock objects to return consistent results quickly.</p>
</blockquote>
<div class="sourceCode"><pre class="sourceCode csharp"><code class="sourceCode cs"><span class="kw">public</span> <span class="kw">class</span> MockColorizer : TextColor.<span class="fu">IConsoleColorizer</span>
{
<span class="kw">public</span> List&lt;<span class="dt">string</span>&gt; ConsoleLines = <span class="kw">new</span> List&lt;<span class="dt">string</span>&gt;();


<span class="kw">public</span> <span class="dt">void</span> <span class="fu">ColorizeWriteLine</span>(<span class="dt">string</span> text, <span class="dt">string</span> colorName, <span class="dt">bool</span> resetColor = <span class="kw">true</span>)
{
ConsoleLines.<span class="fu">Add</span>(text);
}

<span class="kw">public</span> ConsoleColor <span class="fu">GetConsoleColor</span>(<span class="dt">string</span> colorName)
{
<span class="kw">return</span> ConsoleColor.<span class="fu">Black</span>;
}

<span class="kw">public</span> <span class="dt">void</span> <span class="fu">ResetConsoleColor</span>() { }

<span class="kw">public</span> <span class="dt">void</span> <span class="fu">SetConsoleColor</span>(<span class="dt">string</span> colorName) { }
}</code></pre></div>
<p>Here are the tests for the <code>Main</code> method. Notice how I'm using StringWriters for both Console.In and Console.Out. This lets me buffer all the responses a user would make, and capture the console's output. I use a couple of helper methods to make this work.</p>
<p>What I'm <em>not</em> trying to do is test if Console works. I'm testing if I'm my code that writes to the console works. But, unfortunately, I do have a dependency on Console.</p>
<blockquote>
<p>So, are these unit tests, or integration tests? Short answer: integration. I'll make some improvements later to isolate code that doesn't depend on Console.</p>
</blockquote>
<p>There's a real danger here that I'll forget to use <code>SendUserInputs</code>, leading to the application hanging. I know this danger exists because I did it. The tests are brittle.</p>
<div class="sourceCode"><pre class="sourceCode csharp"><code class="sourceCode cs">[TestClass]
<span class="kw">public</span> <span class="kw">class</span> ProgramClass
{
[TestClass]
<span class="kw">public</span> <span class="kw">class</span> Main_Should
{
StringWriter _consoleOut = <span class="kw">new</span> <span class="fu">StringWriter</span>();
<span class="dt">string</span> UserInputs = <span class="st">""</span>;

[TestInitialize]
<span class="kw">public</span> <span class="dt">void</span> <span class="fu">TestInitialize</span>()
{
<span class="co">//Store the Console output in a stringwriter.</span>
Console.<span class="fu">SetOut</span>(_consoleOut);
}

[TestMethod]
<span class="kw">public</span> <span class="dt">void</span> <span class="fu">DisplayInitialGreetingMessage</span>()
{
<span class="co">//arrange</span>
<span class="fu">AddUserInput</span>(<span class="st">"Charles"</span>);
<span class="fu">AddUserInput</span>(<span class="st">"bye"</span>);
<span class="fu">SendUserInputs</span>();
<span class="dt">var</span> mockColorizer = <span class="kw">new</span> <span class="fu">MockColorizer</span>();
<span class="dt">var</span> mockOracle = <span class="kw">new</span> <span class="fu">MockOracle</span>();
<span class="dt">var</span> program = <span class="kw">new</span> <span class="fu">Program</span>(mockColorizer, mockOracle);
<span class="dt">string</span> expected = <span class="st">"Welcome! I'm AT. Please tell me your name."</span>;
<span class="co">//act</span>
Program.<span class="fu">Main</span>();
<span class="co">//assert</span>
<span class="dt">string</span> output = _consoleOut.<span class="fu">ToString</span>();
Assert.<span class="fu">IsTrue</span>(output.<span class="fu">IndexOf</span>(expected) &gt;= <span class="dv">0</span>);
}

[TestMethod]
<span class="kw">public</span> <span class="dt">void</span> <span class="fu">DisplayWelcomeWithName</span>()
{
<span class="co">//arrange</span>
<span class="fu">AddUserInput</span>(<span class="st">"Charles"</span>);
<span class="fu">AddUserInput</span>(<span class="st">"bye"</span>);
<span class="fu">SendUserInputs</span>();
<span class="dt">var</span> mockColorizer = <span class="kw">new</span> <span class="fu">MockColorizer</span>();
<span class="dt">var</span> mockOracle = <span class="kw">new</span> <span class="fu">MockOracle</span>();
<span class="dt">var</span> program = <span class="kw">new</span> <span class="fu">Program</span>(mockColorizer, mockOracle);
<span class="dt">string</span> expected = <span class="st">"Good to meet you, Charles."</span>;
<span class="co">//act</span>
Program.<span class="fu">Main</span>();
<span class="co">//</span>
<span class="co">//assert</span>
<span class="dt">string</span> output = _consoleOut.<span class="fu">ToString</span>();
Assert.<span class="fu">IsTrue</span>(output.<span class="fu">IndexOf</span>(expected) &gt;= <span class="dv">0</span>, <span class="st">"Output was: "</span> + output);
}

<span class="dv">#region "Test Helpers"</span>
<span class="kw">private</span> <span class="dt">void</span> <span class="fu">AddUserInput</span>(<span class="dt">string</span> value)
{
UserInputs += value + Environment.<span class="fu">NewLine</span>;
}

<span class="kw">private</span> <span class="dt">void</span> <span class="fu">SendUserInputs</span>()
{
<span class="co">//Send all the inputs needed for the Read and ReadLine statements</span>
StringReader consoleIn = <span class="kw">new</span> <span class="fu">StringReader</span>(UserInputs);
Console.<span class="fu">SetIn</span>(consoleIn);
}
<span class="dv">#endregion</span>
}
}</code></pre></div>
<p>Running my tests, I get nice, readable output.</p>
<p><a href="images/2017-02-22_115207_thumb.png"><img src="http://bladewolf55.gitlab.io/smblog/posts/tfs-continuous-integration-walk-through_22/images/2017-02-22_115207_thumb.png" title="2017-02-22_115207" alt="2017-02-22_115207" width="370" height="390"></a></p>
<h1 id="initial-continuous-integration-build-definition">Initial Continuous Integration Build Definition</h1>
<p>In Visual Studio Team Explorer, click Builds.</p>
<p><a href="images/2017-02-22_115629_thumb.png"><img src="http://bladewolf55.gitlab.io/smblog/posts/tfs-continuous-integration-walk-through_22/images/2017-02-22_115629_thumb.png" title="2017-02-22_115629" alt="2017-02-22_115629" width="352" height="316"></a></p>
<p>Click New Build Definition.</p>
<p><a href="images/2017-02-22_115709_thumb.png"><img src="http://bladewolf55.gitlab.io/smblog/posts/tfs-continuous-integration-walk-through_22/images/2017-02-22_115709_thumb.png" title="2017-02-22_115709" alt="2017-02-22_115709" width="367" height="261"></a></p>
<p>This will open the web page and prompt for a definition. This is nice because we're taken directly to our team project builds.</p>
<p><a href="images/2017-02-22_115934_thumb_25255B1_25255D.png"><img src="http://bladewolf55.gitlab.io/smblog/posts/tfs-continuous-integration-walk-through_22/images/2017-02-22_115934_thumb_25255B1_25255D.png" title="2017-02-22_115934" alt="2017-02-22_115934" width="736" height="408"></a></p>
<p>Choose the Visual Studio template, check the box that says Continuous Integration and accept the defaults. Save the definition, naming it TuringDesktop Suite Build.</p>
<p>If you've been following along, you'll realize that we've never committed <em>any</em> of our source code! Do so now and the build should happen automatically and successfully. Be sure to verify that all the tests ran!</p>
<p><a href="images/2017-02-22_122709_thumb.png"><img src="http://bladewolf55.gitlab.io/smblog/posts/tfs-continuous-integration-walk-through_22/images/2017-02-22_122709_thumb.png" title="2017-02-22_122709" alt="2017-02-22_122709" width="521" height="277"></a></p>
<p><a href="images/2017-02-22_122936_thumb.png"><img src="http://bladewolf55.gitlab.io/smblog/posts/tfs-continuous-integration-walk-through_22/images/2017-02-22_122936_thumb.png" title="2017-02-22_122936" alt="2017-02-22_122936" width="583" height="165"></a></p>
<h1 id="next-up">Next Up</h1>
<p>We have a working application that's automatically built in our CI server. But we've also got some problems:</p>
<ul>
<li>Refactoring for the main application's Console dependency.</li>
<li>String literals for settings.</li>
<li>Our application's data source is the same in development, CI, and production.</li>
<li>No separate integration tests.</li>
</ul>
<p>In short, we're about to go from nice, sunny sample development to real-world, why-does-this-have-to-be-so-hard programming.</p>
<p>Next Part: <a href="#">TFS Continuous Integration Walk Through Part 5c - Multiple Solutions: Build Settings</a></p>
</div>
              </div>
              
  </section>
  <!-- posts only appear in home index -->
  <section id="posts">
    
    
  </section>
  <footer><p>Copyright (c) 2018 Charles L Flatt</p>
</footer>
  
</body>

</html>