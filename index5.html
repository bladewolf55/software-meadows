<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <script src='http://www.softwaremeadows.com/header-scripts/prism.js'></script>

  <link rel='stylesheet' href='http://www.softwaremeadows.com/css/default.css' />
<link rel='stylesheet' href='http://www.softwaremeadows.com/css/prism.css' />


  <title>Home | Software Meadows</title>
</head>

<body>
  <nav>
    <div id="menu">
      <ol>
<li><a href="http://www.softwaremeadows.com/">Home</a></li>
<li><a href="http://www.softwaremeadows.com/about">About</a></li>
</ol>

    </div>
    <div id="recent">
      <h2>Recent</h2>
      <a href='http://www.softwaremeadows.com/posts/create_blog_post_using_markdown_monster_command_addin'>Create Blog Post Using Markdown Monster's Command Addin</a><a href='http://www.softwaremeadows.com/posts/batch_image_resize_checking_min_max_in_both_dimensions'>Batch Image Resize Checking Min Max in Both Dimensions</a><a href='http://www.softwaremeadows.com/posts/announcing_deepshadow'>Announcing DeepShadow</a><a href='http://www.softwaremeadows.com/posts/announcing_deftconfig'>Announcing DeftConfig</a><a href='http://www.softwaremeadows.com/posts/tfs_2015_publish_asp_net_using_robocopy'>TFS 2015: Publish ASP.NET Using Robocopy</a>
    </div>
    <div id="history">
      <h2>History</h2>
      <ol class='tree'><li class='history-year'><label for='2018'>2018</label><input type='checkbox'  id='2018' /><ol><li class='history-month'><label for='2018-4'>April</label><input type='checkbox'  id='2018-4' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/create_blog_post_using_markdown_monster_command_addin'>Create Blog Post Using Markdown Monster's Command Addin</a></li></ol></li><li class='history-month'><label for='2018-3'>March</label><input type='checkbox'  id='2018-3' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/batch_image_resize_checking_min_max_in_both_dimensions'>Batch Image Resize Checking Min Max in Both Dimensions</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/announcing_deepshadow'>Announcing DeepShadow</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/announcing_deftconfig'>Announcing DeftConfig</a></li></ol></li><li class='history-month'><label for='2018-1'>January</label><input type='checkbox'  id='2018-1' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/tfs_2015_publish_asp_net_using_robocopy'>TFS 2015: Publish ASP.NET Using Robocopy</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/combining_veracrypt_google_backup_sync_sql_server_part_2'>Combining VeraCrypt, Google Backup & Sync, and Sql Server Part 2</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/combining_veracrypt_google_backup_sync_sql_server_part_1'>Combining VeraCrypt, Google Backup & Sync, and Sql Server Part 1</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/new-blog-engine'>New Blog Engine</a></li></ol></li></ol></li><li class='history-year'><label for='2017'>2017</label><input type='checkbox'  id='2017' /><ol><li class='history-month'><label for='2017-8'>August</label><input type='checkbox'  id='2017-8' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/dont-use-data-prefix-in-angularjs'>Don't use "data" prefix in AngularJS</a></li></ol></li><li class='history-month'><label for='2017-7'>July</label><input type='checkbox'  id='2017-7' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/angularjs-service-with-var-declarations'>AngularJS service with var declarations instead of this. assignments</a></li></ol></li><li class='history-month'><label for='2017-6'>June</label><input type='checkbox'  id='2017-6' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/factory-resetting-android-without'>Factory Resetting Android Without Losing Your Life (Metaphorically)</a></li></ol></li><li class='history-month'><label for='2017-5'>May</label><input type='checkbox'  id='2017-5' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/identityserver3-with-pkce-part-4'>IdentityServer3 with PKCE Part 4 - Persisting User Data</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/identityserver3-with-pkce-part-3'>IdentityServer3 with PKCE Part 3 - Persist IdentityServer Configuration</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/identityserver3-with-pkce-part-2'>IdentityServer3 with PKCE Part 2 - Protected Resource Server</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/identityserver3-with-pkce-part-1-simple'>IdentityServer3 with PKCE Part 1 - Simple OAuth2 Server</a></li></ol></li><li class='history-month'><label for='2017-3'>March</label><input type='checkbox'  id='2017-3' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/tfs-continuous-integration-walk-through'>TFS Continuous Integration Walk Through Part 5c - Multiple Solutions: Dependencies</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/sane-database-schema-conventions'>Sane Database Schema Conventions</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/tfs-continuous-integration-agent'>TFS Continuous Integration - Agent Installation and Visual Studio Licensing</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/tfs-continuous-integration-clickonce'>TFS Continuous Integration - ClickOnce Apps</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/tfs-continuous-integration-and-private'>TFS Continuous Integration and Private NuGet Package Sources</a></li></ol></li><li class='history-month'><label for='2017-2'>February</label><input type='checkbox'  id='2017-2' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/tfs-continuous-integration-walk-through_22'>TFS Continuous Integration Walk Through Part 5b - Multiple Solutions: Simple Project References</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/tfs-continuous-integration-walk-through_20'>TFS Continuous Integration Walk Through Part 5a - Multiple Solutions: Overview</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/tfs-continuous-integration-walk-through_24'>TFS Continuous Integration Walk Through Part 4b - Problems With Traits</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/tfs-continuous-integration-walk-through_6'>TFS Continuous Integration Walk Through Part 4a - Filtering Tests</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/tfs-continuous-integration-walk-through_63'>TFS Continuous Integration Walk Through Part 3 - Notifications</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/tfs-continuous-integration-walk-through_5'>TFS Continuous Integration Walk Through Part 2 - Create an Automated Build</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/tfs-continuous-integration-walk-through'>TFS Continuous Integration Walk Through Part 1 - Installing TFS and Checking In a Test Project</a></li></ol></li><li class='history-month'><label for='2017-1'>January</label><input type='checkbox'  id='2017-1' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/what-else-programmers-do-text'>What Else Programmers Do: A Text Manipulation Example</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/what-does-this-code-do-extended'>What does this code do? Extended explanation</a></li></ol></li></ol></li><li class='history-year'><label for='2016'>2016</label><input type='checkbox'  id='2016' /><ol><li class='history-month'><label for='2016-12'>December</label><input type='checkbox'  id='2016-12' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/nexus-5-gps-lock-problem-and-two'>Nexus 5 GPS Lock Problem and Three--or More!--Solutions</a></li></ol></li><li class='history-month'><label for='2016-11'>November</label><input type='checkbox'  id='2016-11' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/how-to-bypass-new-microsoft-office'>How to Bypass the New Microsoft Office Startup and Save Screens</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/google-tasks-vs-reminders-in-desktop'>Google Tasks vs Reminders in Desktop and Phone</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/catching-up-on-coding-claims-based-identity-part-1_6'>Catching Up on Coding - Claims-Based Identity Part 1</a></li></ol></li><li class='history-month'><label for='2016-10'>October</label><input type='checkbox'  id='2016-10' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/creating-forms-authentication'>Creating Forms Authentication Membership Tables in LocalDB–Right and Wrong Ways</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/windows-10-complaint-1-auto-update'>Windows 10 Complaint #1: Auto Update State Loss</a></li></ol></li><li class='history-month'><label for='2016-9'>September</label><input type='checkbox'  id='2016-9' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/disable-windows-10-photo-automatic'>Disable Windows 10 Photo Automatic Albums</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/a-laymans-explanation-of-mocking-and'>A Layman’s Explanation of Mocking and Dependency Injection</a></li></ol></li><li class='history-month'><label for='2016-8'>August</label><input type='checkbox'  id='2016-8' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/catching-up-on-coding-tdd-part-3'>Catching Up on Coding - TDD Part 3</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/catching-up-on-coding-tdd-part-2'>Catching Up on Coding - TDD Part 2</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/catching-up-on-coding-tdd-part-1'>Catching Up on Coding - TDD Part 1</a></li></ol></li><li class='history-month'><label for='2016-7'>July</label><input type='checkbox'  id='2016-7' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/writing-to-current-users-registry-when'>Writing to the Current User(s) Registry When Running as System</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/catching-up-on-coding-syllabus'>Catching Up on Coding - The Syllabus</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/quickly-enable-mercurial-keyring-for'>Quickly Enable Mercurial Keyring for BitBucket</a></li></ol></li><li class='history-month'><label for='2016-6'>June</label><input type='checkbox'  id='2016-6' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/create-easily-debuggable-windows-service'>Create an Easily Debuggable Windows Service</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/underrated-work-skills'>(Underrated) Work Skills</a></li></ol></li><li class='history-month'><label for='2016-5'>May</label><input type='checkbox'  id='2016-5' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/vbnet-windows-project-to-c-conversion'>VB.Net Windows Project to C# Conversion Tools Quick Review</a></li></ol></li><li class='history-month'><label for='2016-2'>February</label><input type='checkbox'  id='2016-2' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/scroll-bars-in-blogger-tags'>Scroll bars in Blogger &lt;pre&gt; Tags</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/google-keep-changes-taking-to-forums'>Google Keep Changes: Taking to the Forums</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/backward-step-for-google-keep'>Backward Step for Google Keep</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/recover-virtualbox-snapshots'>Recover VirtualBox Snapshots</a></li></ol></li><li class='history-month'><label for='2016-1'>January</label><input type='checkbox'  id='2016-1' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/auto-updating-new-windows-7-installation'>Auto Updating a New Windows 7 Installation</a></li></ol></li></ol></li><li class='history-year'><label for='2015'>2015</label><input type='checkbox'  id='2015' /><ol><li class='history-month'><label for='2015-8'>August</label><input type='checkbox'  id='2015-8' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/shoretel-brilliantly-simple'>ShoreTel - Brilliantly Simple?</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/the-google-photos-management-problems'>The Google Photos Management Problem(s)</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/creating-long-lasting-clickonce'>Creating a Long-Lasting ClickOnce Certificate</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/more-encrypted-config-filesclickonce'>More Encrypted Config Files–ClickOnce Complications</a></li></ol></li><li class='history-month'><label for='2015-7'>July</label><input type='checkbox'  id='2015-7' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/encrypting-appconfig'>Encrypting app.config</a></li></ol></li><li class='history-month'><label for='2015-3'>March</label><input type='checkbox'  id='2015-3' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/better-google-sites-designthe-notched'>Better Google Sites Design–The Notched Page</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/removing-unremovable-bluetooth-device'>Removing Unremovable Bluetooth Device: FAIL!</a></li></ol></li></ol></li><li class='history-year'><label for='2014'>2014</label><input type='checkbox'  id='2014' /><ol><li class='history-month'><label for='2014-11'>November</label><input type='checkbox'  id='2014-11' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/how-to-remove-savernet-and-similar'>How to remove Savernet (and similar) Chrome extension</a></li></ol></li><li class='history-month'><label for='2014-9'>September</label><input type='checkbox'  id='2014-9' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/prevent-word-from-restoring-minimized'>Prevent Word from Restoring Minimized Documents</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/clever-phish'>Clever Phish</a></li></ol></li><li class='history-month'><label for='2014-8'>August</label><input type='checkbox'  id='2014-8' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/enable-synaptics-touchpad-2-finger-tap'>Enable Synaptics touchpad 2-finger tap context menu</a></li></ol></li><li class='history-month'><label for='2014-5'>May</label><input type='checkbox'  id='2014-5' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/installing-fcm-flow-cytrometry-library'>Installing fcm flow cytrometry library on Windows 8.1</a></li></ol></li><li class='history-month'><label for='2014-4'>April</label><input type='checkbox'  id='2014-4' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/windows-81-update-1-driver-problem-dtmb'>Windows 8.1 Update 1 Driver Problem DTMB BDA TV USB</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/windows-81-window-key-s-search-from'>Windows 8.1: Window Key + S = Search from Desktop</a></li></ol></li><li class='history-month'><label for='2014-3'>March</label><input type='checkbox'  id='2014-3' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/whs-2011-windows-update-one-or-more'>WHS 2011 Windows Update “One or more services are no running” alert</a></li></ol></li><li class='history-month'><label for='2014-2'>February</label><input type='checkbox'  id='2014-2' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/lenovo-u530-touch-wifi-problem-continued'>Lenovo U530 Touch WiFi Problem Continued</a></li></ol></li><li class='history-month'><label for='2014-1'>January</label><input type='checkbox'  id='2014-1' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/lenovo-u530-touch-wifi-problem'>Lenovo U530 Touch WiFi Problem</a></li></ol></li></ol></li><li class='history-year'><label for='2013'>2013</label><input type='checkbox'  id='2013' /><ol><li class='history-month'><label for='2013-12'>December</label><input type='checkbox'  id='2013-12' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/whs-connector-restart-error-in-windows'>WHS Connector Restart Error in Windows 8.0/8.1</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/how-to-remove-apps-from-google-play-my'>How to Remove Apps from Google Play My Apps Site</a></li></ol></li><li class='history-month'><label for='2013-11'>November</label><input type='checkbox'  id='2013-11' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/windows-81-hidden-opt-ins-opt-outs'>Windows 8.1 Hidden Opt Ins/ Opt Outs</a></li></ol></li><li class='history-month'><label for='2013-9'>September</label><input type='checkbox'  id='2013-9' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/edward-farley-epilogue'>Edward Farley and the Fantastic Library Epilogue</a></li></ol></li><li class='history-month'><label for='2013-7'>July</label><input type='checkbox'  id='2013-7' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/a-week-or-more-of-jolicloud-day-2-end'>A Week (or More!) of JoliCloud - Day 2: THE END</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/a-week-or-more-of-jolicloud-day-1'>A Week (or More!) of JoliCloud - Day 1</a></li></ol></li><li class='history-month'><label for='2013-5'>May</label><input type='checkbox'  id='2013-5' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/edward-farley-part-12'>Edward Farley and the Fantastic Library Part 12</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/edward-farley-part-1019'>Edward Farley and the Fantastic Library Part 11</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/edward-farley-part-10'>Edward Farley and the Fantastic Library Part 10</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/edward-farley-part-9'>Edward Farley and the Fantastic Library Part 9</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/edward-farley-part-8'>Edward Farley and the Fantastic Library Part 8</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/edward-farley-part-7'>Edward Farley and the Fantastic Library Part 7</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/edward-farley-part-6'>Edward Farley and the Fantastic Library Part 6</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/edward-farley-part-5'>Edward Farley and the Fantastic Library Part 5</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/edward-farley-part-4'>Edward Farley and the Fantastic Library Part 4</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/edward-farley-part-3'>Edward Farley and the Fantastic Library Part 3</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/edward-farley-part-2'>Edward Farley and the Fantastic Library Part 2</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/edward-farley-part-1'>Edward Farley and the Fantastic Library Part 1</a></li></ol></li><li class='history-month'><label for='2013-4'>April</label><input type='checkbox'  id='2013-4' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/clean-up-orphaned-sql-users'>Clean Up Orphaned SQL Users</a></li></ol></li><li class='history-month'><label for='2013-3'>March</label><input type='checkbox'  id='2013-3' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/t-sql-one-to-one-cant-be-done'>T-SQL One to One Can't Be Done</a></li></ol></li><li class='history-month'><label for='2013-1'>January</label><input type='checkbox'  id='2013-1' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/test-post-with-code'>Migrating Google Drive</a></li></ol></li></ol></li></ol>
    </div>
  </nav>
  <header>
    <div id="site-image">
      <img src="http://www.softwaremeadows.com/images/header.png" alt="" />
    </div>
    <h1 id="site-name"></h1>
    <div id="site-subtitle">A pleasant walk through computing</div>
  </header>
  <section id="content">
    <h1 id="home">Home</h1>

  </section>
  <!-- posts only appear in home index -->
  <section id="posts">
    
              <div class='post'>
                <h2 class='post-title'><a href='http://www.softwaremeadows.com/posts/tfs-continuous-integration-walk-through'>TFS Continuous Integration Walk Through Part 5c - Multiple Solutions: Dependencies</a></h2>
                <p class='post-info'><span class='posted-on'>2017-03-28 09:31</span></p>
                <div class='post-content'><p><a href="images/ci-logo.png"><img src="http://www.softwaremeadows.com/posts/tfs-continuous-integration-walk-through/images/ci-logo.png" alt="ci-logo" title="ci-logo"></a> This is part of a series of walk throughs exploring CI in TFS, starting from the ground up. The entire series and source code are maintained at this BitBucket repository.</p>
<p><a href="https://bitbucket.org/bladewolf55/tfs-ci-samples">https://bitbucket.org/bladewolf55/tfs-ci-samples</a></p>
<p>Previous Part: <a href="https://bitbucket.org/bladewolf55/tfs-ci-samples/src/default/CI%20Walk%20Through/TFS%20Continuous%20Integration%20Walk%20Through%20Part%205a%20-%20Multiple%20Solutions%20-%20Simple%20Project%20References.md">TFS Continuous Integration Walk Through Part 5b - Multiple Solutions: Simple Project References</a></p>
<h1 id="what-im-talking-about">What I'm Talking About</h1>
<p>Businesses often have source code that's years or decades old, and accumulate problems due to how that code was structured into folders. Especially difficult is how dependencies were managed. It's common to see:</p>
<ul>
<li>Projects with project references to other projects in other solutions, sometimes nesting/cascading in a tangled mess.</li>
<li>Third party libraries that require installation, such as UI controls.</li>
<li>Multiple ways of managing .dll dependencies.</li>
</ul>
<p>Some common challenges--and reasons why the above happen--are:</p>
<ul>
<li>Multiple projects depend on a shared project, and they often need to step through the shared project's code.</li>
<li>Over the years, different developers did things how they liked.</li>
<li>Source control wasn't used, or changed.</li>
</ul>
<h1 id="where-ill-end-up">Where I'll End Up</h1>
<p>I'll start with a set of solutions that have some dependency problems. I'll show how they can work with continuous integration. Then, I'll improve the dependency handling.</p>
<h1 id="a-problematic-structure">A Problematic Structure</h1>
<p>Let's imagine a TFS repository. Instead of a separate Team Project for each solution, there's a single Team Project named $Main that has all the solutions underneath it.</p>
<p>In this folder structure, I'm showing solution folders with their project folders below. So, ReverseIt is a solution folder with the ReverseIt project folder below it, which is the default Visual Studio layout.</p>
<pre><code class="language-csharp">$/Main
_Shared
   NameDb
     NameDb
ReverseIt
  ReverseIt
    &gt; Depends on RevEngine (project reference)
  RevEngine
    &gt; Depends on jamma.dll
ReverseNames
  ReverseNames
    &gt; Depends on RevEngine (project reference)
    &gt; Depends on NameDb (NuGet package)
</code></pre>
<ul>
<li>NameDb DLL returns a list of names, is packaged using NuGet, and stored in a local source.</li>
<li>ReverseIt Console reverses whatever text you type in.</li>
<li>RevEngine DLL has ReverseText method. It is a project reference.</li>
<li>Jamma.dll is a third party security dll. The company is out of business.</li>
<li>ReverseNames Console displays a list of reversed names coming from NameDb.</li>
</ul>
<p>What are the pros and cons of this approach?</p>
<p><strong>Pros</strong></p>
<ul>
<li>If you Get Latest on $Main, all the solutions are in their correct relative folders.</li>
</ul>
<p><strong>Cons</strong></p>
<ul>
<li>You often have to get source you don't need.</li>
<li>The dependency on relative paths is brittle.</li>
<li>You can't use TFS's project management tools effectively.</li>
<li>Doesn't scale. What if you had fifty solutions using this approach?</li>
</ul>
<h1 id="creating-ci-builds-as-is">Creating CI Builds As Is</h1>
<p>My manager says, "We need to get these projects into TFS Build."</p>
<p>I ask, "Can I restructure TFS?"</p>
<p>He says, "Not yet."</p>
<p>I say, "OK."</p>
<p>Since I'm pretty sure there are dependency problems, the first thing I decide to do is spin up a clean machine, install Visual Studio with no changes, Get Latest on $Main, and try to build all the solutions.</p>
<p>What's this!? Multiple failures? Oh, no! What went wrong?</p>
<ol>
<li>ReverseNames failed because we're depending on an in-house NuGet package source, and didn't configure that, so the NameDb dependency didn't exist.</li>
<li>RevEngine failed because Barry's the only developer who has ever worked on RevEngine, and only his machine has jamma.dll. It was never checked into source control.</li>
</ol>
<p>Quite a bit more could go wrong, but you get the idea. Let's fix these with an eye toward our eventual build server.</p>
<hr>
<p><strong>BONUS CODE!</strong></p>
<p>If I had lots of solutions, I could build all of of them using two files in the root of the folder than has all the solution folders.</p>
<p><strong>BuildAllSolutions.targets</strong></p>
<pre><code class="language-xml">&lt;Project ToolsVersion="14.0"
         xmlns="http://schemas.microsoft.com/developer/msbuild/2003"
         DefaultTargets="Default"&gt;
  &lt;!-- http://stackoverflow.com/a/9609086/1628707 --&gt;
  &lt;ItemGroup&gt;
    &lt;AllFiles Include=".\**\*.sln"/&gt;
  &lt;/ItemGroup&gt;
  &lt;Target Name="Default"&gt;
    &lt;PropertyGroup&gt;
    &lt;BuildCmd&gt;@(AllFiles-&gt;'&amp;quot;$(MSBuildToolsPath)\msbuild.exe&amp;quot; &amp;quot;%(Identity)&amp;quot; /v:q /fl /flp:errorsonly;logfile=build-logs\%(filename)-log.txt','%0D%0A')&lt;/BuildCmd&gt;
    &lt;/PropertyGroup&gt;
    &lt;Exec Command="mkdir build-logs" Condition="!Exists('build-logs')" /&gt;
    &lt;Exec Command="$(BuildCmd)" /&gt;
  &lt;/Target&gt;
&lt;/Project&gt;
</code></pre>
<p><strong>BuildAllSolutions.cmd</strong></p>
<pre><code class="language-csharp">--rem path to your latest VS build version
"C:\Program Files (x86)\MSBuild\14.0\Bin\msbuild.exe" BuildAllSolutions.targets
pause
</code></pre>
<p>Running the cmd file creates a folder named "build-logs", recursively builds each solution, and outputs each solution's errors. If a solution's log file is not empty, there was a build problem.</p>
<p><strong>END BONUS CODE</strong></p>
<hr>
<h2 id="dealing-with-a-local-nuget-package-source">Dealing With a Local NuGet Package Source</h2>
<p>There are four (technically five or six!) places to store NuGet config files containing package source information, and two ways to configure package source in TFS Build.</p>
<h3 id="nuget-config-file-locations">NuGet Config File Locations</h3>
<p>Let's assume our in-house NuGet source is located at <a href="http://ngserver/nuget">http://ngserver/nuget</a>.</p>
<ol>
<li><strong>User Profile</strong> - Enter it into Visual Studio's settings. This is fine for regular development, but not good for a build server because the build agent service will run as either Local System or a specific user account such as "tfsagent".</li>
</ol>
<p><a href="images/17-03-17_155817.png"><img src="http://www.softwaremeadows.com/posts/tfs-continuous-integration-walk-through/images/17-03-17_155817.png" alt="2017-03-17_155817" title="2017-03-17_155817"></a></p>
<p>You can also manually edit the user profile's nuget.config, which is what the Visual Studio setting dialog is doing. The file is located at %APPDATA%\NuGet\NuGet.config. You add the source under packageSources.</p>
<pre><code class="language-xml">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;configuration&gt;
  &lt;activePackageSource&gt;
    &lt;add key="nuget.org" value="https://www.nuget.org/api/v2/" /&gt;
  &lt;/activePackageSource&gt;
  &lt;packageSources&gt;
    &lt;add key="nuget.org" value="https://api.nuget.org/v3/index.json" protocolVersion="3" /&gt;
    &lt;add key="NuGet Local Source" value="http://ngserver/nuget" /&gt;
  &lt;/packageSources&gt;
  &lt;packageRestore&gt;
    &lt;add key="enabled" value="True" /&gt;
    &lt;add key="automatic" value="True" /&gt;
  &lt;/packageRestore&gt;
  &lt;bindingRedirects&gt;
    &lt;add key="skip" value="False" /&gt;
  &lt;/bindingRedirects&gt;
&lt;/configuration&gt;
</code></pre>
<ol start="2">
<li><strong>Solution</strong> - Create a solution-level nuget.config file.</li>
</ol>
<p>You can create a file named nuget.config, put it in your solution's root and add it to source control. This will determine which NuGet sources the solution uses.</p>
<pre><code class="language-xml">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;configuration&gt;
  &lt;packageRestore&gt;
    &lt;add key="enabled" value="True" /&gt;
    &lt;add key="automatic" value="True" /&gt;
  &lt;/packageRestore&gt;
  &lt;packageSources&gt;
    &lt;!-- uncomment clear if you want to ONLY use these sources --&gt;
    &lt;!-- otherwise, these sources are added to your list --&gt;
    &lt;!-- clear /&gt; --&gt;
  &lt;add key="NuGet Local Source" value="http://ngserver/nuget" /&gt;
  &lt;/packageSources&gt;
&lt;/configuration&gt;
</code></pre>
<p><strong>Note: NuGet 3.3 and earlier looked for a config file in a solution's .nuget folder. Not recommended.</strong></p>
<ol start="3">
<li><strong>Machine-Wide</strong> - Create a machine-wide config file.</li>
</ol>
<p>The machine-wide story is confusing. A machine-wide NuGet config file can reside in one of two folders. The folder changed with the introduction of NuGet 4.0, which is used by Visual Studio 2017.</p>
<ul>
<li><code>%ProgramData%\NuGet\Config\</code> (NuGet 3.x or earlier), or</li>
<li><code>%ProgramFiles(x86)%\NuGet\Config\</code> (NuGet 4.0+)</li>
</ul>
<p>It can be named anything that ends with .config, including <code>NuGet.config</code>. However, a custom name seems recommended.</p>
<p>For example, I could name the file <code>SoftwareMeadows.Online.config</code>. It would contain the package source like this:</p>
<pre><code class="language-xml">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;configuration&gt;
  &lt;packageSources&gt;
    &lt;add key="NuGet Local Source" value="http://ngserver/nuget" /&gt;
  &lt;/packageSources&gt;
&lt;/configuration&gt;
</code></pre>
<p>Network Administrators will like this option because they can use it with Group Policies. A policy could target computers in Developers and Build Servers groups and always create the desired config file.</p>
<p><strong>Note: NuGet 4.x does not look for config files in ProgramData.</strong></p>
<ol start="4">
<li><strong>Default Config</strong></li>
</ol>
<p>If you're using NuGet 2.7 through 3.x, default sources can also be configured in the file <code>%ProgramData%\NuGet\NuGetDefaults.config</code>. These show up in Visual Studio as local, not machine-wide, sources.</p>
<p><strong>Note: This file and location will not work with NuGet 4.x</strong></p>
<ol start="5">
<li><strong>Other?</strong></li>
</ol>
<p>You could also put a nuget.config file in any folder and specify it using the nuget.exe -configFile switch, e.g. <code>nuget restore -configfile c:\my.config</code>.</p>
<p><strong>Notes</strong></p>
<ul>
<li>Testing shows that in some cases if the package source URL is the same, only one source key is used. For example, if NuGet.config and NuGetDefaults.config have an identical source URL, the key from NuGet.config is used.</li>
<li>It appears a source listed in NuGetDefaults.config cannot be removed using the <code>&lt;clear /&gt;</code> tag. It can only be disabled.</li>
</ul>
<h3 id="specifying-the-config-in-tfs-build">Specifying the Config in TFS Build</h3>
<p>Whichever method you use below, ensure the agent service has permissions to the config file. The service name will be something like "VSO Agent ([AgentName])". Microsoft recommends creating a user named "tfsagent". The default is Local Service.</p>
<p><a href="images/17-03-17_162121.png"><img src="http://www.softwaremeadows.com/posts/tfs-continuous-integration-walk-through/images/17-03-17_162121.png" alt="2017-03-17_162121" title="2017-03-17_162121"></a></p>
<ol>
<li>TFS Machine-Wide Path - RECOMMENDED</li>
</ol>
<p>Personally, for internal development, I'd add the package source to the build server's machine-wide config file and be done with it. So, my path--assuming VS 2015 installed--would be something like: <code>%ProgramData%\NuGet\Config\SoftwareMeadows.Online.config</code></p>
<p><a href="images/17-03-17_162400.png"><img src="http://www.softwaremeadows.com/posts/tfs-continuous-integration-walk-through/images/17-03-17_162400.png" alt="2017-03-17_162400" title="2017-03-17_162400"></a></p>
<p>Remember from above this will change if you install Visual Studio 2017 on the build server (or use NuGet 4.x).</p>
<ol start="2">
<li>Add nuget.config to the build agent's profile.</li>
</ol>
<p>Your build server is basically a development machine, with an agent automatically building the software. If you run the service using tfsagent, you could create/edit a nuget.config file found at <code>C:\Users\tfsagent\AppData\Roaming\NuGet</code>.</p>
<ol start="3">
<li>TFS NuGet Installer Path Field</li>
</ol>
<p>If you check in a nuget.config file with the solution, enter the path in your build definition's NuGet Installer step. This path is relative to the Path to Solution. I would use this solution if my team didn't all work in the same network, and so needed to use an authenticated NuGet server such as <a href="http://myget.org/">MyGet</a>.</p>
<p><a href="images/17-03-17_162452.png"><img src="http://www.softwaremeadows.com/posts/tfs-continuous-integration-walk-through/images/17-03-17_162452.png" alt="2017-03-17_162452" title="2017-03-17_162452"></a></p>
<ol start="4">
<li>Use the -configFile switch</li>
</ol>
<p>You could also put a nuget.config file somewhere on the build server (or network?), and use the -configFile switch. Remember the build agent service needs permission to read the file.</p>
<p><a href="images/17-03-17_162410.png"><img src="http://www.softwaremeadows.com/posts/tfs-continuous-integration-walk-through/images/17-03-17_162410.png" alt="2017-03-17_162410" title="2017-03-17_162410"></a></p>
<h2 id="dealing-with-barry">Dealing with Barry</h2>
<p>Barry's been with us for five years. Barry drinks his coffee black, and lots of it. Barry knows where every file on his machine is, and would prefer you didn't look over his shoulder. Barry has his code, please leave it alone.</p>
<p>Unfortunately, Barry assumes he'll always be here, and hasn't ever tested what would happen if his machine imploded in a fiery death. I go to Barry and say, "Your code doesn't build on a clean checkout." Barry storms over to my computer and starts typing. I observe, take notes, and when I see him copying jamma.dll, ask, "What's that?"</p>
<p>"Oh," he mumbles, "license dll. Forgot about that. Kinda important. RevEngine won't run without it."</p>
<p>I don't say anything, but make a note that, once I have all the software building and deployable, Barry might not be long for our company. In the meantime, there are two ways I can handle this old dependency.</p>
<ol>
<li>Ensure it's in a folder under the solution or project, reference it there, and add it to source control.</li>
</ol>
<p><a href="images/17-03-17_164300.png"><img src="http://www.softwaremeadows.com/posts/tfs-continuous-integration-walk-through/images/17-03-17_164300.png" alt="2017-03-17_164300" title="2017-03-17_164300"></a></p>
<ol start="2">
<li>Create the dll as a NuGet package, and add it to my NuGet server.</li>
</ol>
<p><a href="https://dist.nuget.org/index.html">Download nuget.exe</a> and put in same folder as the dll (or put in its own folder and add to the system path variables).</p>
<p>Open a command prompt, change directories to where the dll is, and run <code>nuget spec jamma.dll</code>.</p>
<p>Edit the resulting damma.dll.nuspec file, change or remove elements as desired.</p>
<pre><code class="language-xml">&lt;?xml version="1.0"?&gt;
&lt;package &gt;
  &lt;metadata&gt;
    &lt;id&gt;jamma.dll&lt;/id&gt;
    &lt;version&gt;3.2.52&lt;/version&gt;
    &lt;authors&gt;Jamma Ltd&lt;/authors&gt;
    &lt;owners&gt;Jamma Ltd&lt;/owners&gt;
    &lt;requireLicenseAcceptance&gt;false&lt;/requireLicenseAcceptance&gt;
    &lt;description&gt;License file&lt;/description&gt;
    &lt;copyright&gt;Copyright 2017&lt;/copyright&gt;
  &lt;/metadata&gt;
&lt;/package&gt;
</code></pre>
<p><strong>Important: Now move the dll into a subfolder named "lib"</strong></p>
<p>Package the dll using <code>nuget pack</code>.</p>
<p>Add the package (jamma.dll and jamma.dll.nuspect) to your NuGet server however is appropriate, might just be copy/paste, or using nuget push commands. See the NuGet documentation.</p>
<p>Remove the reference from the project, and re-add from NuGet. Build and test. If everything's OK, delete the old jamma.dll file and folder.</p>
<p>Which would I do? Number 2, so that all my external dependencies are handled the same way (NuGet).</p>
<h2 id="its-building-so-add-to-ci">It's Building, so Add to CI</h2>
<p>I test again by deleting and re-getting all the source code, open each and restore any NuGet packages, and build all the solutions. Everything builds, so I'm ready to configure TFS Build for continuous integration.</p>
<p>All my solutions are under the same team project. I'll need to be careful when I create my build definitions that I'm only checking out and building the solutions I want. The key to that is not saving the definition until its Repository and Triggers have been configured.</p>
<p>I'll create the first definition in detail, then just list settings for the remainders.</p>
<p><strong>But first, the NuGet Package Source</strong></p>
<p>If I haven't done it already, I'll add a machine-wide nuget configuration file that has my custom package source.</p>
<p>Create the file <code>%ProgramData%\NuGet\Config\MySource.config</code> with the source definition. In my case, I'm testing with a local NuGet server.</p>
<pre><code class="language-xml">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;configuration&gt;
  &lt;packageSources&gt;
    &lt;add key="NuGet Test Server" value="http://localhost:7275/" /&gt;
  &lt;/packageSources&gt;
&lt;/configuration&gt;
</code></pre>
<p><strong>NameDb</strong></p>
<p>Let's start at the top with the simple one, NameDb. In TFS, navigate to the correct collection and the Main team project. Then open the Build tab, start a new build and choose the Visual Studio template.</p>
<p><a href="images/17-03-_143134.png"><img src="http://www.softwaremeadows.com/posts/tfs-continuous-integration-walk-through/images/17-03-_143134.png" alt="2017-03-25_143134" title="2017-03-25_143134"></a></p>
<p>Create using the repository source Main Team Project.</p>
<p><a href="images/17-03-_143854.png"><img src="http://www.softwaremeadows.com/posts/tfs-continuous-integration-walk-through/images/17-03-_143854.png" alt="2017-03-25_143854" title="2017-03-25_143854"></a></p>
<p>Delete the Index, Copy and Publish steps. I can add those back if we want them. I don't need the NuGet installer step, either, but I'll configure it as an example since the other projects need it.</p>
<p><a href="images/17-03-_144248.png"><img src="http://www.softwaremeadows.com/posts/tfs-continuous-integration-walk-through/images/17-03-_144248.png" alt="2017-03-25_144248" title="2017-03-25_144248"></a></p>
<p>Set the NuGet Installer path to the NameDb solution file.</p>
<p><a href="images/17-03-_145021.png"><img src="http://www.softwaremeadows.com/posts/tfs-continuous-integration-walk-through/images/17-03-_145021.png" alt="2017-03-25_145021" title="2017-03-25_145021"></a></p>
<p>Set the Visual Studio Build path to the NameDb solution file.</p>
<p><a href="images/17-03-_145758.png"><img src="http://www.softwaremeadows.com/posts/tfs-continuous-integration-walk-through/images/17-03-_145758.png" alt="2017-03-25_145758" title="2017-03-25_145758"></a></p>
<p>Set the Visual Studio Test "Test Assembly" to the solution folder path. This is the physical folder where the agent will have pulled the files from TFS, the same as the LocalPath path we'll choose in Repository. The path definition means "Run any dll with "test" in its name under the build definition name, but not in the obj folders." Since our build definition will be Release, it'll run Release/NameDb.Tests.dll.</p>
<p><a href="images/17-03-_150526.png"><img src="http://www.softwaremeadows.com/posts/tfs-continuous-integration-walk-through/images/17-03-_150526.png" alt="2017-03-25_150526" title="2017-03-25_150526"></a></p>
<p>Do NOT Save!</p>
<p>Change to the Repository tab. This controls what source code gets checked out by the build. Change the mapped paths. We'll keep the cloaked Drops folder, even though we aren't publishing anything yet.</p>
<p>Notice the LocalPath is set. This is so the contents of the NameDb solution folder are placed under a _Shared\NameDb folder, just like in the repository. It's not strictly needed for this build, but remember how this works if you're building multiple solutions with project dependencies in relative folders.</p>
<p><a href="images/17-03-_151640.png"><img src="http://www.softwaremeadows.com/posts/tfs-continuous-integration-walk-through/images/17-03-_151640.png" alt="2017-03-25_151640" title="2017-03-25_151640"></a></p>
<p>Change to the Variables tab and ensure the BuildConfiguration is "release".</p>
<p><a href="images/17-03-_1528.png"><img src="http://www.softwaremeadows.com/posts/tfs-continuous-integration-walk-through/images/17-03-_1528.png" alt="2017-03-25_152836" title="2017-03-25_152836"></a></p>
<p>Change to the Triggers tab. This controls what starts a build. Check Continuous Integration and set the path to the NameDb folder. We only want to build if a file in NameDb changes.</p>
<p><a href="images/17-03-_153129.png"><img src="http://www.softwaremeadows.com/posts/tfs-continuous-integration-walk-through/images/17-03-_153129.png" alt="2017-03-25_153129" title="2017-03-25_153129"></a></p>
<p>Now Save the definition and give it a good name like "DbName".</p>
<p><a href="images/17-03-_1533.png"><img src="http://www.softwaremeadows.com/posts/tfs-continuous-integration-walk-through/images/17-03-_1533.png" alt="2017-03-25_153325" title="2017-03-25_153325"></a></p>
<p>Finally, queue the build and see if it succeeds!</p>
<blockquote>
<p><strong>Important</strong><br>
Check each step's output for what you expect. Especially, check that tests ran! The test step will success even if it doesn't find tests!</p>
</blockquote>
<p><a href="images/17-03-_153438.png"><img src="http://www.softwaremeadows.com/posts/tfs-continuous-integration-walk-through/images/17-03-_153438.png" alt="2017-03-25_153438" title="2017-03-25_153438"></a></p>
<p><a href="images/17-03-_155144.png"><img src="http://www.softwaremeadows.com/posts/tfs-continuous-integration-walk-through/images/17-03-_155144.png" alt="2017-03-25_155144" title="2017-03-25_155144"></a></p>
<p>For the next solutions, I'll just list the settings for the build definitions. All of them use the Visual Studio template, and only keep the NuGet, Build and Test steps.</p>
<p><strong>ReverseIt</strong></p>
<p>BUILD TAB</p>
<ul>
<li>NuGet Installer path to solution: <code>$/Main/ReverseIt/ReverseIt.sln</code></li>
<li>Build solution path: <code>$/Main/ReverseIt/ReverseIt.sln</code></li>
<li>Test assembly path: <code>ReverseIt\**\$(BuildConfiguration)\*test*.dll;-:**\obj\**</code></li>
</ul>
<p>REPOSITORY TAB</p>
<ul>
<li>Map Server Path <code>$/Main/ReverseIt</code> to Local Path <code>ReverseIt</code></li>
<li>Map Cloaked Path <code>$/Main/ReverseIt/Drops</code></li>
</ul>
<p>VARIABLES TAB</p>
<ul>
<li>BuildConfiguration: release</li>
</ul>
<p>TRIGGERS TAB</p>
<ul>
<li>Include <code>$/Main/ReverseIt</code></li>
</ul>
<p><strong>ReverseNames</strong></p>
<p>Strictly speaking, I don't need to build RevEngine. Any changes I make will trigger ReverseIt to build, and if it fails then someone--hopefully I--will be notified. What I do need to do is get the source code into the correct relative folder, and install the NuGet packages. In short, I need to ensure RevEngine can be used by ReverseNames.</p>
<p>So, I'm going to have two sets of steps; one for RevEngine, and one for ReverseNames. It's a brittle definition: Whoever, works on RevEngine needs to know about this build, too, in case something needs to change.</p>
<p>BUILD TAB</p>
<ul>
<li><p>NuGet Installer RevEngine</p>
<ul>
<li>Path to solution: <code>ReverseIt\**\*.csproj</code></li>
<li>NuGet Arguments: <code>-PackagesDirectory ..\packages</code></li>
</ul>
<p>Notice I set the path to the <em>local project</em> files. This will restore packages for any .csproj file found. I also explicitly say where to put the packages folder relative to the .csproj file.</p>
</li>
<li><p>NuGet Installer ReverseNames</p>
<ul>
<li>Path to solution: $/Main/ReverseNames/ReverseNames.sln</li>
</ul>
</li>
<li><p>Build ReverseNames</p>
<ul>
<li>Solution path: $/Main/ReverseNames/ReverseNames.sln</li>
</ul>
</li>
<li><p>Test ReverseNames</p>
<ul>
<li>Assembly path: <code>ReverseNames\**\$(BuildConfiguration)\*test*.dll;-:**\obj\**</code></li>
</ul>
</li>
</ul>
<p>REPOSITORY TAB<br>
This is critical. I'm telling the build <em>exactly</em> which project folders to pull from ReverseIt, i.e. RevEngine and RevEngine.Tests. This way I don't pull and build ReverseIt.csproj.</p>
<p>If I add a test project later, I'll need to add its mapped path here. Note that I removed the Drops cloaked path since I don't need it.</p>
<ul>
<li>Map Server Path <code>$/Main/ReverseIt/RevEngine</code> to Local Path <code>ReverseIt\RevEngine</code></li>
<li>Map Server Path <code>$/Main/ReverseIt/RevEngine.Tests</code> to Local Path <code>ReverseIt\RevEngine.Tests</code></li>
<li>Map Server Path <code>$/Main/ReverseNames</code> to Local Path <code>ReverseNames</code></li>
</ul>
<p>VARIABLES TAB</p>
<ul>
<li>BuildConfiguration: release</li>
</ul>
<p>TRIGGERS TAB<br>
I'm triggering the build if ReverseNames changes.</p>
<ul>
<li>Include <code>$/Main/ReverseNames</code></li>
</ul>
<p>Here are some screenshots of the ReverseNames definition.</p>
<p><a href="images/17-03-26_190426.png"><img src="http://www.softwaremeadows.com/posts/tfs-continuous-integration-walk-through/images/17-03-26_190426.png" alt="2017-03-26_190426" title="2017-03-26_190426"></a></p>
<p><a href="images/17-03-26_190546.png"><img src="http://www.softwaremeadows.com/posts/tfs-continuous-integration-walk-through/images/17-03-26_190546.png" alt="2017-03-26_190546" title="2017-03-26_190546"></a></p>
<p><a href="images/17-03-26_1906_.png"><img src="http://www.softwaremeadows.com/posts/tfs-continuous-integration-walk-through/images/17-03-26_1906_.png" alt="2017-03-26_190620" title="2017-03-26_190620"></a></p>
<h1 id="improving-the-solutions-dependencies-and-team-projects">Improving the Solutions, Dependencies and Team Projects</h1>
<p>What I've done so far works. Sort of. But it's not exactly ideal, especially if there were fifty solutions, not just three. One big thing I lose is the ability to maintain separate project boards and work items per project. To do that, I'd really like a separate Team Project per solution (or in some cases it could be multiple solutions).</p>
<p>The team projects might look like this.</p>
<pre><code class="language-csharp">$\NameDb
$\RevEngine
$\ReverseIt
$\ReverseNames
</code></pre>
<p>And then there's the project reference. The project reference is bound to cause headaches in the future. One developer will change RevEngine and silently break the ReverseNames build. I say "silently," because it could be something like adding a new unit test project that doesn't get run by ReverseNames because it doesn't get pulled from source control.</p>
<p>Because it's a shared dependency, RevEngine needs to be in its own solution under _Shared and published as a NuGet package.</p>
<p>Right about now, someone's saying, "But but but! I need to be able to step through that code! And make changes that I can test against ReverseIt!!"</p>
<p>This might point to too much coupling between the projects, but so what? That's what you need. For debugging,</p>
<ul>
<li>Publish the NuGet <a href="https://docs.microsoft.com/en-us/nuget/create-packages/symbol-packages">package with debug symbols</a>. This solves the debugging problem.</li>
</ul>
<p>If you really need to change code in the context of the solution,</p>
<ol>
<li>Drop the RevEngine NuGet reference from ReverseNames.</li>
<li>Get the latest RevEngine code into its _Shared\RevEngine folder.</li>
<li>Temporarily add the project reference to ReverseNames.</li>
<li>Do the work.</li>
<li>When finished, drop the RevEngine project reference.</li>
<li>ReAdd the NuGet reference (which doesn't have your changes, sorry).</li>
<li>Open the RevEngine solution and run the tests.</li>
<li>Commit the RevEngine changes, which, sorry, need to be taken through QA, published, etc.</li>
<li>When that's finished, update the RevEngine NuGet package in ReverseNames.</li>
<li>Run the tests, commit, QA, etc.</li>
</ol>
<p>In other words, you need to treat RevEngine as if it were some third party assembly like Entity Framework or NLog.</p>
<p>All of this leads to...</p>
<h1 id="key-thinking-to-managing-dependencies">Key Thinking to Managing Dependencies</h1>
<ol>
<li>Treat your dependencies as if they're third party.</li>
<li>Shared dependencies need to be in their own solutions.</li>
<li>What does it take to check out, build and test the solution on a new computer?</li>
<li>How would you store the project(s) on GitHub or other public remote repository?</li>
</ol>
<h1 id="the-plan">The Plan</h1>
<p>I'm going to do just three things, but they'll make a big difference.</p>
<ol>
<li>Reorganize the solutions into discrete team projects</li>
<li>Publish shared project references as NuGet packages</li>
<li>Update projects to use the packages</li>
</ol>
<blockquote>
<p><strong>Important</strong><br>
Before getting started in a production environment, I'd disable all of the affected TFS Build definitions. I don't want anything running if I don't need to.</p>
<p>I would also make a backup copy of all the affected source code, just in case something gets lost.</p>
</blockquote>
<h1 id="reorganizing-into-team-projects">Reorganizing into Team Projects</h1>
<p>First, I'll create my new team projects. Then I'll move my code.</p>
<blockquote>
<p><strong>Note</strong><br>
You can also add team projects using the Visual Studio Team Explorer.</p>
</blockquote>
<ol>
<li><p>Open TFS in the browser, e.g. <a href="http://nesbit:8080/tfs">http://nesbit:8080/tfs</a>. Or, if you know your collection's name, you can open it directly and skip to step 4. (e.g. <a href="http://nesbit:8080/tfs/CICollection3/_admin">http://nesbit:8080/tfs/CICollection3/_admin</a>)</p>
</li>
<li><p>Click the upper right hand corner settings "gear" icon to open the Manage Server page.</p>
<p><a href="images/17-03-27_085328.png"><img src="http://www.softwaremeadows.com/posts/tfs-continuous-integration-walk-through/images/17-03-27_085328.png" alt="2017-03-27_085328" title="2017-03-27_085328"></a></p>
</li>
<li><p>Select the Collection holding your team projects, and click "View the collection administration page".</p>
<p><a href="images/17-03-27_085913.png"><img src="http://www.softwaremeadows.com/posts/tfs-continuous-integration-walk-through/images/17-03-27_085913.png" alt="2017-03-27_085913" title="2017-03-27_085913"></a></p>
</li>
<li><p>Click New Team Project, enter the information and Create.</p>
<p><a href="images/17-03-27_090645.png"><img src="http://www.softwaremeadows.com/posts/tfs-continuous-integration-walk-through/images/17-03-27_090645.png" alt="2017-03-27_090645" title="2017-03-27_090645"></a></p>
</li>
</ol>
<p>Repeat to create the four team projects.</p>
<p><a href="images/17-03-27_0911.png"><img src="http://www.softwaremeadows.com/posts/tfs-continuous-integration-walk-through/images/17-03-27_0911.png" alt="2017-03-27_091136" title="2017-03-27_091136"></a></p>
<p>We can't move the code using the TFS web application, so</p>
<ol>
<li><p>Open Visual Studio</p>
</li>
<li><p>Open Team Explorer and click the plug icon to Manage Connections</p>
<p><a href="images/17-03-27_091617.png"><img src="http://www.softwaremeadows.com/posts/tfs-continuous-integration-walk-through/images/17-03-27_091617.png" alt="2017-03-27_091617" title="2017-03-27_091617"></a></p>
</li>
<li><p>Double click the collection you're using to connect to it.</p>
<p><a href="images/17-03-27_091812.png"><img src="http://www.softwaremeadows.com/posts/tfs-continuous-integration-walk-through/images/17-03-27_091812.png" alt="2017-03-27_091812" title="2017-03-27_091812"></a></p>
</li>
<li><p>Open Source Control Explorer.</p>
<p><a href="images/17-03-27_091911.png"><img src="http://www.softwaremeadows.com/posts/tfs-continuous-integration-walk-through/images/17-03-27_091911.png" alt="2017-03-27_091911" title="2017-03-27_091911"></a></p>
</li>
<li><p>The new team project folders need to be mapped to local folders. This is kind of a pain, but with TFS Version Control there's no getting around it. It's easier with git. I would create a new folder named something like TempTeams to hold the new team projects, finish the moves, then delete all my source code mappings and start over. Like I said, a pain. <strong>Be <em>very</em> careful when doing all this that you don't accidentally delete source code from TFS you didn't want to.</strong></p>
</li>
<li><p>To map a team project folder, select it and click the Not Mapped link. Enter the destination folder, and when prompted Get the latest code (there won't be any, that's OK). Map all the team project folders.</p>
<p><a href="images/17-03-27_093743.png"><img src="http://www.softwaremeadows.com/posts/tfs-continuous-integration-walk-through/images/17-03-27_093743.png" alt="2017-03-27_093743" title="2017-03-27_093743"></a></p>
</li>
<li><p>Open the NameDb solution. TFS still doesn't natively allow moving multiple files/folders at once, so we need to move the project contents one a time. First, I'll move the solution file. Right-click, select Move, and enter the NameDb team project. The file will be moved to the NameDb team project.</p>
<p><a href="images/17-03-27_092818.png"><img src="http://www.softwaremeadows.com/posts/tfs-continuous-integration-walk-through/images/17-03-27_092818.png" alt="2017-03-27_092818" title="2017-03-27_092818"></a></p>
<p><a href="images/17-03-27_094508.png"><img src="http://www.softwaremeadows.com/posts/tfs-continuous-integration-walk-through/images/17-03-27_094508.png" alt="2017-03-27_094508" title="2017-03-27_094508"></a></p>
</li>
<li><p>Move the NameDb and NameDb.Tests project folders the same way. You <em>can</em> right-click and move an entire folder, just not multiple folders.</p>
</li>
<li><p>When finished, Commit the changes.</p>
</li>
<li><p>You can now delete the NameDb folder from under $/Main/_Shared and commit that change.</p>
</li>
</ol>
<p>Now I'm going to move just the RevEngine project folders to the new RevEngine team project. Later, I'll create their solution file.</p>
<p>Open the ReverseIt folder. Move the RevEngine and RevEngine.Test folders.</p>
<p><a href="images/17-03-27_095844.png"><img src="http://www.softwaremeadows.com/posts/tfs-continuous-integration-walk-through/images/17-03-27_095844.png" alt="2017-03-27_095844" title="2017-03-27_095844"></a></p>
<p><a href="images/17-03-27_100012.png"><img src="http://www.softwaremeadows.com/posts/tfs-continuous-integration-walk-through/images/17-03-27_100012.png" alt="2017-03-27_100012" title="2017-03-27_100012"></a></p>
<p>At this point, I move the remaining ReverseIt files/folders to their new team project. Likewise the ReverseNames solution.</p>
<p>Commit the changes. Delete the folders from $/Main, and commit that change, too.</p>
<p><strong>Do NOT delete the $/Main team project! The TFS Build definitions would be deleted, too.!</strong></p>
<p>Finally, go to the RevEngine project in your local working folder, i.e. <code>..TempTeams\RevEngine\RevEngine</code>, open RevEngine.csproj. This will open the project in a solution, we just haven't saved the solution file yet.</p>
<p>Add the RevEngine.Tests project to the solution.</p>
<p><a href="images/17-03-27_101947.png"><img src="http://www.softwaremeadows.com/posts/tfs-continuous-integration-walk-through/images/17-03-27_101947.png" alt="2017-03-27_101947" title="2017-03-27_101947"></a></p>
<p>Now I have to be careful. I select the solution in Solution Explorer. Then, File &gt; Save RevEngine.sln As.</p>
<p><a href="images/17-03-27_102153.png"><img src="http://www.softwaremeadows.com/posts/tfs-continuous-integration-walk-through/images/17-03-27_102153.png" alt="2017-03-27_102153" title="2017-03-27_102153"></a></p>
<p>In the Save As dialog, I navigate <em>up</em> one folder, so my solution file is at the root of RevEngine.</p>
<p><a href="images/17-03-27_1056.png"><img src="http://www.softwaremeadows.com/posts/tfs-continuous-integration-walk-through/images/17-03-27_1056.png" alt="2017-03-27_102556" title="2017-03-27_102556"></a></p>
<p>Now, I drag and drop the solution file into the Source Control Explorer's RevEngine team project.</p>
<p><a href="images/17-03-27_102848.png"><img src="http://www.softwaremeadows.com/posts/tfs-continuous-integration-walk-through/images/17-03-27_102848.png" alt="2017-03-27_102848" title="2017-03-27_102848"></a></p>
<p>Commit the change.</p>
<p>My projects are reorganized, and a couple will build (NameDb and RevEngine). Time to turn handle the RevEngine dependency.</p>
<h1 id="publish-shared-project-references-as-nuget-packages">Publish shared project references as NuGet packages</h1>
<p>I'm still working in the TempTeams folder. I'll wait until everything's working before going back to my preferred folders.</p>
<p>Creating NuGet packages can be complex. For this walkthrough, I'm showing the simplest thing that works; I'm sure these steps are not ideal. The following assumes I have a local NuGet server at <a href="http://localhost:7275/nuget">http://localhost:7275/nuget</a> that doesn't require an API key for pushing packages (not recommended), and does allow pushing symbols.</p>
<ol>
<li><p>Open the solution, and edit the RevEngine Project Properties &gt; Application &gt; Assembly Information.</p>
</li>
<li><p>Ensure Title, Description, Company and Product are filled in.</p>
<p><a href="images/17-03-27_113329.png"><img src="http://www.softwaremeadows.com/posts/tfs-continuous-integration-walk-through/images/17-03-27_113329.png" alt="2017-03-27_113329" title="2017-03-27_113329"></a></p>
</li>
<li><p>Save <em>and build</em> the solution. You must build, because nuget packs the built dll. It does not build the solution for you.</p>
</li>
<li><p>Download the latest recommended <a href="https://dist.nuget.org/index.html">NuGet.exe file</a>.</p>
</li>
<li><p>Put nuget.exe in the RevEngine project folder.</p>
</li>
<li><p>Open a command prompt and change directory to the RevEngine project folder.</p>
</li>
<li><p>Run <code>nuget spec</code> to create a RevEngine.nuspec file</p>
</li>
<li><p>Edit RevEngine.nuspec and make these changes:</p>
<pre><code class="language-xml">&lt;?xml version="1.0"?&gt;
&lt;package &gt;
  &lt;metadata&gt;
    &lt;id&gt;$id$&lt;/id&gt;
    &lt;version&gt;$version$&lt;/version&gt;
    &lt;title&gt;$title$&lt;/title&gt;
    &lt;authors&gt;$author$&lt;/authors&gt;
    &lt;owners&gt;$author$&lt;/owners&gt;
    &lt;description&gt;$description$&lt;/description&gt;
  &lt;/metadata&gt;
&lt;/package&gt;
</code></pre>
</li>
<li><p>Run <code>nuget pack -Symbols</code> to create the regular and symbols package. Remember that, in our case, we want a symbols package so that we can step through the assembly without using a project reference.</p>
</li>
<li><p>Run <code>nuget push *.nupkg -Source http://localhost:7275/api/v2/package</code>. This will push both of the packages.</p>
</li>
</ol>
<h1 id="update-projects-to-use-the-packages">Update projects to use the packages</h1>
<p>This one should be pretty easy. In any solution that has RevEngine as a project reference, remove the project and the reference, then install the NuGet package. Notice that jamma.dll is installed as well, because RevEngine depends on it and the RevEngine project was referencing the jamma.dll NuGet package when it was packages.</p>
<p>After updating, if I open ReverseIt (for example), put a breakpoint on this line,</p>
<p><code>Console.WriteLine(util.ReverseText(text));</code></p>
<p>then run the program, I can step into RevEngine.TextUtilities.cs, which is now part of the debugging symbols.</p>
<h1 id="update-tfs-build-definitions">Update TFS Build Definitions</h1>
<p>It's time to get our builds working again!</p>
<p>TFS doesn't natively support copying/moving build definitions. One solution is to write code using the TFS web API to clone definitions:</p>
<p><a href="http://www.eidias.com/blog/2016/3/7/tfs-2015-cloneimportexport-build-definition-between-team-projects">http://www.eidias.com/blog/2016/3/7/tfs-2015-cloneimportexport-build-definition-between-team-projects</a></p>
<p>However, there's a TFS extension for this, which really saves the day. You can download it here.</p>
<p><a href="https://marketplace.visualstudio.com/items?itemName=onlyutkarsh.ExportImportBuildDefinition">Export/Import Build Definitions</a></p>
<blockquote>
<p><strong>Note</strong><br>
If using TFS 2015, you must use version <a href="https://github.com/onlyutkarsh/ExportImportBuildDefinition/releases/tag/v0.0.2">v0.0.2</a>. Later versions only work with TFS 2017.</p>
</blockquote>
<p>Follow the instructions to install the extension.</p>
<p>To install 'Export/Import Build Definition' (EIBD) on Team Foundation Server 2015 Update 2 and above, perform the following steps:</p>
<ol>
<li>Navigate to the Team Foundation Server Extensions page on your server. (For example, <a href="http://someserver:8080/tfs/_gallery/manage">http://someserver:8080/tfs/\_gallery/manag</a>)</li>
<li>Click Upload new extension and select the file you have just downloaded.</li>
<li>After the extension has successfully uploaded, click Install and select the Team Project Collection to install into.</li>
</ol>
<p>To move NameDb:</p>
<ol>
<li><p>In the Main team project Build tab, right-click the build definition and choose Export. Save the json file to a folder such as TfsBuildExports.</p>
<p><a href="images/17-03-27_144558.png"><img src="http://www.softwaremeadows.com/posts/tfs-continuous-integration-walk-through/images/17-03-27_144558.png" alt="2017-03-27_144558" title="2017-03-27_144558"></a></p>
</li>
<li><p>Change to the NameDb team project Build tab. EIBD has a known limitation: the Export/Import menu items can only be seen on a build definition name, not the "All build definitions" item. So, if necessary, create an empty definition and save it with a non-conflicting name.</p>
</li>
<li><p>Right-click a definition and choose Import, selecting the .json file.</p>
</li>
<li><p>Edit the imported definition.</p>
</li>
<li><p>Make the following changes.</p>
</li>
</ol>
<p>BUILD</p>
<ul>
<li>NuGet Installer path: $/NameDb/NameDb.sln</li>
<li>Build path: $/NameDb/NameDb.sln</li>
<li>Test path: *<em>$(BuildConfiguration)*test</em>.dll;-:*<em>\obj*</em></li>
</ul>
<p>REPOSITORY</p>
<ul>
<li><p>Map $/NameDb, leave Local Path empty</p>
<p><a href="images/17-03-27_145831.png"><img src="http://www.softwaremeadows.com/posts/tfs-continuous-integration-walk-through/images/17-03-27_145831.png" alt="2017-03-27_145831" title="2017-03-27_145831"></a></p>
</li>
</ul>
<p>TRIGGERS</p>
<ul>
<li>Include $/NameDb</li>
</ul>
<!-- end list -->
<ol start="6">
<li>Test!</li>
</ol>
<p><strong>ReverseIt</strong></p>
<p>Use the same approach as NameDb, namely changing the paths in Build, Repository and Triggers. (In fact, ReverseIt would work with the default Visual Studio template.)</p>
<p><strong>ReverseNames</strong></p>
<p>Likewise, ReverseNames can be simplified because I no longer have the RevEngine project to deal with. In fact, all I have to do is delete anything related to RevEngine, then update the remaining paths as I've done above.</p>
<p><strong>RevEngine</strong></p>
<p>This is a new build definition, and it follows the same simplified pattern as above.</p>
<h1 id="what-just-happened">What Just Happened?</h1>
<p>I'll tell you what. Our build definitions got simpler because</p>
<ol>
<li>We converted our project references to NuGet packages.</li>
<li>We contained our code in team projects.</li>
</ol>
<p>Admittedly, the sample was a pretty simple case. I could have a team project that legitimately encompasses multiple solutions. But if I still apply the key principles from above, I can have clean maintenance and simpler builds. As a bonus, it should be much easier to switch to git if I want, since I'm now treating my code as discrete instead of monolithic.</p>
<h1 id="clean-up">Clean Up</h1>
<p>I can now delete the $/Main team project. But, despite there being a right-click menu item, I can't do it from Source Control Explorer. So, (sigh), back to the web interface and my collection administration page. Select Delete from the dropdown to the left of the team project.</p>
<p><a href="images/17-03-27_101321.png"><img src="http://www.softwaremeadows.com/posts/tfs-continuous-integration-walk-through/images/17-03-27_101321.png" alt="2017-03-27_101321" title="2017-03-27_101321"></a></p>
<p>Am I <em>sure</em> the team project is empty? If so, enter its name and delete it.</p>
<p><a href="images/17-03-27_101437.png"><img src="http://www.softwaremeadows.com/posts/tfs-continuous-integration-walk-through/images/17-03-27_101437.png" alt="2017-03-27_101437" title="2017-03-27_101437"></a></p>
<h1 id="references">References</h1>
<p><a href="https://docs.microsoft.com/en-us/nuget/create-packages/creating-a-package">Creating a Package</a><br>
<a href="https://docs.microsoft.com/en-us/nuget/consume-packages/configuring-nuget-behavior">Configuring NuGet Behavior</a><br>
<a href="http://softwareengineering.stackexchange.com/a/336984">Using Private NuGet Repository</a><br>
<a href="http://stackoverflow.com/a/32624016/1628707">How to Get TFS2015 Build to Restore from Custom NuGet Source 1</a><br>
<a href="http://stackoverflow.com/a/31384347/1628707">How to Get TFS2015 Build to Restore from Custom NuGet Source 2</a><br>
<a href="http://stackoverflow.com/a/28593688/1628707">NuGet Package Source Config Locations</a> <a href="http://blog.nuget.org/20161121/introducing-nuget4.0.html">Introducing NuGet 4</a> <a href="http://stackoverflow.com/a/27569020/1628707">Specifying NuGet Config path for TFS Build</a></p>
<p>Next Part: <a href="https://bitbucket.org/bladewolf55/tfs-ci-samples/src/default/CI%20Walk%20Through/TFS%20Continuous%20Integration%20Walk%20Through%20Part%205a%20-%20Multiple%20Solutions%20-%20Build%20Settings.md">TFS Continuous Integration Walk Through Part 5d - Multiple Solutions: Build Settings</a></p>
</div>
              </div>
              

              <div class='post'>
                <h2 class='post-title'><a href='http://www.softwaremeadows.com/posts/sane-database-schema-conventions'>Sane Database Schema Conventions</a></h2>
                <p class='post-info'><span class='posted-on'>2017-03-23 12:11</span></p>
                <div class='post-content'><h1 id="rationale">Rationale</h1>
<p>These are sane conventions for constructing and naming a database schema. They aren't new, and there's sure to be something someone doesn't like. They are biased toward the .Net EntityFramework, which itself was influenced by the Ruby on Rails ActiveRecord conventions by David Heinemeier Hansson.</p>
<p>Using these conventions makes it easier to translate the tables into classes. While this isn't always desirable (or correct), it often is.</p>
<h1 id="sample">Sample</h1>
<p>This sample schema exemplifies the conventions, and shows most relationships you'll encounter. It's semi-realistic. PropertyRecords is contrived to show a pseudo one-to-one relationship. (Note: MS SQL doesn't allow a <em>true</em> one-to-one structure, as different tables' rows can't be simultaneously created.)</p>
<p>&nbsp;</p>
<p><a href="images/sample-schema.png"><img src="http://www.softwaremeadows.com/posts/sane-database-schema-conventions/images/sample-schema.png" alt="sample-schema" title="sample-schema"></a></p>
<ul>
<li>A Customer has an Initial contact Employee, Support Employee and a Salesperson. An Employee can service multiple Customers.</li>
<li>An Employee can be a Salesperson.</li>
<li>A Customer has one or more Addresses, an Address belongs to one Customer.</li>
<li>An Address has one Property Record, a Property Record is for one Address.</li>
<li>A Customer has zero or more Orders, an Order has one Customer.</li>
<li>An Order can have many Vendors, a Vendor can fulfill many Orders.</li>
<li>An Order can have many Promotions, a Promotion is for zero or more Orders.</li>
<li>An Order Promotion has zero or more customer notifications.</li>
</ul>
<h1 id="table-column-layout">Table Column Layout</h1>
<p>I like my table columns ordered this way.</p>
<ol>
<li>Primary key</li>
<li>Foreign keys</li>
<li>Regular columns</li>
<li>Audit columns</li>
</ol>
<h1 id="general-names">General Names</h1>
<h2 id="pluralize-most-table-names">Pluralize Most Table Names</h2>
<p>Pluralizing table names reduces the chances of keyword conflicts, and matches how the table will (typically) be treated in an ORM tool.</p>
<pre><code class="language-csharp">Yes            |No               
---------------|-----------------
Customers      |Customer
Salespeople    |Salesperson
</code></pre>
<p>Don't pluralize many-to-many join tables. By convention, keep the table name parts alphabetical.</p>
<blockquote>
<p><strong>Note</strong><br>
Using Code First, Entity Framework might pluralize this to OrderVendors. Personally, I'd use the FluentAPI to force the table name to the OrderVendor.</p>
</blockquote>
<pre><code class="language-csharp">Yes            |No               
---------------|-----------------
OrderVendor    |OrdersVendors, OrderVendors, VendorOrder              
</code></pre>
<h2 id="use-pascalcase">Use PascalCase</h2>
<p>Tables and columns should be in <a href="https://en.wikipedia.org/wiki/PascalCase">PascalCase</a>.</p>
<pre><code class="language-csharp">Yes            |No               
---------------|-----------------
Customers      |customer
OrderNbr       |orderNbr
</code></pre>
<h2 id="no-dashes-or-underscores">No Dashes or Underscores</h2>
<p>It's tempting to separate words in either table or column names, but don't. Keeping them PascalCased makes the transition to classes easier and clearer. Also, some databases don't play nicely with underscores, or dashes, depending on how they're used.</p>
<pre><code class="language-csharp">Yes            |No               
---------------|-----------------
OrderVendor    |Order_Vendor
OrderNbr       |order-number
CustomerId     |Customer_ID
</code></pre>
<h1 id="keys">Keys</h1>
<p>My personal preference is to end key names with "Id", rather than "ID". It reads just as well, and is consistent with PascalCasing and .Net naming conventions.</p>
<h2 id="primary-key">Primary Key</h2>
<p>Some people prefer a primary key of just "Id", but if you need to run SQL queries (and you will), it's easier to have the table name in the primary key for creating joins and reading the results.</p>
<pre><code class="language-sql">SELECT  c.CustomerId, c.Name, a.AddressId, a.Address1
FROM    Customers c
        JOIN Addresses a on c.CustomerId = a.CustomerId

--Result:

CustomerId  Name  AddressId Address1
----------  ----  --------- ----------
        23  Ron         402 12 Main St
        47  Eve          11 3 Polo Ave        
</code></pre>
<p><strong>Simple Tables</strong><br>
TableName + "Id"</p>
<pre><code class="language-csharp">Yes            |No               
---------------|-----------------
CustomerId     |CustomerID, Customer_id, Customer_ID
</code></pre>
<p><strong>Many-to-Many Tables</strong><br>
A <strong>regular</strong> join table doesn't need its own primary key. Just use the other tables' primary keys to form a composite key.</p>
<pre><code class="language-csharp">OrderVendor
===========
OrderId  (PK, FK)
VendorId (PK, FK)
</code></pre>
<p>The resulting classes should have these properties</p>
<pre><code class="language-csharp">class Order 
{
  IEnumerable&lt;Vendor&gt; Vendors
}

class Vendor
{
  IEnumerable&lt;Order&gt; Orders
}
</code></pre>
<p>A join table <strong>with payload</strong>--one that has its own columns <em>and/or</em> will be joined to another table, should have its own primary key of Table1+Table2+Id</p>
<pre><code class="language-csharp">OrderPromotion
==============
OrderPromotionId (PK)
OrderId          (FK)
PromotionId      (FK)
</code></pre>
<p>The resulting classes</p>
<pre><code class="language-csharp">class Order
{
  IEnumerable&lt;OrderPromotion&gt; OrderPromotions
  //You can manually add this method to get Promotions
  IEnumerable&lt;Promotion&gt; Promotions
  {get {return OrderPromotions.Select(op =&gt; op.Promotion);}}
}

class Promotion
{
  IEnumerable&lt;OrderPromotion&gt; Order Promotions
}
</code></pre>
<h2 id="foreign-key">Foreign Key</h2>
<p>When possible, use the referenced primary key name. If there are multiple foreign keys to the same table, end with the foreign primary key name.</p>
<pre><code class="language-csharp">Yes                       No               
-------------             -----------------
Employees
=========
EmployeeId (PK)

Customers                 Customers
=========                 =========
CustomerId (PK)           Customer_Id (PK)
SupportEmployeeId (FK)    SupportPerson (FK)
InitialEmployeeId (FK)    InitialEmp_ID (FK)

Addresses                 Addresses
=========                 =========
AddressId  (PK)           AddressId (PK)
CustomerId (FK)           CustID    (FK)
</code></pre>
<h1 id="date-columns">Date Columns</h1>
<p>Use a verb, and end the date or datetime column names with "On".</p>
<p>Following this convention often leads to clearer column meanings, and consistency. For example, DateToPlace or PlaceDateTime becomes PlaceOrderOn.</p>
<pre><code class="language-csharp">Yes            |No               
---------------|-----------------
OrderedOn      |OrderDateTime
ShouldShipOn   |DateShipExpect, ExpectedShip_DT, AnticipatedDate
</code></pre>
<h1 id="dont-abbreviate">Don't Abbreviate</h1>
<p>Abbreviations are, by their nature, ambiguous and culture-centric. Avoid them unless they are very common, consistent, and/or well-known in the organization or industry.</p>
<p>A good example of ambiguity is how to abbreviate "number". Even my schema example, "InvoiceNbr", is potentially ambiguous. But InvNo is worse. Is there another column "InvYes"?</p>
<pre><code class="language-csharp">Yes            |No               
---------------|-----------------
Customers      |Custs
CustomerId     |CustId
FirstName      |Fname
InvoiceNbr     |InvNo
</code></pre>
<h1 id="use-consistent-names-and-abbreviations-if-you-must">Use Consistent Names (and Abbreviations if You Must)</h1>
<ul>
<li>If you must abbreviate, be consistent.</li>
<li>If it's spelled "InvoiceNbr" in one table, it's that way in <em>all</em> tables.</li>
<li>If everyone knows what DestinationBOL means, that might be OK. But maybe it's better to expand it to DestinationBillOfLading.</li>
</ul>
<p>When in doubt, refer to <strong>Flatt's Law #6: Clarity is more important than brevity.</strong></p>
<pre><code class="language-csharp">Yes            |No               
---------------|-----------------
InvoiceNbr     |InvoiceNum, InvNumber, Inv_Nmbr
</code></pre>
<h1 id="auditing">Auditing</h1>
<p>To be honest, I've often found audit columns to be more trouble than they're worth. I think if auditing is needed, it's better to have a separate audit history table where you can record many kinds of changes, including deletions.</p>
<p>But, if I am using them, and am tracking who took an action, I don't link to another table (such as Users or Employees), but instead record the physical name. This significantly reduces linking, and makes it easy to indicate that a process (rather than a person) performed an action. In other words, UpdatedBy is a string column and contains a value like "cflatt" or "Nightly Batch Process".</p>
<ul>
<li>CreatedOn</li>
<li>CreatedBy</li>
<li>UpdatedOn</li>
<li>UpdatedBy</li>
</ul>
<h1 id="inheritance">Inheritance</h1>
<p>Inheritance can be modeled in the database a couple of different ways. I prefer Table Per Type, as shown by the Employee and Salesperson tables. Note that the Salesperson table has an <em>EmployeeId</em> primary key. This is what implies the inheritance. In the application's class model, these would become:</p>
<pre><code class="language-csharp">public class Employee
{
  int EmployeeId
  string Name 
}

public class Salesperson: Employee 
{
  double CommissionPercent 
}

public class Customer
{
  int CustomerId
  string Name
  Employee SupportEmployee
  Employee InitialEmployee
  Salesperson Salesperson
}
</code></pre>
</div>
              </div>
              

              <div class='post'>
                <h2 class='post-title'><a href='http://www.softwaremeadows.com/posts/tfs-continuous-integration-agent'>TFS Continuous Integration - Agent Installation and Visual Studio Licensing</a></h2>
                <p class='post-info'><span class='posted-on'>2017-03-08 10:11</span></p>
                <div class='post-content'><h1 id="the-summary">The Summary</h1>
<p>A build agent is what takes care of actually running a build definition. Agents can be installed on machines separate from the TFS server, allowing workload distribution.</p>
<p>The simple way to understand an agent is to imagine how you'd create continuous integration yourself.</p>
<ol>
<li><p>You'd have a machine that could build the software. That means you'd have to install anything needed to accomplish the build, such as Visual Studio, 3rd party controls, certificates, tools, etc.</p>
</li>
<li><p>You'd write a script that could automate the build and report errors.</p>
</li>
<li><p>You'd create a way of running that script on demand, such as developing a Windows service.</p>
</li>
</ol>
<p>That's all TFS Build is doing. You configure the steps (the build script) on the TFS server as a build definition. You install an agent on a machine that can check out the source code and successfully build the application. TFS calls the agent on demand.</p>
<p>It was unclear to me if I needed a licensed version of Visual Studio, or VS installed at all. The answers are:</p>
<ul>
<li>If you're not using the Visual Studio build step, and only the MS Build step, you might be able to get away with installing the <a href="https://www.microsoft.com/en-us/download/details.aspx?id=48159">2015 Build Tools</a>.</li>
<li>However, you'll probably need Visual Studio installed. It does <em>not</em> need to be licensed, assuming it's not also being used for development.</li>
</ul>
<p><a href="https://www.microsoft.com/en-us/download/details.aspx?id=13350">VS 2015 Licensing White Paper</a></p>
<blockquote>
<p>Using Visual Studio on the Build Server: If you have one or more licensed users of Visual Studio Enterprise with MSDN, Visual Studio Professional with MSDN, or any Visual Studio cloud subscription then you may also install the Visual Studio software as part of Team Foundation Server 2017 Build Services. This way, you do not need to purchase a Visual Studio license to cover the running of Visual Studio on the build server for each person whose actions initiate a build.</p>
</blockquote>
<h1 id="references">References</h1>
<p>Installing an agent is pretty simple. Really, just read Ben Day's post and you'll find out what you need. It's slightly outdated, but close enough. I've also listed the steps, below.</p>
<p><a href="https://www.benday.com/2016/01/01/walkthrough-create-a-new-tfs2015-build-server/">https://www.benday.com/2016/01/01/walkthrough-create-a-new-tfs2015-build-server/</a></p>
<h1 id="the-installation">The Installation</h1>
<ol>
<li>Install everything needed to build the software. It's best to do this first.</li>
<li>Download the agent from the TFS web. Manage Server (click the right corner gear) &gt; click link "View collection administration page" &gt; open Agent Queues tab &gt; click "Download agent"</li>
<li>Extract the zip into C:\TfsData\Agents[agent name]</li>
<li>Run ConfigureAgent.cmd</li>
<li>Mostly accept the defaults. The TFS server URL will be something like <a href="http://servername:8080/tfs">http://servername:8080/tfs</a>. Answer Y to installing as a service.</li>
</ol>
<p>After installation, you should see the agent in the Agent Queues.</p>
<h1 id="maintenance">Maintenance</h1>
<p><strong>Agent Versions</strong></p>
<p>If you're using a local TFS installation, the agent version is tied to the TFS version. If you update TFS, be sure to update the agents. It's easy. In Agent Queues, right-click the queue and choose Update All Agents.</p>
<p><strong>Adding Agent Capabilities</strong></p>
<p>Normally, all you need to do is install the software with the capability, then restart the agent. However, here are a couple of articles related to capabilities.</p>
<p><a href="http://donovanbrown.com/post/how-to-register-capabilities-on-your-build-and-release-management-agents">How to Register Capabilities</a><br>
<a href="https://www.visualstudio.com/en-us/docs/build/define/general">Demands</a></p>
<h1 id="the-wrap-up">The Wrap Up</h1>
<p>Agents are just services that run build steps. An agent can be installed on almost any machine, letting you easily configure your build environment.</p>
</div>
              </div>
              
    <div class='paging'><a href='index4.html'>Newer</a>&nbsp;&nbsp;&nbsp;<a href='index6.html'>Older</a></div>
  </section>
  <footer><p>Copyright (c) 2018 Charles L Flatt</p>
</footer>
  
</body>

</html>