<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  
  <link rel='stylesheet' href='http://www.softwaremeadows.com/css/default.css' />
<link rel='stylesheet' href='http://www.softwaremeadows.com/css/tango.css' />

  <title>Home | Software Meadows</title>
</head>

<body>
  <nav>
    <div id="menu">
      <ol>
<li><a href="http://www.softwaremeadows.com/">Home</a></li>
<li><a href="http://www.softwaremeadows.com/about">About</a></li>
</ol>

    </div>
    <div id="recent">
      <h2>Recent</h2>
      <a href='http://www.softwaremeadows.com/posts/announcing_deftconfig'>Announcing DeftConfig</a><a href='http://www.softwaremeadows.com/posts/tfs_2015_publish_asp_net_using_robocopy'>TFS 2015: Publish ASP.NET Using Robocopy</a><a href='http://www.softwaremeadows.com/posts/combining_veracrypt_google_backup_sync_sql_server_part_2'>Combining VeraCrypt, Google Backup & Sync, and Sql Server Part 2</a><a href='http://www.softwaremeadows.com/posts/combining_veracrypt_google_backup_sync_sql_server_part_1'>Combining VeraCrypt, Google Backup & Sync, and Sql Server Part 1</a><a href='http://www.softwaremeadows.com/posts/new-blog-engine'>New Blog Engine</a>
    </div>
    <div id="history">
      <h2>History</h2>
      <ol class='tree'><li class='history-year'><label for='2018'>2018</label><input type='checkbox'  id='2018' /><ol><li class='history-month'><label for='2018-3'>March</label><input type='checkbox'  id='2018-3' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/announcing_deftconfig'>Announcing DeftConfig</a></li></ol></li><li class='history-month'><label for='2018-1'>January</label><input type='checkbox'  id='2018-1' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/tfs_2015_publish_asp_net_using_robocopy'>TFS 2015: Publish ASP.NET Using Robocopy</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/combining_veracrypt_google_backup_sync_sql_server_part_2'>Combining VeraCrypt, Google Backup & Sync, and Sql Server Part 2</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/combining_veracrypt_google_backup_sync_sql_server_part_1'>Combining VeraCrypt, Google Backup & Sync, and Sql Server Part 1</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/new-blog-engine'>New Blog Engine</a></li></ol></li></ol></li><li class='history-year'><label for='2017'>2017</label><input type='checkbox'  id='2017' /><ol><li class='history-month'><label for='2017-8'>August</label><input type='checkbox'  id='2017-8' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/dont-use-data-prefix-in-angularjs'>Don't use "data" prefix in AngularJS</a></li></ol></li><li class='history-month'><label for='2017-7'>July</label><input type='checkbox'  id='2017-7' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/angularjs-service-with-var-declarations'>AngularJS service with var declarations instead of this. assignments</a></li></ol></li><li class='history-month'><label for='2017-6'>June</label><input type='checkbox'  id='2017-6' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/factory-resetting-android-without'>Factory Resetting Android Without Losing Your Life (Metaphorically)</a></li></ol></li><li class='history-month'><label for='2017-5'>May</label><input type='checkbox'  id='2017-5' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/identityserver3-with-pkce-part-4'>IdentityServer3 with PKCE Part 4 - Persisting User Data</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/identityserver3-with-pkce-part-3'>IdentityServer3 with PKCE Part 3 - Persist IdentityServer Configuration</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/identityserver3-with-pkce-part-2'>IdentityServer3 with PKCE Part 2 - Protected Resource Server</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/identityserver3-with-pkce-part-1-simple'>IdentityServer3 with PKCE Part 1 - Simple OAuth2 Server</a></li></ol></li><li class='history-month'><label for='2017-3'>March</label><input type='checkbox'  id='2017-3' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/tfs-continuous-integration-walk-through'>TFS Continuous Integration Walk Through Part 5c - Multiple Solutions: Dependencies</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/sane-database-schema-conventions'>Sane Database Schema Conventions</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/tfs-continuous-integration-agent'>TFS Continuous Integration - Agent Installation and Visual Studio Licensing</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/tfs-continuous-integration-clickonce'>TFS Continuous Integration - ClickOnce Apps</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/tfs-continuous-integration-and-private'>TFS Continuous Integration and Private NuGet Package Sources</a></li></ol></li><li class='history-month'><label for='2017-2'>February</label><input type='checkbox'  id='2017-2' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/tfs-continuous-integration-walk-through_22'>TFS Continuous Integration Walk Through Part 5b - Multiple Solutions: Simple Project References</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/tfs-continuous-integration-walk-through_20'>TFS Continuous Integration Walk Through Part 5a - Multiple Solutions: Overview</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/tfs-continuous-integration-walk-through_24'>TFS Continuous Integration Walk Through Part 4b - Problems With Traits</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/tfs-continuous-integration-walk-through_6'>TFS Continuous Integration Walk Through Part 4a - Filtering Tests</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/tfs-continuous-integration-walk-through_63'>TFS Continuous Integration Walk Through Part 3 - Notifications</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/tfs-continuous-integration-walk-through_5'>TFS Continuous Integration Walk Through Part 2 - Create an Automated Build</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/tfs-continuous-integration-walk-through'>TFS Continuous Integration Walk Through Part 1 - Installing TFS and Checking In a Test Project</a></li></ol></li><li class='history-month'><label for='2017-1'>January</label><input type='checkbox'  id='2017-1' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/what-else-programmers-do-text'>What Else Programmers Do: A Text Manipulation Example</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/what-does-this-code-do-extended'>What does this code do? Extended explanation</a></li></ol></li></ol></li><li class='history-year'><label for='2016'>2016</label><input type='checkbox'  id='2016' /><ol><li class='history-month'><label for='2016-12'>December</label><input type='checkbox'  id='2016-12' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/nexus-5-gps-lock-problem-and-two'>Nexus 5 GPS Lock Problem and Three--or More!--Solutions</a></li></ol></li><li class='history-month'><label for='2016-11'>November</label><input type='checkbox'  id='2016-11' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/how-to-bypass-new-microsoft-office'>How to Bypass the New Microsoft Office Startup and Save Screens</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/google-tasks-vs-reminders-in-desktop'>Google Tasks vs Reminders in Desktop and Phone</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/catching-up-on-coding-claims-based-identity-part-1_6'>Catching Up on Coding - Claims-Based Identity Part 1</a></li></ol></li><li class='history-month'><label for='2016-10'>October</label><input type='checkbox'  id='2016-10' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/creating-forms-authentication'>Creating Forms Authentication Membership Tables in LocalDB–Right and Wrong Ways</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/windows-10-complaint-1-auto-update'>Windows 10 Complaint #1: Auto Update State Loss</a></li></ol></li><li class='history-month'><label for='2016-9'>September</label><input type='checkbox'  id='2016-9' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/disable-windows-10-photo-automatic'>Disable Windows 10 Photo Automatic Albums</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/a-laymans-explanation-of-mocking-and'>A Layman’s Explanation of Mocking and Dependency Injection</a></li></ol></li><li class='history-month'><label for='2016-8'>August</label><input type='checkbox'  id='2016-8' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/catching-up-on-coding-tdd-part-3'>Catching Up on Coding - TDD Part 3</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/catching-up-on-coding-tdd-part-2'>Catching Up on Coding - TDD Part 2</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/catching-up-on-coding-tdd-part-1'>Catching Up on Coding - TDD Part 1</a></li></ol></li><li class='history-month'><label for='2016-7'>July</label><input type='checkbox'  id='2016-7' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/writing-to-current-users-registry-when'>Writing to the Current User(s) Registry When Running as System</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/catching-up-on-coding-syllabus'>Catching Up on Coding - The Syllabus</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/quickly-enable-mercurial-keyring-for'>Quickly Enable Mercurial Keyring for BitBucket</a></li></ol></li><li class='history-month'><label for='2016-6'>June</label><input type='checkbox'  id='2016-6' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/create-easily-debuggable-windows-service'>Create an Easily Debuggable Windows Service</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/underrated-work-skills'>(Underrated) Work Skills</a></li></ol></li><li class='history-month'><label for='2016-5'>May</label><input type='checkbox'  id='2016-5' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/vbnet-windows-project-to-c-conversion'>VB.Net Windows Project to C# Conversion Tools Quick Review</a></li></ol></li><li class='history-month'><label for='2016-2'>February</label><input type='checkbox'  id='2016-2' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/scroll-bars-in-blogger-tags'>Scroll bars in Blogger &lt;pre&gt; Tags</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/google-keep-changes-taking-to-forums'>Google Keep Changes: Taking to the Forums</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/backward-step-for-google-keep'>Backward Step for Google Keep</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/recover-virtualbox-snapshots'>Recover VirtualBox Snapshots</a></li></ol></li><li class='history-month'><label for='2016-1'>January</label><input type='checkbox'  id='2016-1' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/auto-updating-new-windows-7-installation'>Auto Updating a New Windows 7 Installation</a></li></ol></li></ol></li><li class='history-year'><label for='2015'>2015</label><input type='checkbox'  id='2015' /><ol><li class='history-month'><label for='2015-8'>August</label><input type='checkbox'  id='2015-8' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/shoretel-brilliantly-simple'>ShoreTel - Brilliantly Simple?</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/the-google-photos-management-problems'>The Google Photos Management Problem(s)</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/creating-long-lasting-clickonce'>Creating a Long-Lasting ClickOnce Certificate</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/more-encrypted-config-filesclickonce'>More Encrypted Config Files–ClickOnce Complications</a></li></ol></li><li class='history-month'><label for='2015-7'>July</label><input type='checkbox'  id='2015-7' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/encrypting-appconfig'>Encrypting app.config</a></li></ol></li><li class='history-month'><label for='2015-3'>March</label><input type='checkbox'  id='2015-3' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/better-google-sites-designthe-notched'>Better Google Sites Design–The Notched Page</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/removing-unremovable-bluetooth-device'>Removing Unremovable Bluetooth Device: FAIL!</a></li></ol></li></ol></li><li class='history-year'><label for='2014'>2014</label><input type='checkbox'  id='2014' /><ol><li class='history-month'><label for='2014-11'>November</label><input type='checkbox'  id='2014-11' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/how-to-remove-savernet-and-similar'>How to remove Savernet (and similar) Chrome extension</a></li></ol></li><li class='history-month'><label for='2014-9'>September</label><input type='checkbox'  id='2014-9' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/prevent-word-from-restoring-minimized'>Prevent Word from Restoring Minimized Documents</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/clever-phish'>Clever Phish</a></li></ol></li><li class='history-month'><label for='2014-8'>August</label><input type='checkbox'  id='2014-8' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/enable-synaptics-touchpad-2-finger-tap'>Enable Synaptics touchpad 2-finger tap context menu</a></li></ol></li><li class='history-month'><label for='2014-5'>May</label><input type='checkbox'  id='2014-5' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/installing-fcm-flow-cytrometry-library'>Installing fcm flow cytrometry library on Windows 8.1</a></li></ol></li><li class='history-month'><label for='2014-4'>April</label><input type='checkbox'  id='2014-4' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/windows-81-update-1-driver-problem-dtmb'>Windows 8.1 Update 1 Driver Problem DTMB BDA TV USB</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/windows-81-window-key-s-search-from'>Windows 8.1: Window Key + S = Search from Desktop</a></li></ol></li><li class='history-month'><label for='2014-3'>March</label><input type='checkbox'  id='2014-3' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/whs-2011-windows-update-one-or-more'>WHS 2011 Windows Update “One or more services are no running” alert</a></li></ol></li><li class='history-month'><label for='2014-2'>February</label><input type='checkbox'  id='2014-2' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/lenovo-u530-touch-wifi-problem-continued'>Lenovo U530 Touch WiFi Problem Continued</a></li></ol></li><li class='history-month'><label for='2014-1'>January</label><input type='checkbox'  id='2014-1' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/lenovo-u530-touch-wifi-problem'>Lenovo U530 Touch WiFi Problem</a></li></ol></li></ol></li><li class='history-year'><label for='2013'>2013</label><input type='checkbox'  id='2013' /><ol><li class='history-month'><label for='2013-12'>December</label><input type='checkbox'  id='2013-12' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/whs-connector-restart-error-in-windows'>WHS Connector Restart Error in Windows 8.0/8.1</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/how-to-remove-apps-from-google-play-my'>How to Remove Apps from Google Play My Apps Site</a></li></ol></li><li class='history-month'><label for='2013-11'>November</label><input type='checkbox'  id='2013-11' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/windows-81-hidden-opt-ins-opt-outs'>Windows 8.1 Hidden Opt Ins/ Opt Outs</a></li></ol></li><li class='history-month'><label for='2013-9'>September</label><input type='checkbox'  id='2013-9' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/edward-farley-epilogue'>Edward Farley and the Fantastic Library Epilogue</a></li></ol></li><li class='history-month'><label for='2013-7'>July</label><input type='checkbox'  id='2013-7' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/a-week-or-more-of-jolicloud-day-2-end'>A Week (or More!) of JoliCloud - Day 2: THE END</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/a-week-or-more-of-jolicloud-day-1'>A Week (or More!) of JoliCloud - Day 1</a></li></ol></li><li class='history-month'><label for='2013-5'>May</label><input type='checkbox'  id='2013-5' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/edward-farley-part-12'>Edward Farley and the Fantastic Library Part 12</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/edward-farley-part-1019'>Edward Farley and the Fantastic Library Part 11</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/edward-farley-part-10'>Edward Farley and the Fantastic Library Part 10</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/edward-farley-part-9'>Edward Farley and the Fantastic Library Part 9</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/edward-farley-part-8'>Edward Farley and the Fantastic Library Part 8</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/edward-farley-part-7'>Edward Farley and the Fantastic Library Part 7</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/edward-farley-part-6'>Edward Farley and the Fantastic Library Part 6</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/edward-farley-part-5'>Edward Farley and the Fantastic Library Part 5</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/edward-farley-part-4'>Edward Farley and the Fantastic Library Part 4</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/edward-farley-part-3'>Edward Farley and the Fantastic Library Part 3</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/edward-farley-part-2'>Edward Farley and the Fantastic Library Part 2</a></li><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/edward-farley-part-1'>Edward Farley and the Fantastic Library Part 1</a></li></ol></li><li class='history-month'><label for='2013-4'>April</label><input type='checkbox'  id='2013-4' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/clean-up-orphaned-sql-users'>Clean Up Orphaned SQL Users</a></li></ol></li><li class='history-month'><label for='2013-3'>March</label><input type='checkbox'  id='2013-3' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/t-sql-one-to-one-cant-be-done'>T-SQL One to One Can't Be Done</a></li></ol></li><li class='history-month'><label for='2013-1'>January</label><input type='checkbox'  id='2013-1' /><ol><li class='history-post'><a class='history-post' href='http://www.softwaremeadows.com/posts/test-post-with-code'>Migrating Google Drive</a></li></ol></li></ol></li></ol>
    </div>
  </nav>
  <header>
    <div id="site-image">
      <img src="http://www.softwaremeadows.com/images/header.png" alt="" />
    </div>
    <h1 id="site-name"></h1>
    <div id="site-subtitle">A pleasant walk through computing</div>
  </header>
  <section id="content">
    <h1 id="home">Home</h1>

  </section>
  <!-- posts only appear in home index -->
  <section id="posts">
    
              <div class='post'>
                <h2 class='post-title'><a href='http://www.softwaremeadows.com/posts/more-encrypted-config-filesclickonce'>More Encrypted Config Files–ClickOnce Complications</a></h2>
                <p class='post-info'><span class='posted-on'>2015-08-10 19:13</span></p>
                <div class='post-content'><h1 id="prologue">Prologue</h1>
<p>In my previous post, I detailed a solution for <a href="http://www.softwaremeadows.com/2015/07/encrypting-appconfig.html">encrypting sections of the app.config</a> (the technique is similar in a web app). Since then, I ran into some issues in a Windows Form application I was developing.</p>
<ul>
<li>I needed to encrypt email SMTP data.</li>
<li>Initially, I’d get an error when trying to access the smtp section.</li>
<li>When published as ClickOnce, the application threw an error and wouldn’t open.</li>
</ul>
<h1 id="act-i">Act I</h1>
<p>Let’s create a simple app. First, a Windows Form app with three labels. All the code will be in the same page as the Form1 class, to keep things simple. <a href="images/image.png"><img src="http://www.softwaremeadows.com/posts/more-encrypted-config-filesclickonce/images/image.png" title="image" alt="image"></a></p>
<p>Add connectionString, appSettings and smtp sections to the app.config.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode csharp"><code class="sourceCode cs"><a class="sourceLine" id="cb1-1" data-line-number="1">&lt;?xml version=<span class="st">"1.0"</span> encoding=<span class="st">"utf-8"</span> ?&gt;</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">&lt;configuration&gt;</a>
<a class="sourceLine" id="cb1-3" data-line-number="3">&lt;startup&gt;</a>
<a class="sourceLine" id="cb1-4" data-line-number="4">&lt;supportedRuntime version=<span class="st">"v4.0"</span> sku=<span class="st">".NETFramework,Version=v4.5"</span> /&gt;</a>
<a class="sourceLine" id="cb1-5" data-line-number="5">&lt;/startup&gt;</a>
<a class="sourceLine" id="cb1-6" data-line-number="6">&lt;connectionStrings&gt;</a>
<a class="sourceLine" id="cb1-7" data-line-number="7">&lt;add name=<span class="st">"MashDb"</span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8">connectionString=<span class="st">"Server=.\SQLExpress2012;Database=MASH;Trusted Connection=True;"</span></a>
<a class="sourceLine" id="cb1-9" data-line-number="9">providerName=<span class="st">"System.Data.SqlClient"</span>/&gt;</a>
<a class="sourceLine" id="cb1-10" data-line-number="10">&lt;/connectionStrings&gt;</a>
<a class="sourceLine" id="cb1-11" data-line-number="11">&lt;appSettings&gt;</a>
<a class="sourceLine" id="cb1-12" data-line-number="12">&lt;add key=<span class="st">"Password"</span> value=<span class="st">"4077"</span>/&gt;</a>
<a class="sourceLine" id="cb1-13" data-line-number="13">&lt;/appSettings&gt;</a>
<a class="sourceLine" id="cb1-14" data-line-number="14">&lt;system.<span class="fu">net</span>&gt;</a>
<a class="sourceLine" id="cb1-15" data-line-number="15">&lt;mailSettings&gt;</a>
<a class="sourceLine" id="cb1-16" data-line-number="16">&lt;smtp deliveryMethod=<span class="st">"Network"</span> from=<span class="st">"pierce@mash.net"</span>&gt;</a>
<a class="sourceLine" id="cb1-17" data-line-number="17">&lt;network</a>
<a class="sourceLine" id="cb1-18" data-line-number="18">host=<span class="st">"ohmyseoul.kr"</span></a>
<a class="sourceLine" id="cb1-19" data-line-number="19">port=<span class="st">"25"</span></a>
<a class="sourceLine" id="cb1-20" data-line-number="20">defaultCredentials=<span class="st">"true"</span>/&gt;</a>
<a class="sourceLine" id="cb1-21" data-line-number="21">&lt;/smtp&gt;</a>
<a class="sourceLine" id="cb1-22" data-line-number="22">&lt;/mailSettings&gt;</a>
<a class="sourceLine" id="cb1-23" data-line-number="23">&lt;/system.<span class="fu">net</span>&gt;</a>
<a class="sourceLine" id="cb1-24" data-line-number="24">&lt;/configuration&gt;</a></code></pre></div>
<p>Add reference to System.Configuration to the project.</p>
<p><a href="images/image4.png"><img src="http://www.softwaremeadows.com/posts/more-encrypted-config-filesclickonce/images/image4.png" title="image" alt="image"></a></p>
<p>The static Settings class, to get the app.config data. This is personal preference; I know you can also use the Settings designer for this, but it’s kind of hidden and finicky.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode csharp"><code class="sourceCode cs"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">public</span> <span class="kw">static</span> <span class="kw">class</span> Settings</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">{</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="kw">public</span> <span class="kw">static</span> <span class="dt">string</span> MashDb { <span class="kw">get</span> { <span class="kw">return</span> ConfigurationManager.<span class="fu">ConnectionStrings</span>[<span class="st">"MashDb"</span>].<span class="fu">Name</span>; } }</a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="kw">public</span> <span class="kw">static</span> <span class="dt">string</span> Password { <span class="kw">get</span> { <span class="kw">return</span> ConfigurationManager.<span class="fu">AppSettings</span>[<span class="st">"Password"</span>]; } }</a>
<a class="sourceLine" id="cb2-5" data-line-number="5">}</a></code></pre></div>
<p>The static ConfigSettings classes. (Or whatever you’d name your general security utilities.) This is different than what I showed previously. Specifically, they don’t optionally take an executable name. Instead, they take the full path to a config file, essential to solving the ClickOnce problem.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode csharp"><code class="sourceCode cs"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">public</span> <span class="kw">static</span> <span class="kw">class</span> ConfigSettings</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">{</a>
<a class="sourceLine" id="cb3-3" data-line-number="3"></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="co">/// Encrypts/decrypts the connectionStrings, appSettings and smtp sections.</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"encryption"</span><span class="kw">&gt;&lt;/param&gt;</span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"configPath"</span><span class="kw">&gt;</span><span class="co">Full path to config file</span><span class="kw">&lt;/param&gt;</span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9"><span class="co">/// </span><span class="kw">&lt;remarks&gt;</span><span class="co">https://msdn.microsoft.com/en-us/library/ms254494(v=vs.110).aspx</span><span class="kw">&lt;/remarks&gt;</span></a>
<a class="sourceLine" id="cb3-10" data-line-number="10"><span class="kw">public</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">SetDefaultConfigEncryption</span>(<span class="dt">bool</span> encryption, <span class="dt">string</span> configPath = <span class="kw">null</span>)</a>
<a class="sourceLine" id="cb3-11" data-line-number="11">{</a>
<a class="sourceLine" id="cb3-12" data-line-number="12"><span class="fu">SetConfigSectionEncryption</span>(encryption, <span class="st">"appSettings"</span>, configPath);</a>
<a class="sourceLine" id="cb3-13" data-line-number="13"><span class="fu">SetConfigSectionEncryption</span>(encryption, <span class="st">"connectionStrings"</span>, configPath);</a>
<a class="sourceLine" id="cb3-14" data-line-number="14"><span class="fu">SetConfigSectionEncryption</span>(encryption, <span class="st">"system.net/mailSettings/smtp"</span>, configPath);</a>
<a class="sourceLine" id="cb3-15" data-line-number="15">}</a>
<a class="sourceLine" id="cb3-16" data-line-number="16"></a>
<a class="sourceLine" id="cb3-17" data-line-number="17"><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></a>
<a class="sourceLine" id="cb3-18" data-line-number="18"><span class="co">/// Encrypts/decrypts the connectionStrings, appSettings and smtp sections.</span></a>
<a class="sourceLine" id="cb3-19" data-line-number="19"><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></a>
<a class="sourceLine" id="cb3-20" data-line-number="20"><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"encryption"</span><span class="kw">&gt;&lt;/param&gt;</span></a>
<a class="sourceLine" id="cb3-21" data-line-number="21"><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"sectionName"</span><span class="kw">&gt;&lt;/param&gt;</span></a>
<a class="sourceLine" id="cb3-22" data-line-number="22"><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"configPath"</span><span class="kw">&gt;</span><span class="co">Full path to config file</span><span class="kw">&lt;/param&gt;</span></a>
<a class="sourceLine" id="cb3-23" data-line-number="23"><span class="co">/// </span><span class="kw">&lt;remarks&gt;&lt;/remarks&gt;</span></a>
<a class="sourceLine" id="cb3-24" data-line-number="24"><span class="kw">public</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">SetConfigSectionEncryption</span>(<span class="dt">bool</span> encryption, <span class="dt">string</span> sectionName, <span class="dt">string</span> configPath = <span class="kw">null</span>)</a>
<a class="sourceLine" id="cb3-25" data-line-number="25">{</a>
<a class="sourceLine" id="cb3-26" data-line-number="26"><span class="co">//if no configPath supplied, get the currently executing exe's config.</span></a>
<a class="sourceLine" id="cb3-27" data-line-number="27"><span class="kw">if</span> (<span class="dt">string</span>.<span class="fu">IsNullOrWhiteSpace</span>(configPath))</a>
<a class="sourceLine" id="cb3-28" data-line-number="28">{</a>
<a class="sourceLine" id="cb3-29" data-line-number="29">configPath = Assembly.<span class="fu">GetEntryAssembly</span>().<span class="fu">Location</span> + <span class="st">".config"</span>;</a>
<a class="sourceLine" id="cb3-30" data-line-number="30"><span class="kw">#if</span> (DEBUG)</a>
<a class="sourceLine" id="cb3-31" data-line-number="31">AppDomain domain = System.<span class="fu">AppDomain</span>.<span class="fu">CurrentDomain</span>;</a>
<a class="sourceLine" id="cb3-32" data-line-number="32">configPath = Path.<span class="fu">Combine</span>(domain.<span class="fu">SetupInformation</span>.<span class="fu">ApplicationBase</span>, domain.<span class="fu">FriendlyName</span> + <span class="st">".config"</span>);</a>
<a class="sourceLine" id="cb3-33" data-line-number="33"><span class="kw">#endif</span></a>
<a class="sourceLine" id="cb3-34" data-line-number="34">}</a>
<a class="sourceLine" id="cb3-35" data-line-number="35"></a>
<a class="sourceLine" id="cb3-36" data-line-number="36"><span class="kw">try</span></a>
<a class="sourceLine" id="cb3-37" data-line-number="37">{</a>
<a class="sourceLine" id="cb3-38" data-line-number="38"><span class="co">//Open the configuration file and retrieve the connectionStrings section.</span></a>
<a class="sourceLine" id="cb3-39" data-line-number="39">ExeConfigurationFileMap fileMap = <span class="kw">new</span> <span class="fu">ExeConfigurationFileMap</span>();</a>
<a class="sourceLine" id="cb3-40" data-line-number="40">fileMap.<span class="fu">ExeConfigFilename</span> = configPath;</a>
<a class="sourceLine" id="cb3-41" data-line-number="41">Configuration config = ConfigurationManager.<span class="fu">OpenMappedExeConfiguration</span>(fileMap, ConfigurationUserLevel.<span class="fu">None</span>);</a>
<a class="sourceLine" id="cb3-42" data-line-number="42">ConfigurationSection section = config.<span class="fu">GetSection</span>(sectionName);</a>
<a class="sourceLine" id="cb3-43" data-line-number="43"><span class="kw">if</span> (section == <span class="kw">null</span>)</a>
<a class="sourceLine" id="cb3-44" data-line-number="44">{</a>
<a class="sourceLine" id="cb3-45" data-line-number="45"><span class="kw">return</span>;</a>
<a class="sourceLine" id="cb3-46" data-line-number="46">}</a>
<a class="sourceLine" id="cb3-47" data-line-number="47"><span class="co">// Encrypt the section.</span></a>
<a class="sourceLine" id="cb3-48" data-line-number="48"><span class="kw">if</span> (encryption)</a>
<a class="sourceLine" id="cb3-49" data-line-number="49">{</a>
<a class="sourceLine" id="cb3-50" data-line-number="50"><span class="kw">if</span> (!section.<span class="fu">SectionInformation</span>.<span class="fu">IsProtected</span>)</a>
<a class="sourceLine" id="cb3-51" data-line-number="51">{</a>
<a class="sourceLine" id="cb3-52" data-line-number="52">section.<span class="fu">SectionInformation</span>.<span class="fu">ForceSave</span> = <span class="kw">true</span>;</a>
<a class="sourceLine" id="cb3-53" data-line-number="53">section.<span class="fu">SectionInformation</span>.<span class="fu">ProtectSection</span>(<span class="st">"DataProtectionConfigurationProvider"</span>);</a>
<a class="sourceLine" id="cb3-54" data-line-number="54">}</a>
<a class="sourceLine" id="cb3-55" data-line-number="55">}</a>
<a class="sourceLine" id="cb3-56" data-line-number="56"><span class="co">// Remove encryption.</span></a>
<a class="sourceLine" id="cb3-57" data-line-number="57"><span class="kw">if</span> (!encryption)</a>
<a class="sourceLine" id="cb3-58" data-line-number="58">{</a>
<a class="sourceLine" id="cb3-59" data-line-number="59"><span class="kw">if</span> (section.<span class="fu">SectionInformation</span>.<span class="fu">IsProtected</span>)</a>
<a class="sourceLine" id="cb3-60" data-line-number="60">{</a>
<a class="sourceLine" id="cb3-61" data-line-number="61">section.<span class="fu">SectionInformation</span>.<span class="fu">UnprotectSection</span>();</a>
<a class="sourceLine" id="cb3-62" data-line-number="62">}</a>
<a class="sourceLine" id="cb3-63" data-line-number="63">}</a>
<a class="sourceLine" id="cb3-64" data-line-number="64"><span class="co">// Save the current configuration.</span></a>
<a class="sourceLine" id="cb3-65" data-line-number="65">config.<span class="fu">Save</span>();</a>
<a class="sourceLine" id="cb3-66" data-line-number="66">}</a>
<a class="sourceLine" id="cb3-67" data-line-number="67"><span class="kw">catch</span> (Exception ex)</a>
<a class="sourceLine" id="cb3-68" data-line-number="68">{</a>
<a class="sourceLine" id="cb3-69" data-line-number="69"><span class="kw">throw</span> <span class="kw">new</span> <span class="fu">Exception</span>(<span class="st">"Unable to encrypt. "</span> + ex.<span class="fu">GetBaseException</span>().<span class="fu">Message</span>);</a>
<a class="sourceLine" id="cb3-70" data-line-number="70">}</a>
<a class="sourceLine" id="cb3-71" data-line-number="71">}</a>
<a class="sourceLine" id="cb3-72" data-line-number="72">}</a></code></pre></div>
<p>In the Form1 class, add the form Load event, and also the method for encrypting the config. You might be tempted to use System.AppDomain.CurrentDomain.FriendlyName, but in a ClickOnce application this will return “DefaultDomain,” and no site I’ve seen has an answer why.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode csharp"><code class="sourceCode cs"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw">public</span> <span class="kw">partial</span> <span class="kw">class</span> Form1 : Form</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">{</a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="kw">public</span> <span class="fu">Form1</span>()</a>
<a class="sourceLine" id="cb4-4" data-line-number="4">{</a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="fu">EncryptClickOnceConfig</span>();</a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="fu">InitializeComponent</span>();</a>
<a class="sourceLine" id="cb4-7" data-line-number="7">}</a>
<a class="sourceLine" id="cb4-8" data-line-number="8"></a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="kw">private</span> <span class="dt">void</span> <span class="fu">Form1_Load</span>(<span class="dt">object</span> sender, EventArgs e)</a>
<a class="sourceLine" id="cb4-10" data-line-number="10">{</a>
<a class="sourceLine" id="cb4-11" data-line-number="11">label1.<span class="fu">Text</span> = Settings.<span class="fu">MashDb</span>;</a>
<a class="sourceLine" id="cb4-12" data-line-number="12">label2.<span class="fu">Text</span> = Settings.<span class="fu">Password</span>;</a>
<a class="sourceLine" id="cb4-13" data-line-number="13">label3.<span class="fu">Text</span> = <span class="kw">new</span> System.<span class="fu">Net</span>.<span class="fu">Mail</span>.<span class="fu">SmtpClient</span>().<span class="fu">Host</span>;</a>
<a class="sourceLine" id="cb4-14" data-line-number="14">}</a>
<a class="sourceLine" id="cb4-15" data-line-number="15"></a>
<a class="sourceLine" id="cb4-16" data-line-number="16"><span class="kw">private</span> <span class="dt">void</span> <span class="fu">EncryptClickOnceConfig</span>()</a>
<a class="sourceLine" id="cb4-17" data-line-number="17">{</a>
<a class="sourceLine" id="cb4-18" data-line-number="18"><span class="co">//Encrypt config. This didn't work properly in Load. Would lead to error "Unrecognized attribute ‘configProtectionProvider’</span></a>
<a class="sourceLine" id="cb4-19" data-line-number="19"><span class="co">//after encrypting app.config when reading smtp</span></a>
<a class="sourceLine" id="cb4-20" data-line-number="20"><span class="co">//Weird stuff for ClickOnce Deployment.</span></a>
<a class="sourceLine" id="cb4-21" data-line-number="21"><span class="co">//https://social.msdn.microsoft.com/Forums/windows/en-US/3d7ba97f-684c-46a2-9f7b-5d17e989baa8/encrypting-connection-string-with-clickonce-deployment?forum=winformssetup</span></a>
<a class="sourceLine" id="cb4-22" data-line-number="22"><span class="co">//ClickOnce writes two config files for some reason.</span></a>
<a class="sourceLine" id="cb4-23" data-line-number="23">{</a>
<a class="sourceLine" id="cb4-24" data-line-number="24"><span class="kw">if</span> (ApplicationDeployment.<span class="fu">IsNetworkDeployed</span> &amp;&amp; ApplicationDeployment.<span class="fu">CurrentDeployment</span>.<span class="fu">IsFirstRun</span>)</a>
<a class="sourceLine" id="cb4-25" data-line-number="25">{</a>
<a class="sourceLine" id="cb4-26" data-line-number="26"><span class="co">//GetPaths</span></a>
<a class="sourceLine" id="cb4-27" data-line-number="27"><span class="dt">string</span> exeFile = Assembly.<span class="fu">GetEntryAssembly</span>().<span class="fu">Location</span>;</a>
<a class="sourceLine" id="cb4-28" data-line-number="28"><span class="co">//get directory above the executable's.</span></a>
<a class="sourceLine" id="cb4-29" data-line-number="29"><span class="dt">string</span> parentPath = Path.<span class="fu">GetDirectoryName</span>(Path.<span class="fu">GetDirectoryName</span>(exeFile));</a>
<a class="sourceLine" id="cb4-30" data-line-number="30"><span class="dt">string</span> configName = Path.<span class="fu">GetFileName</span>(exeFile) + <span class="st">".config"</span>;</a>
<a class="sourceLine" id="cb4-31" data-line-number="31"><span class="co">//get the matching files</span></a>
<a class="sourceLine" id="cb4-32" data-line-number="32"><span class="kw">foreach</span> (<span class="dt">string</span> configFile <span class="kw">in</span> Directory.<span class="fu">GetDirectories</span>(parentPath, <span class="st">"*"</span> + configName, SearchOption.<span class="fu">AllDirectories</span>))</a>
<a class="sourceLine" id="cb4-33" data-line-number="33">{</a>
<a class="sourceLine" id="cb4-34" data-line-number="34">ConfigSettings.<span class="fu">SetDefaultConfigEncryption</span>(<span class="kw">true</span>, configFile);</a>
<a class="sourceLine" id="cb4-35" data-line-number="35">}</a>
<a class="sourceLine" id="cb4-36" data-line-number="36">}</a>
<a class="sourceLine" id="cb4-37" data-line-number="37"><span class="kw">else</span></a>
<a class="sourceLine" id="cb4-38" data-line-number="38">{</a>
<a class="sourceLine" id="cb4-39" data-line-number="39"><span class="co">//good for debugging, sets the vshost config</span></a>
<a class="sourceLine" id="cb4-40" data-line-number="40">ConfigSettings.<span class="fu">SetDefaultConfigEncryption</span>(<span class="kw">true</span>);</a>
<a class="sourceLine" id="cb4-41" data-line-number="41">}</a>
<a class="sourceLine" id="cb4-42" data-line-number="42">}</a>
<a class="sourceLine" id="cb4-43" data-line-number="43">}</a>
<a class="sourceLine" id="cb4-44" data-line-number="44">}</a></code></pre></div>
<h1 id="act-ii">Act II</h1>
<p>Publish the application. This will automatically create a self-signed certificate. (In a follow up post, I’ll document (for my easy reference) how to create a certificate that lasts more than a year.) There are two important things to do here:</p>
<ul>
<li>Set the project to Release.&nbsp; This is critical. It should be obvious, but it’s easy to forget and leads to one of the errors.</li>
<li>It’s important to install it from a network location, which you can fake by sharing your publish folder and using the UNC path to it. I published to the solution folder. Give the share full permissions (for testing only).</li>
</ul>
<p><a href="images/image-001.png"><img src="http://www.softwaremeadows.com/posts/more-encrypted-config-filesclickonce/images/image-001.png" title="image" alt="image"></a></p>
<p>You should also enable automatic updating.</p>
<p><a href="images/image-002.png"><img src="http://www.softwaremeadows.com/posts/more-encrypted-config-filesclickonce/images/image-002.png" title="image" alt="image"></a></p>
<p>Install from the UNC path. The app should open.</p>
<p><a href="images/image-003.png"><img src="http://www.softwaremeadows.com/posts/more-encrypted-config-filesclickonce/images/image-003.png" title="image" alt="image"></a></p>
<p>With the app open, open Task Manager, right-click the app, and choose “open file location.”</p>
<p><a href="images/image-004.png"><img src="http://www.softwaremeadows.com/posts/more-encrypted-config-filesclickonce/images/image-004.png" title="image" alt="image"></a></p>
<p>The folder will contain a EncryptedConfigClickOnceSample.exe.config file, which should be encrypted. But you’ll also find <em>another</em> folder, a sibling above or below the one you’re in, also with a EncryptedConfigClickOnceSample.exe.config, which should also be encrypted.</p>
<p>So, fine, it works. How were the problems fixed?</p>
<h1 id="act-iii">Act III</h1>
<h2 id="encrypt-the-smtp-info">Encrypt the SMTP Info</h2>
<p>This one’s pretty easy. Pass the SetConfigSectionEncryption() method the string “system.net/mailSettings/smtp”. What I found interesting is that you can’t submit just “system.net”, or “system.net/mailSettings” Apparently, in some&nbsp; Orwellian programming community, some sections are more equal than others.</p>
<h2 id="error-accessing-the-smtp-info">Error Accessing the SMTP Info</h2>
<p>Set the program to Debug mode and republish. Run the app, letting it self-update. You should receive an error</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode csharp"><code class="sourceCode cs"><a class="sourceLine" id="cb5-1" data-line-number="1">Unrecognized attribute 'configProtectionProvider'</a></code></pre></div>
<p><a href="images/image-005.png"><img src="http://www.softwaremeadows.com/posts/more-encrypted-config-filesclickonce/images/image-005.png" title="image" alt="image"></a></p>
<p>Some sites say to call <span style="font-family: Consolas;">ConfigurationManager.RefreshSection</span><span style="font-family: Calibri;">, but the problem really seems to be the behavior when in Debug mode. </span>The error seems to be caused by how configuration info is accessed after the application starts. It’s not clear to me, and no web page mentioned debug mode. But it worked.</p>
<h2 id="clickonce-error">ClickOnce Error</h2>
<p>In one application, when I tried to install it simply wouldn’t open. I believe this was also due to publishing in Debug mode. However, I also moved my call to configure the config file from Form_Load to the constructor. In my testing app, that’s not making any difference.</p>
<h1 id="epilogue">Epilogue</h1>
<p>Encrypting the app.config could be critical for certain organizations where the highest security is preferred, even if the risk is very low.</p>
<h1 id="references">References</h1>
<p><a href="http://stackoverflow.com/questions/7856951/unrecognized-attribute-configprotectionprovider-after-encrypting-app-config" class="uri" title="http://stackoverflow.com/questions/7856951/unrecognized-attribute-configprotectionprovider-after-encrypting-app-config">http://stackoverflow.com/questions/7856951/unrecognized-attribute-configprotectionprovider-after-encrypting-app-config</a></p>
<p><a href="https://social.msdn.microsoft.com/Forums/windows/en-US/3d7ba97f-684c-46a2-9f7b-5d17e989baa8/encrypting-connection-string-with-clickonce-deployment?forum=winformssetup" class="uri" title="https://social.msdn.microsoft.com/Forums/windows/en-US/3d7ba97f-684c-46a2-9f7b-5d17e989baa8/encrypting-connection-string-with-clickonce-deployment?forum=winformssetup">https://social.msdn.microsoft.com/Forums/windows/en-US/3d7ba97f-684c-46a2-9f7b-5d17e989baa8/encrypting-connection-string-with-clickonce-deployment?forum=winformssetup</a></p>
<h1 id="source-code">Source Code</h1>
<div class="sourceCode" id="cb6"><pre class="sourceCode csharp"><code class="sourceCode cs"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw">using</span> System;</a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="kw">using</span> System.<span class="fu">Collections</span>.<span class="fu">Generic</span>;</a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="kw">using</span> System.<span class="fu">ComponentModel</span>;</a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="kw">using</span> System.<span class="fu">Data</span>;</a>
<a class="sourceLine" id="cb6-5" data-line-number="5"><span class="kw">using</span> System.<span class="fu">Drawing</span>;</a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="kw">using</span> System.<span class="fu">Linq</span>;</a>
<a class="sourceLine" id="cb6-7" data-line-number="7"><span class="kw">using</span> System.<span class="fu">Text</span>;</a>
<a class="sourceLine" id="cb6-8" data-line-number="8"><span class="kw">using</span> System.<span class="fu">Threading</span>.<span class="fu">Tasks</span>;</a>
<a class="sourceLine" id="cb6-9" data-line-number="9"><span class="kw">using</span> System.<span class="fu">Windows</span>.<span class="fu">Forms</span>;</a>
<a class="sourceLine" id="cb6-10" data-line-number="10"></a>
<a class="sourceLine" id="cb6-11" data-line-number="11"><span class="kw">using</span> System.<span class="fu">Net</span>.<span class="fu">Mail</span>;</a>
<a class="sourceLine" id="cb6-12" data-line-number="12"><span class="kw">using</span> System.<span class="fu">Configuration</span>;</a>
<a class="sourceLine" id="cb6-13" data-line-number="13"><span class="kw">using</span> System.<span class="fu">IO</span>;</a>
<a class="sourceLine" id="cb6-14" data-line-number="14"><span class="kw">using</span> System.<span class="fu">Deployment</span>.<span class="fu">Application</span>;</a>
<a class="sourceLine" id="cb6-15" data-line-number="15"><span class="kw">using</span> System.<span class="fu">Reflection</span>;</a>
<a class="sourceLine" id="cb6-16" data-line-number="16"></a>
<a class="sourceLine" id="cb6-17" data-line-number="17"><span class="kw">namespace</span> EncryptedConfigClickOnceSample</a>
<a class="sourceLine" id="cb6-18" data-line-number="18">{</a>
<a class="sourceLine" id="cb6-19" data-line-number="19"><span class="kw">public</span> <span class="kw">partial</span> <span class="kw">class</span> Form1 : Form</a>
<a class="sourceLine" id="cb6-20" data-line-number="20">{</a>
<a class="sourceLine" id="cb6-21" data-line-number="21"><span class="kw">public</span> <span class="fu">Form1</span>()</a>
<a class="sourceLine" id="cb6-22" data-line-number="22">{</a>
<a class="sourceLine" id="cb6-23" data-line-number="23"><span class="fu">EncryptClickOnceConfig</span>();</a>
<a class="sourceLine" id="cb6-24" data-line-number="24"><span class="fu">InitializeComponent</span>();</a>
<a class="sourceLine" id="cb6-25" data-line-number="25">}</a>
<a class="sourceLine" id="cb6-26" data-line-number="26"></a>
<a class="sourceLine" id="cb6-27" data-line-number="27"><span class="kw">private</span> <span class="dt">void</span> <span class="fu">Form1_Load</span>(<span class="dt">object</span> sender, EventArgs e)</a>
<a class="sourceLine" id="cb6-28" data-line-number="28">{</a>
<a class="sourceLine" id="cb6-29" data-line-number="29">label1.<span class="fu">Text</span> = Settings.<span class="fu">MashDb</span>;</a>
<a class="sourceLine" id="cb6-30" data-line-number="30">label2.<span class="fu">Text</span> = Settings.<span class="fu">Password</span>;</a>
<a class="sourceLine" id="cb6-31" data-line-number="31">label3.<span class="fu">Text</span> = <span class="kw">new</span> System.<span class="fu">Net</span>.<span class="fu">Mail</span>.<span class="fu">SmtpClient</span>().<span class="fu">Host</span>;</a>
<a class="sourceLine" id="cb6-32" data-line-number="32">}</a>
<a class="sourceLine" id="cb6-33" data-line-number="33"></a>
<a class="sourceLine" id="cb6-34" data-line-number="34"><span class="kw">private</span> <span class="dt">void</span> <span class="fu">EncryptClickOnceConfig</span>()</a>
<a class="sourceLine" id="cb6-35" data-line-number="35">{</a>
<a class="sourceLine" id="cb6-36" data-line-number="36"><span class="co">//Encrypt config. This didn't work properly in Load. Would lead to error "Unrecognized attribute ‘configProtectionProvider’</span></a>
<a class="sourceLine" id="cb6-37" data-line-number="37"><span class="co">//after encrypting app.config when reading smtp</span></a>
<a class="sourceLine" id="cb6-38" data-line-number="38"><span class="co">//Weird stuff for ClickOnce Deployment.</span></a>
<a class="sourceLine" id="cb6-39" data-line-number="39"><span class="co">//https://social.msdn.microsoft.com/Forums/windows/en-US/3d7ba97f-684c-46a2-9f7b-5d17e989baa8/encrypting-connection-string-with-clickonce-deployment?forum=winformssetup</span></a>
<a class="sourceLine" id="cb6-40" data-line-number="40"><span class="co">//ClickOnce writes two config files for some reason.</span></a>
<a class="sourceLine" id="cb6-41" data-line-number="41">{</a>
<a class="sourceLine" id="cb6-42" data-line-number="42"><span class="kw">if</span> (ApplicationDeployment.<span class="fu">IsNetworkDeployed</span> &amp;&amp; ApplicationDeployment.<span class="fu">CurrentDeployment</span>.<span class="fu">IsFirstRun</span>)</a>
<a class="sourceLine" id="cb6-43" data-line-number="43">{</a>
<a class="sourceLine" id="cb6-44" data-line-number="44"><span class="co">//GetPaths</span></a>
<a class="sourceLine" id="cb6-45" data-line-number="45"><span class="dt">string</span> exeFile = Assembly.<span class="fu">GetEntryAssembly</span>().<span class="fu">Location</span>;</a>
<a class="sourceLine" id="cb6-46" data-line-number="46"><span class="co">//get directory above the executable's.</span></a>
<a class="sourceLine" id="cb6-47" data-line-number="47"><span class="dt">string</span> parentPath = Path.<span class="fu">GetDirectoryName</span>(Path.<span class="fu">GetDirectoryName</span>(exeFile));</a>
<a class="sourceLine" id="cb6-48" data-line-number="48"><span class="dt">string</span> configName = Path.<span class="fu">GetFileName</span>(exeFile) + <span class="st">".config"</span>;</a>
<a class="sourceLine" id="cb6-49" data-line-number="49"><span class="co">//get the matching files</span></a>
<a class="sourceLine" id="cb6-50" data-line-number="50"><span class="kw">foreach</span> (<span class="dt">string</span> configFile <span class="kw">in</span> Directory.<span class="fu">GetFiles</span>(parentPath, <span class="st">"*"</span> + configName, SearchOption.<span class="fu">AllDirectories</span>))</a>
<a class="sourceLine" id="cb6-51" data-line-number="51">{</a>
<a class="sourceLine" id="cb6-52" data-line-number="52">ConfigSettings.<span class="fu">SetDefaultConfigEncryption</span>(<span class="kw">true</span>, configFile);</a>
<a class="sourceLine" id="cb6-53" data-line-number="53">}</a>
<a class="sourceLine" id="cb6-54" data-line-number="54"></a>
<a class="sourceLine" id="cb6-55" data-line-number="55">}</a>
<a class="sourceLine" id="cb6-56" data-line-number="56"><span class="kw">else</span></a>
<a class="sourceLine" id="cb6-57" data-line-number="57">{</a>
<a class="sourceLine" id="cb6-58" data-line-number="58"><span class="kw">#if</span> (DEBUG)</a>
<a class="sourceLine" id="cb6-59" data-line-number="59"><span class="co">//good for debugging, sets the vshost config</span></a>
<a class="sourceLine" id="cb6-60" data-line-number="60">ConfigSettings.<span class="fu">SetDefaultConfigEncryption</span>(<span class="kw">true</span>);</a>
<a class="sourceLine" id="cb6-61" data-line-number="61"><span class="kw">#endif</span></a>
<a class="sourceLine" id="cb6-62" data-line-number="62">}</a>
<a class="sourceLine" id="cb6-63" data-line-number="63">}</a>
<a class="sourceLine" id="cb6-64" data-line-number="64">}</a>
<a class="sourceLine" id="cb6-65" data-line-number="65">}</a>
<a class="sourceLine" id="cb6-66" data-line-number="66"></a>
<a class="sourceLine" id="cb6-67" data-line-number="67"><span class="kw">public</span> <span class="kw">static</span> <span class="kw">class</span> Settings</a>
<a class="sourceLine" id="cb6-68" data-line-number="68">{</a>
<a class="sourceLine" id="cb6-69" data-line-number="69"><span class="kw">public</span> <span class="kw">static</span> <span class="dt">string</span> MashDb { <span class="kw">get</span> { <span class="kw">return</span> ConfigurationManager.<span class="fu">ConnectionStrings</span>[<span class="st">"MashDb"</span>].<span class="fu">Name</span>; } }</a>
<a class="sourceLine" id="cb6-70" data-line-number="70"><span class="kw">public</span> <span class="kw">static</span> <span class="dt">string</span> Password { <span class="kw">get</span> { <span class="kw">return</span> ConfigurationManager.<span class="fu">AppSettings</span>[<span class="st">"Password"</span>]; } }</a>
<a class="sourceLine" id="cb6-71" data-line-number="71">}</a>
<a class="sourceLine" id="cb6-72" data-line-number="72"></a>
<a class="sourceLine" id="cb6-73" data-line-number="73"></a>
<a class="sourceLine" id="cb6-74" data-line-number="74"><span class="kw">public</span> <span class="kw">static</span> <span class="kw">class</span> ConfigSettings</a>
<a class="sourceLine" id="cb6-75" data-line-number="75">{</a>
<a class="sourceLine" id="cb6-76" data-line-number="76"></a>
<a class="sourceLine" id="cb6-77" data-line-number="77"><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></a>
<a class="sourceLine" id="cb6-78" data-line-number="78"><span class="co">/// Encrypts/decrypts the connectionStrings, appSettings and smtp sections.</span></a>
<a class="sourceLine" id="cb6-79" data-line-number="79"><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></a>
<a class="sourceLine" id="cb6-80" data-line-number="80"><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"encryption"</span><span class="kw">&gt;&lt;/param&gt;</span></a>
<a class="sourceLine" id="cb6-81" data-line-number="81"><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"configPath"</span><span class="kw">&gt;</span><span class="co">Full path to config file</span><span class="kw">&lt;/param&gt;</span></a>
<a class="sourceLine" id="cb6-82" data-line-number="82"><span class="co">/// </span><span class="kw">&lt;remarks&gt;</span><span class="co">https://msdn.microsoft.com/en-us/library/ms254494(v=vs.110).aspx</span><span class="kw">&lt;/remarks&gt;</span></a>
<a class="sourceLine" id="cb6-83" data-line-number="83"><span class="kw">public</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">SetDefaultConfigEncryption</span>(<span class="dt">bool</span> encryption, <span class="dt">string</span> configPath = <span class="kw">null</span>)</a>
<a class="sourceLine" id="cb6-84" data-line-number="84">{</a>
<a class="sourceLine" id="cb6-85" data-line-number="85"><span class="fu">SetConfigSectionEncryption</span>(encryption, <span class="st">"appSettings"</span>, configPath);</a>
<a class="sourceLine" id="cb6-86" data-line-number="86"><span class="fu">SetConfigSectionEncryption</span>(encryption, <span class="st">"connectionStrings"</span>, configPath);</a>
<a class="sourceLine" id="cb6-87" data-line-number="87"><span class="fu">SetConfigSectionEncryption</span>(encryption, <span class="st">"system.net/mailSettings/smtp"</span>, configPath);</a>
<a class="sourceLine" id="cb6-88" data-line-number="88">}</a>
<a class="sourceLine" id="cb6-89" data-line-number="89"></a>
<a class="sourceLine" id="cb6-90" data-line-number="90"><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></a>
<a class="sourceLine" id="cb6-91" data-line-number="91"><span class="co">/// Encrypts/decrypts the connectionStrings, appSettings and smtp sections.</span></a>
<a class="sourceLine" id="cb6-92" data-line-number="92"><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></a>
<a class="sourceLine" id="cb6-93" data-line-number="93"><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"encryption"</span><span class="kw">&gt;&lt;/param&gt;</span></a>
<a class="sourceLine" id="cb6-94" data-line-number="94"><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"sectionName"</span><span class="kw">&gt;&lt;/param&gt;</span></a>
<a class="sourceLine" id="cb6-95" data-line-number="95"><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"configPath"</span><span class="kw">&gt;</span><span class="co">Full path to config file</span><span class="kw">&lt;/param&gt;</span></a>
<a class="sourceLine" id="cb6-96" data-line-number="96"><span class="co">/// </span><span class="kw">&lt;remarks&gt;&lt;/remarks&gt;</span></a>
<a class="sourceLine" id="cb6-97" data-line-number="97"><span class="kw">public</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">SetConfigSectionEncryption</span>(<span class="dt">bool</span> encryption, <span class="dt">string</span> sectionName, <span class="dt">string</span> configPath = <span class="kw">null</span>)</a>
<a class="sourceLine" id="cb6-98" data-line-number="98">{</a>
<a class="sourceLine" id="cb6-99" data-line-number="99"><span class="co">//if no configPath supplied, get the currently executing exe's config.</span></a>
<a class="sourceLine" id="cb6-100" data-line-number="100"><span class="kw">if</span> (<span class="dt">string</span>.<span class="fu">IsNullOrWhiteSpace</span>(configPath))</a>
<a class="sourceLine" id="cb6-101" data-line-number="101">{</a>
<a class="sourceLine" id="cb6-102" data-line-number="102">configPath = Assembly.<span class="fu">GetEntryAssembly</span>().<span class="fu">Location</span> + <span class="st">".config"</span>;</a>
<a class="sourceLine" id="cb6-103" data-line-number="103"><span class="kw">#if</span> (DEBUG)</a>
<a class="sourceLine" id="cb6-104" data-line-number="104">AppDomain domain = System.<span class="fu">AppDomain</span>.<span class="fu">CurrentDomain</span>;</a>
<a class="sourceLine" id="cb6-105" data-line-number="105">configPath = Path.<span class="fu">Combine</span>(domain.<span class="fu">SetupInformation</span>.<span class="fu">ApplicationBase</span>, domain.<span class="fu">FriendlyName</span> + <span class="st">".config"</span>);</a>
<a class="sourceLine" id="cb6-106" data-line-number="106"><span class="kw">#endif</span></a>
<a class="sourceLine" id="cb6-107" data-line-number="107">}</a>
<a class="sourceLine" id="cb6-108" data-line-number="108"></a>
<a class="sourceLine" id="cb6-109" data-line-number="109"><span class="kw">try</span></a>
<a class="sourceLine" id="cb6-110" data-line-number="110">{</a>
<a class="sourceLine" id="cb6-111" data-line-number="111"><span class="co">//Open the configuration file and retrieve the connectionStrings section.</span></a>
<a class="sourceLine" id="cb6-112" data-line-number="112">ExeConfigurationFileMap fileMap = <span class="kw">new</span> <span class="fu">ExeConfigurationFileMap</span>();</a>
<a class="sourceLine" id="cb6-113" data-line-number="113">fileMap.<span class="fu">ExeConfigFilename</span> = configPath;</a>
<a class="sourceLine" id="cb6-114" data-line-number="114">Configuration config = ConfigurationManager.<span class="fu">OpenMappedExeConfiguration</span>(fileMap, ConfigurationUserLevel.<span class="fu">None</span>);</a>
<a class="sourceLine" id="cb6-115" data-line-number="115">ConfigurationSection section = config.<span class="fu">GetSection</span>(sectionName);</a>
<a class="sourceLine" id="cb6-116" data-line-number="116"><span class="kw">if</span> (section == <span class="kw">null</span>)</a>
<a class="sourceLine" id="cb6-117" data-line-number="117">{</a>
<a class="sourceLine" id="cb6-118" data-line-number="118"><span class="kw">return</span>;</a>
<a class="sourceLine" id="cb6-119" data-line-number="119">}</a>
<a class="sourceLine" id="cb6-120" data-line-number="120"><span class="co">// Encrypt the section.</span></a>
<a class="sourceLine" id="cb6-121" data-line-number="121"><span class="kw">if</span> (encryption)</a>
<a class="sourceLine" id="cb6-122" data-line-number="122">{</a>
<a class="sourceLine" id="cb6-123" data-line-number="123"><span class="kw">if</span> (!section.<span class="fu">SectionInformation</span>.<span class="fu">IsProtected</span>)</a>
<a class="sourceLine" id="cb6-124" data-line-number="124">{</a>
<a class="sourceLine" id="cb6-125" data-line-number="125">section.<span class="fu">SectionInformation</span>.<span class="fu">ForceSave</span> = <span class="kw">true</span>;</a>
<a class="sourceLine" id="cb6-126" data-line-number="126">section.<span class="fu">SectionInformation</span>.<span class="fu">ProtectSection</span>(<span class="st">"DataProtectionConfigurationProvider"</span>);</a>
<a class="sourceLine" id="cb6-127" data-line-number="127">}</a>
<a class="sourceLine" id="cb6-128" data-line-number="128">}</a>
<a class="sourceLine" id="cb6-129" data-line-number="129"><span class="co">// Remove encryption.</span></a>
<a class="sourceLine" id="cb6-130" data-line-number="130"><span class="kw">if</span> (!encryption)</a>
<a class="sourceLine" id="cb6-131" data-line-number="131">{</a>
<a class="sourceLine" id="cb6-132" data-line-number="132"><span class="kw">if</span> (section.<span class="fu">SectionInformation</span>.<span class="fu">IsProtected</span>)</a>
<a class="sourceLine" id="cb6-133" data-line-number="133">{</a>
<a class="sourceLine" id="cb6-134" data-line-number="134">section.<span class="fu">SectionInformation</span>.<span class="fu">UnprotectSection</span>();</a>
<a class="sourceLine" id="cb6-135" data-line-number="135">}</a>
<a class="sourceLine" id="cb6-136" data-line-number="136">}</a>
<a class="sourceLine" id="cb6-137" data-line-number="137"><span class="co">// Save the current configuration.</span></a>
<a class="sourceLine" id="cb6-138" data-line-number="138">config.<span class="fu">Save</span>();</a>
<a class="sourceLine" id="cb6-139" data-line-number="139">}</a>
<a class="sourceLine" id="cb6-140" data-line-number="140"><span class="kw">catch</span> (Exception ex)</a>
<a class="sourceLine" id="cb6-141" data-line-number="141">{</a>
<a class="sourceLine" id="cb6-142" data-line-number="142"><span class="kw">throw</span> <span class="kw">new</span> <span class="fu">Exception</span>(<span class="st">"Unable to encrypt. "</span> + ex.<span class="fu">GetBaseException</span>().<span class="fu">Message</span>);</a>
<a class="sourceLine" id="cb6-143" data-line-number="143">}</a>
<a class="sourceLine" id="cb6-144" data-line-number="144">}</a>
<a class="sourceLine" id="cb6-145" data-line-number="145">}</a>
<a class="sourceLine" id="cb6-146" data-line-number="146">}</a></code></pre></div>
</div>
              </div>
              

              <div class='post'>
                <h2 class='post-title'><a href='http://www.softwaremeadows.com/posts/encrypting-appconfig'>Encrypting app.config</a></h2>
                <p class='post-info'><span class='posted-on'>2015-07-25 07:23</span></p>
                <div class='post-content'><p>Developers often use the app.config (or web.config) file to hold database connection strings and application settings. For example:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode csharp"><code class="sourceCode cs"><a class="sourceLine" id="cb1-1" data-line-number="1">&lt;connectionStrings&gt;</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">&lt;add name=<span class="st">"WonderDb"</span> connectionString=<span class="st">"Server=BigServe1;Database=Wonder;Integrated Security=True"</span> providerName=<span class="st">"System.Data.SqlClient"</span> /&gt;</a>
<a class="sourceLine" id="cb1-3" data-line-number="3">&lt;/connectionStrings&gt;</a>
<a class="sourceLine" id="cb1-4" data-line-number="4">&lt;appSettings&gt;</a>
<a class="sourceLine" id="cb1-5" data-line-number="5">&lt;add key=<span class="st">"FtpUser"</span> value=<span class="st">"ariadne"</span> /&gt;</a>
<a class="sourceLine" id="cb1-6" data-line-number="6">&lt;add key=<span class="st">"FtpPassword"</span> value=<span class="st">"maze1$"</span> /&gt;</a>
<a class="sourceLine" id="cb1-7" data-line-number="7">&lt;/appSettings&gt;</a></code></pre></div>
<p>You can find several pages on how to encrypt these settings, but they don’t usually show a typical solution, which, for me, includes:</p>
<ol>
<li>Encrypting/decrypting both connectionStrings and appSettings in one step.</li>
<li>Doing it from code.</li>
<li>Reduced parameters.</li>
</ol>
<p>Granted, this is a simple case, where I don’t care about <em>selectively</em> encrypting settings. For that, Jon Galloway has a <a href="http://weblogs.asp.net/jongalloway/encrypting-passwords-in-a-net-app-config-file">good post</a>. In fact, we’ll use Jon’s post as our basis.</p>
<p><em><em><em>Important: In your project, you need to add the System.Configuration assembly. You also add</em> <span style="font-family: consolas;">using System.Configuration</span></em>, but that by itself doesn’t include all the methods we need without referencing the assembly.</em>**</p>
<p>In my version, I removed the check for whether the section is locked, because I want an error thrown.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode csharp"><code class="sourceCode cs"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">if</span> (!section.<span class="fu">ElementInformation</span>.<span class="fu">IsLocked</span>)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">{. . .</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">}</a></code></pre></div>
<p>I also allow either encrypting or decrypting. Finally, I wrap up the default behavior, encrypting both appSettings and connectionStrings, in a single method call. Here’s the complete Console Application code.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode csharp"><code class="sourceCode cs"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">using</span> System;</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="kw">using</span> System.<span class="fu">Configuration</span>;</a>
<a class="sourceLine" id="cb3-3" data-line-number="3"></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="kw">namespace</span> EncryptConfig</a>
<a class="sourceLine" id="cb3-5" data-line-number="5">{</a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="kw">class</span> Program</a>
<a class="sourceLine" id="cb3-7" data-line-number="7">{</a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span>(<span class="dt">string</span>[] args)</a>
<a class="sourceLine" id="cb3-9" data-line-number="9">{</a>
<a class="sourceLine" id="cb3-10" data-line-number="10"><span class="fu">SetDefaultConfigEncryption</span>(<span class="kw">true</span>);</a>
<a class="sourceLine" id="cb3-11" data-line-number="11">Console.<span class="fu">ReadLine</span>(); <span class="co">//check the file, see if it’s encrypted.</span></a>
<a class="sourceLine" id="cb3-12" data-line-number="12">}</a>
<a class="sourceLine" id="cb3-13" data-line-number="13"></a>
<a class="sourceLine" id="cb3-14" data-line-number="14"><span class="kw">private</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">SetDefaultConfigEncryption</span>(<span class="dt">bool</span> encrypt)</a>
<a class="sourceLine" id="cb3-15" data-line-number="15">{</a>
<a class="sourceLine" id="cb3-16" data-line-number="16"><span class="fu">SetConfigSectionEncryption</span>(encrypt,<span class="st">"appSettings"</span>);</a>
<a class="sourceLine" id="cb3-17" data-line-number="17"><span class="fu">SetConfigSectionEncryption</span>(encrypt, <span class="st">"connectionStrings"</span>);</a>
<a class="sourceLine" id="cb3-18" data-line-number="18">}</a>
<a class="sourceLine" id="cb3-19" data-line-number="19"></a>
<a class="sourceLine" id="cb3-20" data-line-number="20"><span class="kw">private</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">SetConfigSectionEncryption</span>(<span class="dt">bool</span> encrypt, <span class="dt">string</span> sectionKey)</a>
<a class="sourceLine" id="cb3-21" data-line-number="21">{</a>
<a class="sourceLine" id="cb3-22" data-line-number="22">Configuration config = ConfigurationManager.<span class="fu">OpenExeConfiguration</span>(ConfigurationUserLevel.<span class="fu">None</span>);</a>
<a class="sourceLine" id="cb3-23" data-line-number="23">ConfigurationSection section = config.<span class="fu">GetSection</span>(sectionKey);</a>
<a class="sourceLine" id="cb3-24" data-line-number="24"><span class="kw">if</span> (section != <span class="kw">null</span>)</a>
<a class="sourceLine" id="cb3-25" data-line-number="25">{</a>
<a class="sourceLine" id="cb3-26" data-line-number="26"><span class="kw">if</span> (encrypt &amp;&amp; !section.<span class="fu">SectionInformation</span>.<span class="fu">IsProtected</span>)</a>
<a class="sourceLine" id="cb3-27" data-line-number="27">{</a>
<a class="sourceLine" id="cb3-28" data-line-number="28">section.<span class="fu">SectionInformation</span>.<span class="fu">ProtectSection</span>(<span class="st">"DataProtectionConfigurationProvider"</span>);</a>
<a class="sourceLine" id="cb3-29" data-line-number="29">}</a>
<a class="sourceLine" id="cb3-30" data-line-number="30"><span class="kw">if</span> (!encrypt &amp;&amp; section.<span class="fu">SectionInformation</span>.<span class="fu">IsProtected</span>)</a>
<a class="sourceLine" id="cb3-31" data-line-number="31">{</a>
<a class="sourceLine" id="cb3-32" data-line-number="32">section.<span class="fu">SectionInformation</span>.<span class="fu">UnprotectSection</span>();</a>
<a class="sourceLine" id="cb3-33" data-line-number="33">}</a>
<a class="sourceLine" id="cb3-34" data-line-number="34">section.<span class="fu">SectionInformation</span>.<span class="fu">ForceSave</span> = <span class="kw">true</span>;</a>
<a class="sourceLine" id="cb3-35" data-line-number="35">config.<span class="fu">Save</span>(ConfigurationSaveMode.<span class="fu">Full</span>);</a>
<a class="sourceLine" id="cb3-36" data-line-number="36">}</a>
<a class="sourceLine" id="cb3-37" data-line-number="37">}</a>
<a class="sourceLine" id="cb3-38" data-line-number="38">}</a>
<a class="sourceLine" id="cb3-39" data-line-number="39">}</a></code></pre></div>
<p>Assuming an executable named EncryptConfig.exe, when running the above in Debug mode, the file that’s encrypted is <span style="font-family: consolas;">bin\Debug\EncryptConfig.vshost.exe.Config</span></p>
<p>That’s nice and makes sense, because that’s the executable that’s actually in use, even though the regular exe has been built, too.The vshost config file is immediately reverted back when debugging ends. Here’s the encrypted version. Whew!</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode csharp"><code class="sourceCode cs"><a class="sourceLine" id="cb4-1" data-line-number="1">&lt;connectionStrings configProtectionProvider=<span class="st">"DataProtectionConfigurationProvider"</span>&gt;</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">&lt;EncryptedData&gt;</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">&lt;CipherData&gt;</a>
<a class="sourceLine" id="cb4-4" data-line-number="4">&lt;CipherValue&gt;AQAAANCMnd8BFdERjHoAwE/Cl+sBAAAAtX6m55SoIUyvHb37ZhfgAAQAAAACAAAAAAAQZgAAAAEAACAAAAAkgsqGn6mo3noCKO2peA8w799u8ajWVLado9goQ8esSAAAAAAOgAAAAAIAACAAAADqB7GDKmDFY9buAJlgMDyUoos81ALB/<span class="dv">3</span>/UKAtk3wT53TADAAAHixr6r15/5eNFgPHnXPJD950sY5F9oAjYRF4Cpfu9sfd532WpEOxFnST1W4LgX+u+d8so2rf5FqN3ikxsJY4Y1p3xpQeJEA1xa4i9L4n5arPabK4mmNn7fKTKjxri1Xktqkhkb1FLV/opfFFRnOlRy64nFOzWr4Ucwwsr8VR7d3TTt6MD2Bg3pJDZiUgjcQ+tXdD8cHkEhfKfxbMdeLfO65uG6VbyAm+ldjp7p9D6c2Z9DyBbq+rEShrMvMTL+lZ52j9H63sD+V93ESJ9FMgjOMX48TG2ZvboQE6EbiLmM0uH50BqziGUat3ft3Frc+0mQHfoqhnVs2M7mCt5mkjE3Tb0pcvjN3XvWVqo9wy5jxB0K/9yRuPTtSdVBV1q4chHGUZ4XsvBjTnt67LP2XdAYcu/Xju6Swv/dkgXMuXPzuAMgizX86CYuLebR0hMNH3Spiz9ODX98wUFCJMzJ4kQupxpdRNafNKISQWZI7119Anjehz4x3yeWJjUNoatTMWxoQ2xeYr+SlyiRoTOI3BrvfPGgpkDG9nQH2S+8dWMJyWRPHBs2GbrPqjjtLA1yR+2rqt9Uocv29oBJ6DwvnT+FA0p9P/Qp91jzEpRmcTEz+EYoIJfwSsBOIZuRXllcNJkaO1Ni/ThvGpTg0aqotXrhY0MoQlI4m/iPly2qkKVKr3O1qMwY9GrYERTrbj5pKb+hXFPgsOAEDgRBiAHsH6FuoZjG0MIXVTGg4zmJ+7rhsa8EPh61ROI6DwW1rRTA9DSKs9LS1sxeHTR/8QWaLxZuRWSwjuZJaVybPyllU1rvOFzDY9Nv96wk1n9u6s21fSf233l4nuu+7np8VfUdYUxNGfn0TwH69bh8cg1wqaJVCEoSioMHFidrKArtSCciJHW27jn3/SsRz4HWNudebTY8WZTf9YsLTuP0jC7dxuX9CIpuhcJBXitpvyVGxwC5NfmKDAsl/Dws4Rt+/YXVJ/4j5JvT35ZxYbTm/cZgvhL/z6j5odkCkIxey3ulqt1o57VNWJ18Ks0lTStRN0esejDVL6ThnqSVtlP2BCB5bThoRGXvyxhuz6Y/ON4SgeK8vBAAAAAX9I6BKGWYUcUHSscMRV2a6VGisOj9FzqTTWn0YAbeQ2hK0ZuYgK2x7hgp6iZcFJnvvuvXWTHzdvDtEliixpHQQ==&lt;/CipherValue&gt;</a>
<a class="sourceLine" id="cb4-5" data-line-number="5">&lt;/CipherData&gt;</a>
<a class="sourceLine" id="cb4-6" data-line-number="6">&lt;/EncryptedData&gt;</a>
<a class="sourceLine" id="cb4-7" data-line-number="7">&lt;/connectionStrings&gt;</a>
<a class="sourceLine" id="cb4-8" data-line-number="8">&lt;appSettings configProtectionProvider=<span class="st">"DataProtectionConfigurationProvider"</span>&gt;</a>
<a class="sourceLine" id="cb4-9" data-line-number="9">&lt;EncryptedData&gt;</a>
<a class="sourceLine" id="cb4-10" data-line-number="10">&lt;CipherData&gt;</a>
<a class="sourceLine" id="cb4-11" data-line-number="11">&lt;CipherValue&gt;AQAAANCMnd8BFdERjHoAwE/Cl+sBAAAAtX6m55SoIUyvHb37ZhfgAAQAAAACAAAAAAAQZgAAAAEAACAAAAAcT/dxC/l5+9h0pizxo4Thn6rgtJlRVLwGediRA8DpywAAAAAOgAAAAAIAACAAAADHdhTfi7lUXxm6CwB3S252W+lo63eEXsNwxrnPOdfQUCABAACM0LuV5c69abxGbAY6Btx9i/lUhfqjGd8B5MvNCmkwN9hQW90sPzgwBYc7o7EJPM9M2PrgbMXmCo1fUn45ZZdoL68b9andNZe78AJAKz+HNRPBaW3UD2ruwZMKr8F/FVlFxrVnrgytRxDbNNZGfwOR8WrfLsISJdOJHjZcOhLU+hsSVeA2WeSPoH/QR7L+zGqZ15/9VmULHK/0J2KacFKyqn8d4SNIOehAR+t7tlec/qdSsFYtsIWq+c4k4mgWWOVwhCXqzc+3dXRforeEYuBHfsG5KyYsxsaZZdg2dm3wooCJCCv8tK86FuDCBym8L5R1oreRWT8WAq73UM4GJn5in5ZDeAK00lnhjB8DddOy7GjrflIIM63Rc1ClXUrfm3lAAAAA+KiFbW8vRL7rF6Kl9uKDpVp8uzCMs5JcPM9lqHz5XNNQ3m7zEk8TaVoOLC56AKu5rJ+ecX76XYWfQqvpQxDj/g==&lt;/CipherValue&gt;</a>
<a class="sourceLine" id="cb4-12" data-line-number="12">&lt;/CipherData&gt;</a>
<a class="sourceLine" id="cb4-13" data-line-number="13">&lt;/EncryptedData&gt;</a>
<a class="sourceLine" id="cb4-14" data-line-number="14">&lt;/appSettings&gt;</a></code></pre></div>
<p>There’s nothing new here, I just wanted to document what I think of as a common implementation instead of the generic one. If I’ve made a security error let me know.</p>
<h2 id="references">References</h2>
<p>Many pages reference David Hayden’s seminal post on the subject, but I was unable to locate the original.</p>
<p><a href="https://msdn.microsoft.com/en-us/library/ms254494(v=vs.110).aspx" class="uri" title="https://msdn.microsoft.com/en-us/library/ms254494(v=vs.110).aspx">https://msdn.microsoft.com/en-us/library/ms254494(v=vs.110).aspx</a> <a href="http://weblogs.asp.net/jongalloway/encrypting-passwords-in-a-net-app-config-file">Jon Galloway’s Post</a> <a href="http://www.4guysfromrolla.com/articles/021506-1.aspx">4 Guys from Rolla</a></p>
</div>
              </div>
              

              <div class='post'>
                <h2 class='post-title'><a href='http://www.softwaremeadows.com/posts/better-google-sites-designthe-notched'>Better Google Sites Design–The Notched Page</a></h2>
                <p class='post-info'><span class='posted-on'>2015-03-04 14:38</span></p>
                <div class='post-content'><p>I am not a web designer. Lest that be unclear, let me call it out.</p>
<blockquote>
<p><em>I am not a web designer</em></p>
</blockquote>
<p>But, I can imitate, and I can figure things out. Except programmable thermostats. Baffling.</p>
<p>It’s no secret that Google Sites themes are uniformly mediocre. I went searching for tutorials on how to do better, and found some help—not much—and a company, <a href="http://www.kirksvillewebdesign.com/google-sites">Kirksville Web Design</a>, who specializes in them. This was a pretty big help, because I got to look at actual sites that I knew could be done in GS. I could either pay them for templates, or figure it out.</p>
<p>This isn’t a tutorial on how to use Google Sites, nor on how to create web images. I’m assuming you know enough about both. (I use <a href="http://inkscape.org">Inkscape</a> to create a lot of my graphics.)</p>
<p>Now, if you want a really professional site, hire a professional designer like Kirksville. But if you want a decent looking site, here are instructions for creating a simple, better design. The reference web site—again, designed by Kirksville—is <a href="http://www.aim-for-a-revision-courses.co.uk/about-us-1">Aim for ‘A’</a>. The basic layout features a notched design.</p>
<p><a href="images/Notched_Site_Design_Layout.png"><img src="http://www.softwaremeadows.com/posts/better-google-sites-designthe-notched/images/Notched_Site_Design_Layout.png" title="Notched Site Design Layout" alt="Notched Site Design Layout"></a></p>
<p>That’s not so attractive, but the <a href="http://www.hudsoncma.org/">final site I created</a> is.</p>
<p><a href="http://www.hudsoncma.org/"><img src="http://www.softwaremeadows.com/posts/better-google-sites-designthe-notched/images/image.png" title="image" alt="image"></a></p>
<h1 id="initial-setup">Initial Setup</h1>
<p>Create a Google Site (GS) with a blank template and the Blank Slate theme. You’ll get a pretty ugly page.</p>
<p><a href="images/image-001.png"><img src="http://www.softwaremeadows.com/posts/better-google-sites-designthe-notched/images/image-001.png" title="image" alt="image"></a></p>
<p>Edit the page and add some text.</p>
<p><a href="images/image-002.png"><img src="http://www.softwaremeadows.com/posts/better-google-sites-designthe-notched/images/image-002.png" title="image" alt="image"></a></p>
<p>Now we’re ready to edit the Site Layout</p>
<h1 id="site-layout">Site Layout</h1>
<ol>
<li>Only activate Header and Horizontal Navigation (deactivate Sidebar). Set Site Width to Custom 1000px (press Enter in this text box to save the setting).</li>
<li>Click the Header to edit, and set height to 130px. This is what gives the upper notched effect. Less height increases the notch. <a href="images/image-003.png"><img src="http://www.softwaremeadows.com/posts/better-google-sites-designthe-notched/images/image-003.png" title="image" alt="image"></a></li>
<li>Click the Close button. This gives us a centered site.</li>
</ol>
<p><a href="images/image-004.png"><img src="http://www.softwaremeadows.com/posts/better-google-sites-designthe-notched/images/image-004.png" title="image" alt="image"></a></p>
<p>Now, choose Manage Site.</p>
<h1 id="manage-site">Manage Site</h1>
<p>In the General page,</p>
<ol>
<li>Uncheck Show Site Name at Top of Pages</li>
<li>Click Configure Search. Uncheck “Enable Search.” This gets rid of the search box.</li>
<li>Under Mobile: Check Automatically Adjust Site to Mobile Phones</li>
<li>Save</li>
</ol>
<p>Now open the Themes, Colors, and Fonts page. For the header and footer, you’ll need the following. I used png files, but you could use jpg or gif as desired.</p>
<ul>
<li>A single-color image 1px wide by 200px high, named header-background.png. I chose color #646464.</li>
<li>A single-color image 1px wide by 100px high, named footer-background.png.I chose color #646464.</li>
<li>A header/logo image 1000px wide by 130px high, named header.png. I made the image’s background color #646464 to match the header color. A more advanced (and better) technique is to surround the logo/text with a transparent box only as big as needed, to save download size.</li>
</ul>
<p>Make these changes.</p>
<ol>
<li>Entire Page</li>
<li>Background color: #c8c8c8.</li>
<li>Image: header-background.png. Repeating horizontally fills the space without downloading a large file. <a href="images/image-005.png"><img src="http://www.softwaremeadows.com/posts/better-google-sites-designthe-notched/images/image-005.png" title="image" alt="image"></a></li>
<li>Wrapper: footer-background.png. Note Vertical Position is “bottom.” <a href="images/image-006.png"><img src="http://www.softwaremeadows.com/posts/better-google-sites-designthe-notched/images/image-006.png" title="image" alt="image"></a></li>
<li>Site header</li>
<li>Background Image: header.png. No repetition. (see <em>More about Headers</em>, below). <a href="images/image-007.png"><img src="http://www.softwaremeadows.com/posts/better-google-sites-designthe-notched/images/image-007.png" title="image" alt="image"></a></li>
<li>Content area</li>
<li>Background color: white</li>
<li>Save.</li>
</ol>
<p>Et voila!</p>
<p><a href="images/image-008.png"><img src="http://www.softwaremeadows.com/posts/better-google-sites-designthe-notched/images/image-008.png" title="image" alt="image"></a></p>
<p>There’s clearly more that should be done to make this attractive, but this gives you a good start.</p>
<h1 id="more-about-headers">More About Headers</h1>
<p>The Hudson CMA web site has a centered logo. I didn’t use a 130x1000 image for this. Instead, I surrounded the logo in a transparent box to give the margins I wanted. Then, <em>instead</em> of adding the logo using Manage Site &gt; Themes, I added it using Site Layout &gt; Header.</p>
<p><a href="images/image-009.png"><img src="http://www.softwaremeadows.com/posts/better-google-sites-designthe-notched/images/image-009.png" title="image" alt="image"></a></p>
<p>One isn’t necessarily better than the other, though they can lead to differences in how the horizontal menu is placed. More on that in another post.</p>
<h1></h1>
<h1 id="references">References</h1>
<p><a href="http://blog.msbethea.com/?p=965">Google Sites: Build Your Own Theme</a></p>
<p><a href="http://www.summitstuff.com/sites-and-blogs/designing-sites-part1">Summit Stuff: Designing Google Sites</a></p>
<p><a href="https://sites.google.com/site/gsitesgallery/">GSites Gallery</a>&nbsp;&nbsp; Great inspiration</p>
<p><a href="http://www.googlesiteswebdesign.com/">Google Sites Web Design</a>&nbsp; A site maintained by Kirksville</p>
<p><a href="http://www.sitestemplate.net/">Site Template</a>&nbsp; If you want to buy templates</p>
<p><a href="http://www.kirksvillewebdesign.com/google-sites">Kirksville Web Design</a></p>
</div>
              </div>
              
    <div class='paging'><a href='index16.html'>Newer</a>&nbsp;&nbsp;&nbsp;<a href='index18.html'>Older</a></div>
  </section>
  <footer><p>Copyright (c) 2018 Charles L Flatt</p>
</footer>
  
</body>

</html>